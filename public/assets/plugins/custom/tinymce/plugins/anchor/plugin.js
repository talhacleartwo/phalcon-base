!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=function(t,e){return"A"===e.tagName&&""===t.dom.getAttrib(e,"href")},n=function(t,n){return/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(n)?(function(t,n){var o=t.selection.getNode();e(t,o)?(o.removeAttribute("name"),o.id=n,t.undoManager.add()):(t.focus(),t.selection.collapse(!0),t.insertContent(t.dom.createHTML("a",{id:n})))}(t,n),!0):(t.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1)},o=function(t){var o=function(t){var n=t.selection.getNode();return e(t,n)?n.getAttribute("id")||n.getAttribute("name"):""}(t);t.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:o},onSubmit:function(e){n(t,e.getData().id)&&e.close()}})},r=function(t){t.addCommand("mceAnchor",function(){o(t)})},a=function(t){return function(e){for(var n=0;n<e.length;n++)(o=e[n]).attr("href")||!o.attr("id")&&!o.attr("name")||o.firstChild||e[n].attr("contenteditable",t);var o}},i=function(t){t.on("PreInit",function(){t.parser.addNodeFilter("a",a("false")),t.serializer.addNodeFilter("a",a(null))})},c=function(t){t.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return t.execCommand("mceAnchor")},onSetup:function(e){return t.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind}}),t.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return t.execCommand("mceAnchor")}})};t.add("anchor",function(t){i(t),r(t),c(t)})}();