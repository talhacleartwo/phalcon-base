!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=function(e,t){return"A"===t.tagName&&""===e.dom.getAttrib(t,"href")},n=function(e){var n,o,r=(o=(n=e).selection.getNode(),t(n,o)?o.getAttribute("id")||o.getAttribute("name"):"");e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:r},onSubmit:function(n){(function(e,n){return/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(n)?(r=n,a=(o=e).selection.getNode(),t(o,a)?(a.removeAttribute("name"),a.id=r,o.undoManager.add()):(o.focus(),o.selection.collapse(!0),o.insertContent(o.dom.createHTML("a",{id:r}))),!0):(e.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1);var o,r,a})(e,n.getData().id)&&n.close()}})},o=function(e){return function(t){for(var n=0;n<t.length;n++)(o=t[n]).attr("href")||!o.attr("id")&&!o.attr("name")||o.firstChild||t[n].attr("contenteditable",e);var o}};e.add("anchor",function(e){var t,r,a;(t=e).on("PreInit",function(){t.parser.addNodeFilter("a",o("false")),t.serializer.addNodeFilter("a",o(null))}),(r=e).addCommand("mceAnchor",function(){n(r)}),(a=e).ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return a.execCommand("mceAnchor")},onSetup:function(e){return a.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind}}),a.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return a.execCommand("mceAnchor")}})})}();