!function(t){"use strict";var n=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=function(){},r=function(t){return function(){return t}},o=function(t){return t};function u(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=n.concat(e);return t.apply(null,o)}}var i,c,a,l,f=function(t){return function(n){return!t(n)}},s=r(!1),d=r(!0),m=function(){return g},g=(i=function(t){return t.isNone()},{fold:function(t,n){return t()},is:s,isSome:s,isNone:d,getOr:a=function(t){return t},getOrThunk:c=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:r(null),getOrUndefined:r(void 0),or:a,orThunk:c,map:m,each:e,bind:m,exists:s,forall:d,filter:m,equals:i,equals_:i,toArray:function(){return[]},toString:r("none()")}),p=function(t){var n=r(t),e=function(){return u},o=function(n){return n(t)},u={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:d,isNone:s,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return p(n(t))},each:function(n){n(t)},bind:o,exists:o,forall:o,filter:function(n){return n(t)?u:g},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(s,function(n){return e(t,n)})}};return u},h={some:p,none:m,from:function(t){return null==t?g:p(t)}},v=function(t){return function(n){return r=typeof(e=n),(null===e?"null":"object"==r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===t;var e,r}},b=function(t){return function(n){return typeof n===t}},w=v("string"),y=v("object"),S=v("array"),C=b("boolean"),x=function(t){return!(null===(n=t)||void 0===n);var n},T=b("function"),R=b("number"),O=Array.prototype.slice,D=Array.prototype.indexOf,A=Array.prototype.push,B=function(t,n){return e=t,r=n,-1<D.call(e,r);var e,r},P=function(t,n){for(var e=0,r=t.length;e<r;e++)if(n(t[e],e))return!0;return!1},E=function(t,n){for(var e=[],r=0;r<t;r++)e.push(n(r));return e},I=function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var u=t[o];r[o]=n(u,o)}return r},M=function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)},k=function(t,n){for(var e=[],r=0,o=t.length;r<o;r++){var u=t[r];n(u,r)&&e.push(u)}return e},N=function(t,n,e){return function(t,n){for(var e=t.length-1;0<=e;e--)n(t[e])}(t,function(t){e=n(e,t)}),e},_=function(t,n,e){return M(t,function(t){e=n(e,t)}),e},W=function(t,n){return function(t,n,e){for(var r=0,o=t.length;r<o;r++){var u=t[r];if(n(u,r))return h.some(u);if(e(u,r))break}return h.none()}(t,n,s)},j=function(t,n){for(var e=0,r=t.length;e<r;e++)if(n(t[e],e))return h.some(e);return h.none()},z=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!S(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);A.apply(n,t[e])}return n},F=function(t,n){return z(I(t,n))},L=function(t,n){for(var e=0,r=t.length;e<r;++e)if(!0!==n(t[e],e))return!1;return!0},H=function(t){return 0===t.length?h.none():h.some(t[t.length-1])},q=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return h.none()},V=Object.keys,U=Object.hasOwnProperty,K=function(t,n){for(var e=V(t),r=0,o=e.length;r<o;r++){var u=e[r];n(t[u],u)}},$=function(t,n){return X(t,function(t,e){return{k:e,v:n(t,e)}})},X=function(t,n){var e={};return K(t,function(t,r){var o=n(t,r);e[o.k]=o.v}),e},G=function(t,n){return Y(t,n)?h.from(t[n]):h.none()},Y=function(t,n){return U.call(t,n)},J=(void 0!==t.window?t.window:Function("return this;")(),function(t){return t.dom().nodeName.toLowerCase()}),Q=function(t){return t.dom().nodeType},Z=function(t){return function(n){return Q(n)===t}},tt=function(t){return 8===Q(t)||"#comment"===J(t)},nt=Z(1),et=Z(3),rt=Z(9),ot=Z(11),ut=function(n,e,r){if(!(w(r)||C(r)||R(r)))throw t.console.error("Invalid call to Attr.set. Key ",e,":: Value ",r,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,r+"")},it=function(t,n,e){ut(t.dom(),n,e)},ct=function(t,n){var e=t.dom();K(n,function(t,n){ut(e,n,t)})},at=function(t,n){var e=t.dom().getAttribute(n);return null===e?void 0:e},lt=function(t,n){return h.from(at(t,n))},ft=function(t,n){var e=t.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(n)},st=function(t,n){t.dom().removeAttribute(n)},dt=function(t){return _(t.dom().attributes,function(t,n){return t[n.name]=n.value,t},{})},mt=function(t,n,e){return""===n||t.length>=n.length&&t.substr(e,e+n.length)===n},gt=function(t,n){return-1!==t.indexOf(n)},pt=function(t,n){return mt(t,n,t.length-n.length)},ht=(l=/^\s+|\s+$/g,function(t){return t.replace(l,"")}),vt=function(t){return 0<t.length},bt=function(t){return void 0!==t.style&&T(t.style.getPropertyValue)},wt=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:r(t)}},yt={fromHtml:function(n,e){var r=(e||t.document).createElement("div");if(r.innerHTML=n,!r.hasChildNodes()||1<r.childNodes.length)throw t.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return wt(r.childNodes[0])},fromTag:function(n,e){var r=(e||t.document).createElement(n);return wt(r)},fromText:function(n,e){var r=(e||t.document).createTextNode(n);return wt(r)},fromDom:wt,fromPoint:function(t,n,e){var r=t.dom();return h.from(r.elementFromPoint(n,e)).map(wt)}},St=function(){return(St=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},Ct=function(t){var n,e=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e||(e=!0,n=t.apply(null,r)),n}},xt=function(){return Tt(0,0)},Tt=function(t,n){return{major:t,minor:n}},Rt=function(t,n){var e=String(n).toLowerCase();return 0===t.length?xt():function(t,n){var e=function(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(r.test(n))return r}}(t,n);if(!e)return{major:0,minor:0};var r=function(t){return Number(n.replace(e,"$"+t))};return Tt(r(1),r(2))}(t,e)},Ot=xt,Dt="Firefox",At=function(t){var n=t.current,e=t.version,r=function(t){return function(){return n===t}};return{current:n,version:e,isEdge:r("Edge"),isChrome:r("Chrome"),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r(Dt),isSafari:r("Safari")}},Bt=function(){return At({current:void 0,version:Ot()})},Pt=At,Et=(r("Edge"),r("Chrome"),r("IE"),r("Opera"),r(Dt),r("Safari"),"Windows"),It="Android",Mt="Solaris",kt="FreeBSD",Nt="ChromeOS",_t=function(t){var n=t.current,e=t.version,r=function(t){return function(){return n===t}};return{current:n,version:e,isWindows:r(Et),isiOS:r("iOS"),isAndroid:r(It),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(Mt),isFreeBSD:r(kt),isChromeOS:r(Nt)}},Wt=function(){return _t({current:void 0,version:Ot()})},jt=_t,zt=(r(Et),r("iOS"),r(It),r("Linux"),r("OSX"),r(Mt),r(kt),r(Nt),function(t,n){var e=String(n).toLowerCase();return W(t,function(t){return t.search(e)})}),Ft=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Lt=function(t){return function(n){return gt(n,t)}},Ht=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(t){return gt(t,"edge/")&&gt(t,"chrome")&&gt(t,"safari")&&gt(t,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Ft],search:function(t){return gt(t,"chrome")&&!gt(t,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(t){return gt(t,"msie")||gt(t,"trident")}},{name:"Opera",versionRegexes:[Ft,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Lt("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Lt("firefox")},{name:"Safari",versionRegexes:[Ft,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(t){return(gt(t,"safari")||gt(t,"mobile/"))&&gt(t,"applewebkit")}}],qt=[{name:"Windows",search:Lt("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(t){return gt(t,"iphone")||gt(t,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Lt("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Lt("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Lt("linux"),versionRegexes:[]},{name:"Solaris",search:Lt("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Lt("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Lt("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Vt={browsers:r(Ht),oses:r(qt)},Ut=function(t,n){var e,o,u,i,c,a,l,f,s,d,m,g,p=Vt.browsers(),h=Vt.oses(),v=function(t,n){return zt(t,n).map(function(t){var e=Rt(t.versionRegexes,n);return{current:t.name,version:e}})}(p,t).fold(Bt,Pt),b=function(t,n){return zt(t,n).map(function(t){var e=Rt(t.versionRegexes,n);return{current:t.name,version:e}})}(h,t).fold(Wt,jt);return{browser:v,os:b,deviceType:(o=v,u=t,i=n,c=(e=b).isiOS()&&!0===/ipad/i.test(u),a=e.isiOS()&&!c,l=e.isiOS()||e.isAndroid(),f=l||i("(pointer:coarse)"),s=c||!a&&l&&i("(min-device-width:768px)"),d=a||l&&!s,m=o.isSafari()&&e.isiOS()&&!1===/safari/i.test(u),g=!d&&!s&&!m,{isiPad:r(c),isiPhone:r(a),isTablet:r(s),isPhone:r(d),isTouch:r(f),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:r(m),isDesktop:r(g)})}},Kt=function(n){return t.window.matchMedia(n).matches},$t=Ct(function(){return Ut(t.navigator.userAgent,Kt)}),Xt=function(){return $t()},Gt=function(t,n){var e=t.dom();if(1!==e.nodeType)return!1;var r=e;if(void 0!==r.matches)return r.matches(n);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(n);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(n);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")},Yt=function(t){return 1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType||0===t.childElementCount},Jt=function(t,n){return t.dom()===n.dom()},Qt=function(n,e){return Xt().browser.isIE()?function(n,e){return r=n.dom(),o=e.dom(),u=t.Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(r.compareDocumentPosition(o)&u);var r,o,u}(n,e):(r=e,(o=n.dom())!==(u=r.dom())&&o.contains(u));var r,o,u},Zt=Gt,tn=function(t){return yt.fromDom(t.dom().ownerDocument)},nn=function(t){return h.from(t.dom().parentNode).map(yt.fromDom)},en=function(t,n){for(var e=T(n)?n:s,r=t.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var u=r.parentNode,i=yt.fromDom(u);if(o.push(i),!0===e(i))break;r=u}return o},rn=function(t){return h.from(t.dom().previousSibling).map(yt.fromDom)},on=function(t){return h.from(t.dom().nextSibling).map(yt.fromDom)},un=function(t){return I(t.dom().childNodes,yt.fromDom)},cn=function(t,n){var e=t.dom().childNodes;return h.from(e[n]).map(yt.fromDom)},an=T(t.Element.prototype.attachShadow)&&T(t.Node.prototype.getRootNode),ln=r(an),fn=an?function(t){return yt.fromDom(t.dom().getRootNode())}:function(t){return rt(t)?t:tn(t)},sn=function(t){return yt.fromDom(t.dom().host)},dn=function(t){return x(t.dom().shadowRoot)},mn=function(t){var n,e,r=et(t)?t.dom().parentNode:t.dom();return null!=r&&null!==r.ownerDocument&&function(t){var n=fn(t);return ot(n)?h.some(n):h.none()}(yt.fromDom(r)).fold(function(){return r.ownerDocument.body.contains(r)},(n=mn,e=sn,function(t){return n(e(t))}))},gn=function(t){var n=t.dom().body;if(null==n)throw new Error("Body is not available yet");return yt.fromDom(n)},pn=function(n,e,r){if(!w(r))throw t.console.error("Invalid call to CSS.set. Property ",e,":: Value ",r,":: Element ",n),new Error("CSS value must be a string: "+r);bt(n)&&n.style.setProperty(e,r)},hn=function(t,n,e){var r=t.dom();pn(r,n,e)},vn=function(t,n){var e=t.dom();K(n,function(t,n){pn(e,n,t)})},bn=function(n,e){var r=n.dom(),o=t.window.getComputedStyle(r).getPropertyValue(e);return""!==o||mn(n)?o:wn(r,e)},wn=function(t,n){return bt(t)?t.style.getPropertyValue(n):""},yn=function(t,n){var e=t.dom(),r=wn(e,n);return h.from(r).filter(function(t){return 0<t.length})},Sn=function(t,n){var e,r,o=t.dom();r=n,bt(e=o)&&e.style.removeProperty(r),lt(t,"style").map(ht).is("")&&st(t,"style")},Cn=function(t,n){nn(t).each(function(e){e.dom().insertBefore(n.dom(),t.dom())})},xn=function(t,n){on(t).fold(function(){nn(t).each(function(t){Rn(t,n)})},function(t){Cn(t,n)})},Tn=function(t,n){cn(t,0).fold(function(){Rn(t,n)},function(e){t.dom().insertBefore(n.dom(),e.dom())})},Rn=function(t,n){t.dom().appendChild(n.dom())},On=function(t,n){Cn(t,n),Rn(n,t)},Dn=function(t,n){M(n,function(e,r){var o=0===r?t:n[r-1];xn(o,e)})},An=function(t,n){M(n,function(n){Rn(t,n)})},Bn=function(t){t.dom().textContent="",M(un(t),function(t){Pn(t)})},Pn=function(t){var n=t.dom();null!==n.parentNode&&n.parentNode.removeChild(n)},En=function(t){var n,e=un(t);0<e.length&&(n=t,M(e,function(t){Cn(n,t)})),Pn(t)},In=function(t,n,e){return{element:r(t),rowspan:r(n),colspan:r(e)}},Mn=function(t,n,e){return{element:r(t),cells:r(n),section:r(e)}},kn=function(t,n){return{element:r(t),isNew:r(n)}},Nn=function(t,n){return{cells:r(t),section:r(n)}},_n=function(t,n){var e=[];return M(un(t),function(t){n(t)&&(e=e.concat([t])),e=e.concat(_n(t,n))}),e},Wn=function(t,n,e){return r=function(t){return Gt(t,n)},k(en(t,e),r);var r},jn=function(t,n){return e=function(t){return Gt(t,n)},k(un(t),e);var e},zn=function(n,e){return r=e,u=void 0===(o=n)?t.document:o.dom(),Yt(u)?[]:I(u.querySelectorAll(r),yt.fromDom);var r,o,u};function Fn(t,n,e,r,o){return t(e,r)?h.some(e):T(o)&&o(e)?h.none():n(e,r,o)}var Ln=function(t,n,e){for(var o=t.dom(),u=T(e)?e:r(!1);o.parentNode;){o=o.parentNode;var i=yt.fromDom(o);if(n(i))return h.some(i);if(u(i))break}return h.none()},Hn=function(t,n,e){return Ln(t,function(t){return Gt(t,n)},e)},qn=function(t,n){return e=function(t){return Gt(t,n)},W(t.dom().childNodes,function(t){return e(yt.fromDom(t))}).map(yt.fromDom);var e},Vn=function(n,e){return r=e,u=void 0===(o=n)?t.document:o.dom(),Yt(u)?h.none():h.from(u.querySelector(r)).map(yt.fromDom);var r,o,u},Un=function(t,n,e){return Fn(function(t,n){return Gt(t,n)},Hn,t,n,e)},Kn=function(t,n,e){return void 0===e&&(e=0),lt(t,n).map(function(t){return parseInt(t,10)}).getOr(e)},$n=function(t,n){return Kn(t,n,1)},Xn=function(t){return 1<$n(t,"colspan")},Gn=function(t){return 1<$n(t,"rowspan")},Yn=function(t,n){return parseInt(bn(t,n),10)},Jn=r(10),Qn=r(10),Zn=function(t,n){return te(t,n,r(!0))},te=function(t,n,e){return F(un(t),function(t){return Gt(t,n)?e(t)?[t]:[]:te(t,n,e)})},ne=function(t,n){return function(t,n,e){return void 0===e&&(e=s),e(n)?h.none():B(t,J(n))?h.some(n):Hn(n,t.join(","),function(t){return Gt(t,"table")||e(t)})}(["td","th"],t,n)},ee=function(t){return Zn(t,"th,td")},re=function(t,n){return Un(t,"table",n)},oe=function(t){return Zn(t,"tr")},ue=function(t){var n=oe(t);return I(n,function(t){var n=t,e=nn(n).map(function(t){var n=J(t);return"tfoot"===n||"thead"===n||"tbody"===n?n:"tbody"}).getOr("tbody"),r=I(ee(t),function(t){var n=Kn(t,"rowspan",1),e=Kn(t,"colspan",1);return In(t,n,e)});return Mn(n,r,e)})},ie=function(t,n){return t+","+n},ce=function(t,n){var e=F(t.all,function(t){return t.cells()});return k(e,n)},ae=function(t){var n={},e=[],o=t.length,u=0;return M(t,function(t,o){var i=[];M(t.cells(),function(t){for(var e=0;void 0!==n[ie(o,e)];)e++;for(var c,a,l,f=(c=t.element(),a=t.rowspan(),l=t.colspan(),{element:r(c),rowspan:r(a),colspan:r(l),row:r(o),column:r(e)}),s=0;s<t.colspan();s++)for(var d=0;d<t.rowspan();d++){var m=e+s,g=ie(o+d,m);n[g]=f,u=Math.max(u,m+1)}i.push(f)}),e.push(Mn(t.element(),i,t.section()))}),{grid:{rows:r(o),columns:r(u)},access:n,all:e}},le=function(t){var n=ue(t);return ae(n)},fe=ae,se=function(t,n,e){var r=t.access[ie(n,e)];return void 0!==r?h.some(r):h.none()},de=function(t,n,e){var r=ce(t,function(t){return e(n,t.element())});return 0<r.length?h.some(r[0]):h.none()},me=ce,ge=function(t){var n=I(t.all,function(t){return t.cells()});return z(n)},pe=function(t,n){var e,r,o,u,i,c,a,l,f,s,d=function(t){return Gt(t.element(),n)},m=ue(t),g=fe(m),p=(r=d,o=(e=g).grid.columns(),u=e.grid.rows(),i=o,a=c=0,K(e.access,function(t){if(r(t)){var n=t.row(),e=n+t.rowspan()-1,o=t.column(),l=o+t.colspan()-1;n<u?u=n:c<e&&(c=e),o<i?i=o:a<l&&(a=l)}}),{minRow:u,minCol:i,maxRow:c,maxCol:a}),h="th:not("+n+"),td:not("+n+")",v=te(t,"th,td",function(t){return Gt(t,h)});return M(v,Pn),function(t,n,e,r){for(var o,u,i,c=n.grid.columns(),a=n.grid.rows(),l=0;l<a;l++)for(var f=!1,s=0;s<c;s++)l<e.minRow||l>e.maxRow||s<e.minCol||s>e.maxCol||(se(n,l,s).filter(r).isNone()?(o=f,u=t[l].element(),i=yt.fromTag("td"),Rn(i,yt.fromTag("br")),(o?Rn:Tn)(u,i)):f=!0)}(m,g,p,d),f=p,s=k(Zn(l=t,"tr"),function(t){return 0===t.dom().childElementCount}),M(s,Pn),f.minCol!==f.maxCol&&f.minRow!==f.maxRow||M(Zn(l,"th,td"),function(t){st(t,"rowspan"),st(t,"colspan")}),st(l,"width"),st(l,"height"),Sn(l,"width"),Sn(l,"height"),t},he=function(t,n){var e=function(n){return t(n)?h.from(n.dom().nodeValue):h.none()};return{get:function(r){if(!t(r))throw new Error("Can only get "+n+" value of a "+n+" node");return e(r).getOr("")},getOption:e,set:function(e,r){if(!t(e))throw new Error("Can only set raw "+n+" value of a "+n+" node");e.dom().nodeValue=r}}}(et,"text"),ve=function(t){return he.get(t)},be=function(t){return he.getOption(t)},we=function(t,n){return he.set(t,n)},ye=function(t){return"img"===J(t)?1:be(t).fold(function(){return un(t).length},function(t){return t.length})},Se=["img","br"],Ce=function(t){return be(t).filter(function(t){return 0!==t.trim().length||-1<t.indexOf("Â ")}).isSome()||B(Se,J(t))},xe=function(t){return n=Ce,(e=function(t){for(var r=0;r<t.childNodes.length;r++){var o=yt.fromDom(t.childNodes[r]);if(n(o))return h.some(o);var u=e(t.childNodes[r]);if(u.isSome())return u}return h.none()})(t.dom());var n,e},Te=function(t){return Re(t,Ce)},Re=function(t,n){var e=function(t){for(var r=un(t),o=r.length-1;0<=o;o--){var u=r[o];if(n(u))return h.some(u);var i=e(u);if(i.isSome())return i}return h.none()};return e(t)},Oe=function(t,n){return yt.fromDom(t.dom().cloneNode(n))},De=function(t){return Oe(t,!1)},Ae=function(t){return Oe(t,!0)},Be=function(){var t=yt.fromTag("td");return Rn(t,yt.fromTag("br")),t},Pe=function(t,n,e){var r=function(t,n){var e,r,o,u,i=(e=t,r=n,o=yt.fromTag(r),u=dt(e),ct(o,u),o),c=un(Ae(t));return An(i,c),i}(t,n);return K(e,function(t,n){null===t?st(r,n):it(r,n,t)}),r},Ee=function(t){return t},Ie=function(t){return function(){return yt.fromTag("tr",t.dom())}},Me=function(t,n,e){return{row:Ie(n),cell:function(n){var r,o,u,i,c,a,l=tn(n.element()),f=yt.fromTag(J(n.element()),l.dom()),s=e.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),d=0<s.length?(r=n.element(),o=f,u=s,xe(r).map(function(t){var n=u.join(","),e=Wn(t,n,function(t){return Jt(t,r)});return N(e,function(t,n){var e=De(n);return st(e,"contenteditable"),Rn(t,e),e},o)}).getOr(o)):f;return Rn(d,yt.fromTag("br")),i=f,c=n.element().dom(),a=i.dom(),bt(c)&&bt(a)&&(a.style.cssText=c.style.cssText),Sn(f,"height"),1!==n.colspan()&&Sn(n.element(),"width"),t(n.element(),f),f},replace:Pe,gap:Be}},ke=function(t){return{row:Ie(t),cell:Be,replace:Ee,gap:Be}},Ne=function(t,n){var e=n.column(),r=n.column()+n.colspan()-1,o=n.row(),u=n.row()+n.rowspan()-1;return e<=t.finishCol()&&r>=t.startCol()&&o<=t.finishRow()&&u>=t.startRow()},_e=function(t,n){return n.column()>=t.startCol()&&n.column()+n.colspan()-1<=t.finishCol()&&n.row()>=t.startRow()&&n.row()+n.rowspan()-1<=t.finishRow()},We=function(t,n,e){var o=de(t,n,Jt),u=de(t,e,Jt);return o.bind(function(t){return u.map(function(n){return function(t,n){return e=Math.min(t.row(),n.row()),o=Math.min(t.column(),n.column()),u=Math.max(t.row()+t.rowspan()-1,n.row()+n.rowspan()-1),i=Math.max(t.column()+t.colspan()-1,n.column()+n.colspan()-1),{startRow:r(e),startCol:r(o),finishRow:r(u),finishCol:r(i)};var e,o,u,i}(t,n)})})},je=function(t,n,e){return We(t,n,e).map(function(n){var e=me(t,u(Ne,n));return I(e,function(t){return t.element()})})},ze=function(t,n){return de(t,n,function(t,n){return Qt(n,t)}).map(function(t){return t.element()})},Fe=function(t,n,e,r,o){var u=Le(t),i=Jt(t,e)?h.some(n):ze(u,n),c=Jt(t,o)?h.some(r):ze(u,r);return i.bind(function(t){return c.bind(function(n){return je(u,t,n)})})},Le=le,He=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function qe(){return{up:r({selector:Hn,closest:Un,predicate:Ln,all:en}),down:r({selector:zn,predicate:_n}),styles:r({get:bn,getRaw:yn,set:hn,remove:Sn}),attrs:r({get:at,set:it,remove:st,copyTo:function(t,n){var e=dt(t);ct(n,e)}}),insert:r({before:Cn,after:xn,afterAll:Dn,append:Rn,appendAll:An,prepend:Tn,wrap:On}),remove:r({unwrap:En,remove:Pn}),create:r({nu:yt.fromTag,clone:function(t){return yt.fromDom(t.dom().cloneNode(!1))},text:yt.fromText}),query:r({comparePosition:function(t,n){return t.dom().compareDocumentPosition(n.dom())},prevSibling:rn,nextSibling:on}),property:r({children:un,name:J,parent:nn,document:function(t){return t.dom().ownerDocument},isText:et,isComment:tt,isElement:nt,getText:ve,setText:we,isBoundary:function(t){return!!nt(t)&&("body"===J(t)||B(He,J(t)))},isEmptyTag:function(t){return!!nt(t)&&B(["br","img","hr","input"],J(t))},isNonEditable:function(t){return nt(t)&&"false"===at(t,"contenteditable")}}),eq:Jt,is:Zt}}var Ve=function(t,n,e){return n.bind(function(n){return e.filter(u(t.eq,n))})},Ue=function(t,n,e){return 0<e.length?function(t,n,e,r){var o=n(t,e);return N(r,function(e,r){var o=n(t,r);return Ve(t,e,o)},o)}(t,n,(r=e)[0],r.slice(1)):h.none();var r},Ke=function(t,n,e,o){void 0===o&&(o=s);var i=[n].concat(t.up().all(n)),c=[e].concat(t.up().all(e)),a=function(t){return j(t,o).fold(function(){return t},function(n){return t.slice(0,n+1)})},l=a(i),f=a(c),d=W(l,function(n){return P(f,(e=n,u(t.eq,e)));var e});return{firstpath:r(l),secondpath:r(f),shared:r(d)}},$e=qe(),Xe=function(t,n){return Ue($e,function(n,e){return t(e)},n)},Ge=function(t){return Hn(t,"table")},Ye=function(t,n,e){var r=function(t){return function(n){return void 0!==e&&e(n)||Jt(n,t)}};return Jt(t,n)?h.some({boxes:h.some([t]),start:t,finish:n}):Ge(t).bind(function(o){return Ge(n).bind(function(u){if(Jt(o,u))return h.some({boxes:(l=t,f=n,s=Le(o),je(s,l,f)),start:t,finish:n});if(Qt(o,u)){var i=0<(c=Wn(n,"td,th",r(o))).length?c[c.length-1]:n;return h.some({boxes:Fe(o,t,o,n,u),start:t,finish:i})}if(Qt(u,o)){var c,a=0<(c=Wn(t,"td,th",r(u))).length?c[c.length-1]:t;return h.some({boxes:Fe(u,t,o,n,u),start:t,finish:a})}return Ke($e,t,n,void 0).shared().bind(function(i){return Un(i,"table",e).bind(function(e){var i=Wn(n,"td,th",r(e)),c=0<i.length?i[i.length-1]:n,a=Wn(t,"td,th",r(e)),l=0<a.length?a[a.length-1]:t;return h.some({boxes:Fe(e,t,o,n,u),start:l,finish:c})})});var l,f,s})})},Je=function(t,n){var e=zn(t,n);return 0<e.length?h.some(e):h.none()},Qe=function(t,n,e){return Vn(t,n).bind(function(n){return Vn(t,e).bind(function(t){return Xe(Ge,[n,t]).map(function(e){return{first:r(n),last:r(t),table:r(e)}})})})},Ze=function(t,n,e,r,o){return u=o,W(t,function(t){return Gt(t,u)}).bind(function(t){return(o=t,u=n,i=e,re(o).bind(function(t){var n,e,r,c=Le(t);return e=u,r=i,de(n=c,o,Jt).bind(function(t){var o=0<e?t.row()+t.rowspan()-1:t.row(),u=0<r?t.column()+t.colspan()-1:t.column();return se(n,o+e,u+r).map(function(t){return t.element()})})})).bind(function(t){return e=r,Hn(n=t,"table").bind(function(t){return Vn(t,e).bind(function(t){return Ye(t,n).bind(function(t){return t.boxes.map(function(n){return{boxes:n,start:t.start,finish:t.finish}})})})});var n,e});var o,u,i});var u},tr=function(t,n,e){return Qe(t,n,e).bind(function(n){var e=function(n){return Jt(t,n)},r=Hn(n.first(),"thead,tfoot,tbody,table",e),o=Hn(n.last(),"thead,tfoot,tbody,table",e);return r.bind(function(t){return o.bind(function(e){return Jt(t,e)?(r=n.table(),o=n.first(),i=n.last(),function(t,n,e){return We(t,n,e).bind(function(n){return function(t,n){for(var e=!0,r=u(_e,n),o=n.startRow();o<=n.finishRow();o++)for(var i=n.startCol();i<=n.finishCol();i++)e=e&&se(t,o,i).exists(r);return e?h.some(n):h.none()}(t,n)})}(Le(r),o,i)):h.none();var r,o,i})})})},nr="data-mce-selected",er="td[data-mce-selected],th[data-mce-selected]",rr="[data-mce-selected]",or="data-mce-first-selected",ur="td[data-mce-first-selected],th[data-mce-first-selected]",ir="data-mce-last-selected",cr="td[data-mce-last-selected],th[data-mce-last-selected]",ar=Object.freeze({__proto__:null,selected:nr,selectedSelector:er,attributeSelector:rr,firstSelected:or,firstSelectedSelector:ur,lastSelected:ir,lastSelectedSelector:cr}),lr=function(n){if(!S(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var e=[],r={};return M(n,function(o,u){var i=V(o);if(1!==i.length)throw new Error("one and only one name per case");var c=i[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!S(a))throw new Error("case arguments must be an array");e.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),i=0;i<o.length;i++)o[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[u].apply(null,o)},match:function(t){var n=V(t);if(e.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+n.join(","));if(!L(e,function(t){return B(n,t)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+e.join(", "));return t[c].apply(null,o)},log:function(n){t.console.log(n,{constructors:e,constructor:c,params:o})}}}}),r},fr=lr([{none:[]},{multiple:["elements"]},{single:["selection"]}]),sr=function(t,n,e,r){return t.fold(n,e,r)},dr=fr.none,mr=fr.multiple,gr=fr.single,pr=function(t,n){return sr(n.get(),r([]),o,r([t]))},hr=function(t){return{element:r(t),mergable:h.none,unmergable:h.none,selection:r([t])}},vr=function(t,n,e){return{element:r(e),mergable:r((u=n,sr(t.get(),h.none,function(t,n){return 0===t.length?h.none():tr(u,ur,cr).bind(function(n){return 1<t.length?h.some({bounds:r(n),cells:r(t)}):h.none()})},h.none))),unmergable:r(0<(o=pr(e,t)).length&&L(o,function(t){return ft(t,"rowspan")&&1<parseInt(at(t,"rowspan"),10)||ft(t,"colspan")&&1<parseInt(at(t,"colspan"),10)})?h.some(o):h.none()),selection:r(pr(e,t))};var o,u},br=function(n,o,u,i){n.on("BeforeGetContent",function(t){!0===t.selection&&sr(o.get(),e,function(e){t.preventDefault(),re(e[0]).map(Ae).map(function(t){return[pe(t,rr)]}).each(function(e){var r;t.content="text"===t.format?I(e,function(t){return t.dom().innerText}).join(""):(r=n,I(e,function(t){return r.selection.serializer.serialize(t.dom(),{})}).join(""))})},e)}),n.on("BeforeSetContent",function(e){!0===e.selection&&!0===e.paste&&h.from(n.dom.getParent(n.selection.getStart(),"th,td")).each(function(o){var c=yt.fromDom(o);re(c).each(function(o){var a,l,f,s,d,m=k((a=e.content,(l=t.document.createElement("div")).innerHTML=a,un(yt.fromDom(l))),function(t){return"meta"!==J(t)});if(1===m.length&&(d=m[0],"table"===J(d))){e.preventDefault();var g=yt.fromDom(n.getDoc()),p=ke(g),h=(f=c,s=m[0],{element:r(f),clipboard:r(s),generators:r(p)});u.pasteCells(o,h).each(function(t){n.selection.setRng(t),n.focus(),i.clear(o)})}})})})},wr=function(t,n){return{left:r(t),top:r(n),translate:function(e,r){return wr(t+e,n+r)}}},yr=wr,Sr=function(t,n){return void 0!==t?t:void 0!==n?n:0},Cr=function(t){var n=t.dom().ownerDocument,e=n.body,r=n.defaultView,o=n.documentElement;if(e===t.dom())return yr(e.offsetLeft,e.offsetTop);var u=Sr(r.pageYOffset,o.scrollTop),i=Sr(r.pageXOffset,o.scrollLeft),c=Sr(o.clientTop,e.clientTop),a=Sr(o.clientLeft,e.clientLeft);return xr(t).translate(i-a,u-c)},xr=function(t){var n,e=t.dom(),r=e.ownerDocument.body;return r===e?yr(r.offsetLeft,r.offsetTop):mn(t)?(n=e.getBoundingClientRect(),yr(n.left,n.top)):yr(0,0)},Tr=function(t){var n=h.from(t.dom().documentElement).map(yt.fromDom).getOr(t);return{parent:r(n),view:r(t),origin:r(yr(0,0))}};function Rr(t,n){var e=function(e){var r=n(e);if(r<=0||null===r){var o=bn(e,t);return parseFloat(o)||0}return r},r=function(t,n){return _(n,function(n,e){var r=bn(t,e),o=void 0===r?0:parseInt(r,10);return isNaN(o)?n:n+o},0)};return{set:function(n,e){if(!R(e)&&!e.match(/^[0-9]+$/))throw new Error(t+".set accepts only positive integer values. Value was "+e);var r=n.dom();bt(r)&&(r.style[t]=e+"px")},get:e,getOuter:e,aggregate:r,max:function(t,n,e){var o=r(t,e);return o<n?n-o:0}}}var Or=Rr("height",function(t){var n=t.dom();return mn(t)?n.getBoundingClientRect().height:n.offsetHeight}),Dr=function(t){return Or.get(t)},Ar=function(t){return Or.getOuter(t)},Br=Rr("width",function(t){return t.dom().offsetWidth}),Pr=function(t){return Br.get(t)},Er=function(t){return Br.getOuter(t)},Ir=function(t,n){return{row:t,y:n}},Mr=function(t,n){return{col:t,x:n}},kr=function(t){return Cr(t).left()+Er(t)},Nr=function(t){return Cr(t).left()},_r=function(t,n){return Mr(t,Nr(n))},Wr=function(t,n){return Mr(t,kr(n))},jr=function(t){return Cr(t).top()},zr=function(t,n){return Ir(t,jr(n))},Fr=function(t,n){return Ir(t,jr(n)+Ar(n))},Lr=function(t,n,e){if(0===e.length)return[];var r=I(e.slice(1),function(n,e){return n.map(function(n){return t(e,n)})}),o=e[e.length-1].map(function(t){return n(e.length-1,t)});return r.concat([o])},Hr={delta:o,positions:function(t){return Lr(zr,Fr,t)},edge:jr},qr={delta:o,edge:Nr,positions:function(t){return Lr(_r,Wr,t)}},Vr={delta:function(t){return-t},edge:kr,positions:function(t){return Lr(Wr,_r,t)}},Ur=function(t){var n=t.grid,e=E(n.columns(),o),u=E(n.rows(),o);return I(e,function(n){return Kr(function(){return F(u,function(e){return se(t,e,n).filter(function(t){return t.column()===n}).fold(r([]),function(t){return[t]})})},function(t){return 1===t.colspan()},function(){return se(t,0,n)})})},Kr=function(t,n,e){var r=t();return W(r,n).orThunk(function(){return h.from(r[0]).orThunk(e)}).map(function(t){return t.element()})},$r=function(t){var n=t.grid,e=E(n.rows(),o),u=E(n.columns(),o);return I(e,function(n){return Kr(function(){return F(u,function(e){return se(t,n,e).filter(function(t){return t.row()===n}).fold(r([]),function(t){return[t]})})},function(t){return 1===t.rowspan()},function(){return se(t,n,0)})})},Xr=function(t,n){if(n<0||n>=t.length-1)return h.none();var e=t[n].fold(function(){var e,r,o=(e=t.slice(0,n),(r=O.call(e,0)).reverse(),r);return q(o,function(t,n){return t.map(function(t){return{value:t,delta:n+1}})})},function(t){return h.some({value:t,delta:0})}),r=t[n+1].fold(function(){var e=t.slice(n+1);return q(e,function(t,n){return t.map(function(t){return{value:t,delta:n+1}})})},function(t){return h.some({value:t,delta:1})});return e.bind(function(t){return r.map(function(n){var e=n.delta+t.delta;return Math.abs(n.value-t.value)/e})})},Gr=function(){var t=Xt().browser;return t.isIE()||t.isEdge()},Yr=function(t,n,e){return r=bn(t,n),o=e,u=parseFloat(r),isNaN(u)?o:u;var r,o,u},Jr=function(t){return Gr()?(e=(n=t).dom().getBoundingClientRect().width,"border-box"===bn(n,"box-sizing")?e:e-Yr(n,"padding-left",0)-Yr(n,"padding-right",0)-(Yr(n,"border-left-width",0)+Yr(n,"border-right-width",0))):Yr(t,"width",Pr(t));var n,e},Qr=/(\d+(\.\d+)?)(\w|%)*/,Zr=/(\d+(\.\d+)?)%/,to=/(\d+(\.\d+)?)px|em/,no=function(t,n){hn(t,"width",n+"px")},eo=function(t,n){hn(t,"width",n+"%")},ro=function(t,n){hn(t,"height",n+"px")},oo=function(t){var n,e=yn(n=t,"height").getOrThunk(function(){return function(t){return Gr()?(e=(n=t).dom().getBoundingClientRect().height,"border-box"===bn(n,"box-sizing")?e:e-Yr(n,"padding-top",0)-Yr(n,"padding-bottom",0)-(Yr(n,"border-top-width",0)+Yr(n,"border-bottom-width",0))):Yr(t,"height",Dr(t));var n,e}(n)+"px"});return e?function(t,n,e,r){var o,u,i,c,a,l=parseInt(t,10);return pt(t,"%")&&"table"!==J(n)?(u=l,i=e,c=r,a=re(o=n).map(function(t){var n=i(t);return Math.floor(u/100*n)}).getOr(u),c(o,a),a):l}(e,t,Dr,ro):Dr(t)},uo=function(t){return yn(t,"width").fold(function(){return h.from(at(t,"width"))},function(t){return h.some(t)})},io=function(t,n){return t/n.pixelWidth()*100},co=function(t,n){return uo(t).fold(function(){var e=Pr(t);return io(e,n)},function(e){return function(t,n,e){var r=Zr.exec(n);if(null!==r)return parseFloat(r[1]);var o=Jr(t);return io(o,e)}(t,e,n)})},ao=function(t,n){return uo(t).fold(function(){return Jr(t)},function(e){return function(t,n,e){var r=to.exec(n);if(null!==r)return parseInt(r[1],10);var o=Zr.exec(n);return null===o?Jr(t):parseFloat(o[1])/100*e.pixelWidth()}(t,e,n)})},lo=function(t){return"rowspan",oo(n=t)/$n(n,"rowspan");var n},fo=function(t,n,e){hn(t,"width",n+e)},so=function(t){return function(t,n){var e,r=(e=t,h.from(e.dom().offsetParent).map(yt.fromDom).getOr(gn(tn(t))));return n(t)/n(r)*100}(t,Pr)+"%"},mo=r(Zr),go=r(to),po=function(t,n,e){return yn(t,n).fold(function(){return e(t)+"px"},function(t){return t})},ho=function(t,n){return po(t,"width",function(t){return ao(t,n)})},vo=function(t){return po(t,"height",lo)},bo=function(t,n,e,r,o){var u=Ur(t),i=I(u,function(t){return t.map(n.edge)});return I(u,function(t,n){return t.filter(f(Xn)).fold(function(){var t=Xr(i,n);return r(t)},function(t){return e(t,o)})})},wo=function(t){return t.map(function(t){return t+"px"}).getOr("")},yo=function(t,n,e){return bo(t,n,co,function(t){return t.fold(function(){return e.minCellWidth()},function(t){return t/e.pixelWidth()*100})},e)},So=function(t,n,e){return bo(t,n,ao,function(t){return t.getOrThunk(e.minCellWidth)},e)},Co=function(t,n,e,r){var o=$r(t),u=I(o,function(t){return t.map(n.edge)});return I(o,function(t,n){return t.filter(f(Gn)).fold(function(){var t=Xr(u,n);return r(t)},function(t){return e(t)})})},xo=lr([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),To=function(t,n,e){var r=e.substring(0,e.length-t.length),o=parseFloat(r);return r===o.toString()?n(o):xo.invalid(e)},Ro=St(St({},xo),{from:function(t){return pt(t,"%")?To("%",xo.percent,t):pt(t,"px")?To("px",xo.pixels,t):xo.invalid(t)}}),Oo=function(t,n,e){var o,u,i,c=Ro.from(e),a=L(t,function(t){return"0px"===t})?(o=c,u=t.length,i=o.fold(function(){return r("")},function(t){return r(t/u+"px")},function(t){return r(t/u+"px")}),E(u,i)):function(t,n,e){return t.fold(function(){return n},function(t){return o=(r=t)/e,I(n,function(t){return Ro.from(t).fold(function(){return t},function(t){return t*o+"px"},function(t){return t/100*r+"px"})});var r,o},function(t){return r=e,I(n,function(t){return Ro.from(t).fold(function(){return t},function(t){return t/r*100+"%"},function(t){return t+"%"})});var r})}(c,t,n);return Ao(a)},Do=function(t,n){return 0===t.length?n:N(t,function(t,n){return Ro.from(n).fold(r(0),o,o)+t},0)},Ao=function(t){if(0===t.length)return t;var n,e,o=N(t,function(t,n){var e=Ro.from(n).fold(function(){return{value:n,remainder:0}},function(t){return n=t,"px",{value:(e=Math.floor(n))+"px",remainder:n-e};var n,e},function(t){return{value:t+"%",remainder:0}});return{output:[e.value].concat(t.output),remainder:t.remainder+e.remainder}},{output:[],remainder:0}),u=o.output;return u.slice(0,u.length-1).concat([(n=u[u.length-1],e=Math.round(o.remainder),Ro.from(n).fold(r(n),function(t){return t+e+"px"},function(t){return t+e+"%"}))])},Bo=Ro.from,Po=function(t){return Bo(t).fold(r("px"),r("px"),r("%"))},Eo=function(t,n,e,r,o){var u=le(t),i=u.all,c=ge(u);n.each(function(n){var e,i,a=Po(n),l=Pr(t),f=bo(u,r,ho,wo,o),s=Oo(f,l,n);e=s,i=a,M(c,function(t){var n=e.slice(t.column(),t.colspan()+t.column()),r=Do(n,Jn());hn(t.element(),"width",r+i)}),hn(t,"width",n)}),e.each(function(n){var e,r,o,a=Po(n),l=Dr(t),f=Co(u,Hr,vo,wo),s=Oo(f,l,n);e=s,r=i,o=a,M(c,function(t){var n=e.slice(t.row(),t.rowspan()+t.row()),r=Do(n,Qn());hn(t.element(),"height",r+o)}),M(r,function(t,n){hn(t.element(),"height",e[n])}),hn(t,"height",n)})},Io=function(t){return uo(t).exists(function(t){return Zr.test(t)})},Mo=function(t){return uo(t).exists(function(t){return to.test(t)})},ko=so,No={ltr:qr,rtl:Vr},_o=function(t){var n=function(n){return t(n).isRtl()?No.rtl:No.ltr};return{delta:function(t,e){return n(e).delta(t,e)},edge:function(t){return n(t).edge(t)},positions:function(t,e){return n(e).positions(t,e)}}},Wo=function(t){var n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(t.length!==n.length)throw new Error('Wrong number of arguments to struct. Expected "['+t.length+']", got '+n.length+" arguments");var o={};return M(t,function(t,e){o[t]=r(n[e])}),o}}.apply(null,t),e=[];return{bind:function(t){if(void 0===t)throw new Error("Event bind error: undefined handler");e.push(t)},unbind:function(t){e=k(e,function(n){return n!==t})},trigger:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=n.apply(null,t);M(e,function(t){t(o)})}}},jo=function(t){return{registry:$(t,function(t){return{bind:t.bind,unbind:t.unbind}}),trigger:$(t,function(t){return t.trigger})}},zo=lr([{none:[]},{only:["index"]},{left:["index","next"]},{middle:["prev","index","next"]},{right:["prev","index"]}]),Fo=St({},zo),Lo=function(t,n,e){for(var r=0,o=t;o<n;o++)r+=void 0!==e[o]?e[o]:0;return r},Ho=function(t,n){var e=ge(t);return I(e,function(t){var e=Lo(t.column(),t.column()+t.colspan(),n);return{element:t.element(),width:e,colspan:t.colspan()}})},qo=function(t){var n,e,o,u,i,c=yt.fromDom(function(t){if(ln()&&x(t.target)){var n=yt.fromDom(t.target);if(nt(n)&&dn(yt.fromDom(t.target))&&t.composed&&t.composedPath){var e=t.composedPath();if(e)return 0===(r=e).length?h.none():h.some(r[0])}}var r;return h.from(t.target)}(t).getOr(t.target)),a=function(){return t.stopPropagation()},l=function(){return t.preventDefault()},f=(n=l,e=a,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(e.apply(null,t))});return o=c,u=t.clientX,i=t.clientY,{target:r(o),x:r(u),y:r(i),stop:a,prevent:l,kill:f,raw:r(t)}},Vo=function(t,n,e,r){t.dom().removeEventListener(n,e,r)},Uo=r(!0),Ko=function(t,n,e){return function(t,n,e,r,o){var i,c,a=(i=e,c=r,function(t){i(t)&&c(qo(t))});return t.dom().addEventListener(n,a,o),{unbind:u(Vo,t,n,a,o)}}(t,n,Uo,e,!1)},$o=qo,Xo=function(t,n){var e=at(t,n);return void 0===e||""===e?[]:e.split(" ")},Go=function(t){return void 0!==t.dom().classList},Yo=function(t,n){Go(t)?t.dom().classList.add(n):function(t,n){return r=n,o=Xo(e=t,"class").concat([r]),it(e,"class",o.join(" ")),!0;var e,r,o}(t,n)},Jo=function(t,n){return Go(t)&&t.dom().classList.contains(n)},Qo=function(t){var n=t.replace(/\./g,"-");return{resolve:function(t){return n+"-"+t}}},Zo=Qo("ephox-dragster").resolve,tu=function(t){return t.slice(0).sort()},nu=function(t,n){var e=k(n,function(n){return!B(t,n)});0<e.length&&function(t){throw new Error("Unsupported keys for object: "+tu(e).join(", "))}()},eu=function(t){return function(t,n,e){if(0===n.length)throw new Error("You must specify at least one required field.");var r;return function(t,n){if(!S(n))throw new Error("The "+t+" fields must be an array. Was: "+n+".");M(n,function(n){if(!w(n))throw new Error("The value "+n+" in the "+t+" fields was not a string.")})}("required",n),r=tu(n),W(r,function(t,n){return n<r.length-1&&t===r[n+1]}).each(function(t){throw new Error("The field: "+t+" occurs more than once in the combined fields: ["+r.join(", ")+"].")}),function(r){var o=V(r);L(n,function(t){return B(o,t)})||function(t,e){throw new Error("All required keys ("+tu(n).join(", ")+") were not specified. Specified keys were: "+tu(e).join(", ")+".")}(0,o),t(n,o);var u=k(n,function(t){return!e.validate(r[t],t)});return 0<u.length&&function(t,n){throw new Error("All values need to be of type: "+n+". Keys ("+tu(t).join(", ")+") were not.")}(u,e.label),r}}(nu,t,{validate:T,label:"function"})},ru=eu(["compare","extract","mutate","sink"]),ou=eu(["element","start","stop","destroy"]),uu=eu(["forceDrop","drop","move","delayDrop"]),iu=ru({compare:function(t,n){return yr(n.left()-t.left(),n.top()-t.top())},extract:function(t){return h.some(yr(t.x(),t.y()))},sink:function(t,n){var e=function(t){var n=St({layerClass:Zo("blocker")},t),e=yt.fromTag("div");return it(e,"role","presentation"),vn(e,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),Yo(e,Zo("blocker")),Yo(e,n.layerClass),{element:function(){return e},destroy:function(){Pn(e)}}}(n),r=Ko(e.element(),"mousedown",t.forceDrop),o=Ko(e.element(),"mouseup",t.drop),u=Ko(e.element(),"mousemove",t.move),i=Ko(e.element(),"mouseout",t.delayDrop);return ou({element:e.element,start:function(t){Rn(t,e.element())},stop:function(){Pn(e.element())},destroy:function(){e.destroy(),o.unbind(),u.unbind(),i.unbind(),r.unbind()}})},mutate:function(t,n){t.mutate(n.left(),n.top())}});function cu(){var t,n,r={onEvent:e,reset:e},o=(t=h.none(),{onEvent:function(e,r){r.extract(e).each(function(e){var o,u,i;(o=r,u=e,i=t.map(function(t){return o.compare(t,u)}),t=h.some(u),i).each(function(t){n.trigger.move(t)})})},reset:function(){t=h.none()},events:(n=jo({move:Wo(["info"])})).registry}),u=r;return{on:function(){u.reset(),u=o},off:function(){u.reset(),u=r},isOn:function(){return u===o},onEvent:function(t,n){u.onEvent(t,n)},events:o.events}}var au=function(t){return"true"===at(t,"contenteditable")},lu=Qo("ephox-snooker").resolve,fu=lu("resizer-bar"),su=lu("resizer-rows"),du=lu("resizer-cols"),mu=function(t){var n=zn(t.parent(),"."+fu);M(n,Pn)},gu=function(t,n,e){var r=t.origin();M(n,function(n){n.each(function(n){var o=e(r,n);Yo(o,fu),Rn(t.parent(),o)})})},pu=function(t,n,e,r){mu(t);var o=le(n);!function(t,n,e,r,o,u){var i=Cr(n);!function(t,n,e,r){gu(t,n,function(t,n){var o,u,i,c,a,l=(o=n.row,u=e.left()-t.left(),i=n.y-t.top(),c=r,a=yt.fromTag("div"),vn(a,{position:"absolute",left:u+"px",top:i-3.5+"px",height:"7px",width:c+"px"}),ct(a,{"data-row":o,role:"presentation"}),a);return Yo(l,su),l})}(t,0<e.length?o.positions(e,n):[],i,Er(n)),function(t,n,e,r){gu(t,n,function(t,n){var o,u,i,c,a,l=(o=n.col,u=n.x-t.left(),i=e.top()-t.top(),c=r,a=yt.fromTag("div"),vn(a,{position:"absolute",left:u-3.5+"px",top:i+"px",height:c+"px",width:"7px"}),ct(a,{"data-column":o,role:"presentation"}),a);return Yo(l,du),l})}(t,0<r.length?u.positions(r,n):[],i,Ar(n))}(t,n,$r(o),Ur(o),e,r)},hu=function(t,n){var e=zn(t.parent(),"."+fu);M(e,n)},vu=function(t){hu(t,function(t){hn(t,"display","none")})},bu=function(t){hu(t,function(t){hn(t,"display","block")})},wu=lu("resizer-bar-dragging"),yu=function(n,e,r){var o=function(){var t,n=jo({drag:Wo(["xDelta","yDelta","target"])}),e=h.none(),r={mutate:function(n,e){t.trigger.drag(n,e)},events:(t=jo({drag:Wo(["xDelta","yDelta"])})).registry};return r.events.drag.bind(function(t){e.each(function(e){n.trigger.drag(t.xDelta(),t.yDelta(),e)})}),{assign:function(t){e=h.some(t)},get:function(){return e},mutate:r.mutate,events:n.registry}}(),i=function(n,e){return void 0===e&&(e={}),function(n,e,r){var o,u,i=!1,c=jo({start:Wo([]),stop:Wo([])}),a=cu(),l=function(){d.stop(),a.isOn()&&(a.off(),c.trigger.stop())},f=(o=l,u=null,{cancel:function(){null!==u&&(t.clearTimeout(u),u=null)},throttle:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];null!==u&&t.clearTimeout(u),u=t.setTimeout(function(){o.apply(null,n),u=null},200)}});a.events.move.bind(function(t){e.mutate(n,t.info())});var s=function(t){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];i&&t.apply(null,n)}},d=e.sink(uu({forceDrop:l,drop:s(l),move:s(function(t){f.cancel(),a.onEvent(t,e)}),delayDrop:s(f.throttle)}),r);return{element:d.element,go:function(t){d.start(t),a.on(),c.trigger.start()},on:function(){i=!0},off:function(){i=!1},destroy:function(){d.destroy()},events:c.registry}}(n,void 0!==e.mode?e.mode:iu,e)}(o,{}),c=h.none(),a=function(t,n){return h.from(at(t,n))};o.events.drag.bind(function(t){a(t.target(),"data-row").each(function(n){var e=Yn(t.target(),"top");hn(t.target(),"top",e+t.yDelta()+"px")}),a(t.target(),"data-column").each(function(n){var e=Yn(t.target(),"left");hn(t.target(),"left",e+t.xDelta()+"px")})});var l=function(t,n){return Yn(t,n)-Kn(t,"data-initial-"+n,0)};i.events.stop.bind(function(){o.get().each(function(t){c.each(function(o){a(t,"data-row").each(function(n){var e=l(t,"top");st(t,"data-initial-top"),g.trigger.adjustHeight(o,e,parseInt(n,10))}),a(t,"data-column").each(function(n){var e=l(t,"left");st(t,"data-initial-left"),g.trigger.adjustWidth(o,e,parseInt(n,10))}),pu(n,o,r,e)})})});var f=function(t,e){g.trigger.startAdjust(),o.assign(t),it(t,"data-initial-"+e,Yn(t,e)),Yo(t,wu),hn(t,"opacity","0.2"),i.go(n.parent())},s=Ko(n.parent(),"mousedown",function(t){var n,e;n=t.target(),Jo(n,su)&&f(t.target(),"top"),e=t.target(),Jo(e,du)&&f(t.target(),"left")}),d=function(t){return Jt(t,n.view())},m=Ko(n.view(),"mouseover",function(t){(function(t){return Un(t,"table",d).filter(function(t){return Un(t,"[contenteditable]",d).exists(au)})})(t.target()).fold(function(){mn(t.target())&&mu(n)},function(t){c=h.some(t),pu(n,t,r,e)})}),g=jo({adjustHeight:Wo(["table","delta","row"]),adjustWidth:Wo(["table","delta","column"]),startAdjust:Wo([])});return{destroy:function(){s.unbind(),m.unbind(),i.destroy(),mu(n)},refresh:function(t){pu(n,t,r,e)},on:i.on,off:i.off,hideBars:u(vu,n),showBars:u(bu,n),events:g.registry}},Su=function(t,n,e){var o=Hr,u=yu(t,n,o),i=jo({beforeResize:Wo(["table"]),afterResize:Wo(["table"]),startDrag:Wo([])});return u.events.adjustHeight.bind(function(t){var n=t.table();i.trigger.beforeResize(n),function(t,n,e,o){var u,i,c,a=le(t),l=Co(a,o,lo,function(t){return t.getOrThunk(Qn)}),f=I(l,function(t,r){return e===r?Math.max(n+t,Qn()):t}),s=(u=f,i=ge(a),I(i,function(t){var n=Lo(t.row(),t.row()+t.rowspan(),u);return{element:t.element,height:r(n),rowspan:t.rowspan}})),d=(c=f,I(a.all,function(t,n){return{element:t.element,height:r(c[n])}}));M(d,function(t){ro(t.element(),t.height())}),M(s,function(t){ro(t.element(),t.height())});var m=N(f,function(t,n){return t+n},0);ro(t,m)}(n,o.delta(t.delta(),n),t.row(),o),i.trigger.afterResize(n)}),u.events.startAdjust.bind(function(t){i.trigger.startDrag()}),u.events.adjustWidth.bind(function(t){var o=t.table();i.trigger.beforeResize(o);var u,c,a,l,f,s,d,m,g,p,h,v=n.delta(t.delta(),o),b=e(o);u=o,c=v,a=t.column(),l=n,s=(f=b).getCellDelta(c),d=le(u),g=function(t,n,e,o){var u,i,c=t.slice(0),a=(i=n,0===(u=t).length?Fo.none():1===u.length?Fo.only(0):0===i?Fo.left(0,1):i===u.length-1?Fo.right(i-1,i):0<i&&i<u.length-1?Fo.middle(i-1,i,i+1):Fo.none()),l=function(t){return I(t,r(0))},f=r(l(c)),s=function(t,n){if(0<=e){var r=Math.max(o.minCellWidth(),c[n]-e);return l(c.slice(0,t)).concat([e,r-c[n]]).concat(l(c.slice(n+1)))}var u=Math.max(o.minCellWidth(),c[t]+e),i=c[t]-u;return l(c.slice(0,t)).concat([u-c[t],i]).concat(l(c.slice(n+1)))},d=s;return a.fold(f,function(t){return o.singleColumnWidth(c[t],e)},d,function(t,n,e){return s(n,e)},function(t,n){if(0<=e)return l(c.slice(0,n)).concat([e]);var r=Math.max(o.minCellWidth(),c[n]+e);return l(c.slice(0,n)).concat([r-c[n]])})}(m=f.getWidths(d,l,f),a,s,f),p=I(g,function(t,n){return t+m[n]}),h=Ho(d,p),M(h,function(t){f.setElementWidth(t.element,t.width)}),a===d.grid.columns()-1&&f.adjustTableWidth(s),i.trigger.afterResize(o)}),{on:u.on,off:u.off,hideBars:u.hideBars,showBars:u.showBars,destroy:u.destroy,events:i.registry}},Cu=function(t,n){return t.fire("newrow",{node:n})},xu=function(t,n){return t.fire("newcell",{node:n})},Tu=function(t,n,e,r,o){t.fire("TableSelectionChange",{cells:n,start:e,finish:r,otherCells:o})},Ru=function(t){t.fire("TableSelectionClear")},Ou={"border-collapse":"collapse",width:"100%"},Du={border:"1"},Au=function(t){return t.getParam("table_sizing_mode","auto")},Bu=function(t){return t.getParam("table_responsive_width")},Pu=function(t){return t.getParam("table_default_attributes",Du,"object")},Eu=function(t){return t.getParam("table_default_styles",function(t){if(ju(t)){var n=t.getBody().offsetWidth;return St(St({},Ou),{width:n+"px"})}return zu(t)?function(t,n){var r,o,u,i,c={};return r=n,i=c,o=function(t,n){i[n]=t},u=e,K(t,function(t,n){(r(t,n)?o:u)(t,n)}),c}(Ou,function(t,n){return"width"!==n}):Ou}(t),"object")},Iu=function(t){return t.getParam("table_tab_navigation",!0,"boolean")},Mu=function(t){return t.getParam("table_cell_advtab",!0,"boolean")},ku=function(t){return t.getParam("table_row_advtab",!0,"boolean")},Nu=function(t){return t.getParam("table_advtab",!0,"boolean")},_u=function(t){return t.getParam("table_style_by_css",!1,"boolean")},Wu=function(t){return"relative"===Au(t)||!0===Bu(t)},ju=function(t){return"fixed"===Au(t)||!1===Bu(t)},zu=function(t){return"responsive"===Au(t)},Fu=function(t){var n="section",e=t.getParam("table_header_type",n,"string");return B(["section","cells","sectionCells","auto"],e)?e:n},Lu=function(t){var n=t.getParam("table_clone_elements");return w(n)?h.some(n.split(/[ ,]/)):Array.isArray(n)?h.some(n):h.none()},Hu=function(t){return t.nodeName.toLowerCase()},qu=function(t){return yt.fromDom(t.getBody())},Vu=function(t){return t.getBoundingClientRect().width},Uu=function(t){return t.getBoundingClientRect().height},Ku=function(t){return function(n){return Jt(n,qu(t))}},$u=function(t){return/^\d+(\.\d+)?$/.test(t)?t+"px":t},Xu=function(t){st(t,"data-mce-style"),M(ee(t),function(t){return st(t,"data-mce-style")})},Gu=function(t,n){var e=t.dom.getStyle(n,"width")||t.dom.getAttrib(n,"width");return h.from(e).filter(vt)},Yu=function(t){return/^(\d+(\.\d+)?)%$/.test(t)},Ju={isRtl:r(!1)},Qu={isRtl:r(!0)},Zu=function(t){return"rtl"==("rtl"===bn(t,"direction")?"rtl":"ltr")?Qu:Ju},ti=function(t){var n=t;return{get:function(){return n},set:function(t){n=t}}},ni=function(t,n){var e=ti(parseFloat(t)),r=ti(Pr(n));return{width:e.get,pixelWidth:r.get,getWidths:yo,getCellDelta:function(t){return t/r.get()*100},singleColumnWidth:function(t,n){return[100-t]},minCellWidth:function(){return Jn()/r.get()*100},setElementWidth:eo,adjustTableWidth:function(t){var o=e.get(),u=o+t/100*o;eo(n,u),e.set(u),r.set(Pr(n))},label:"percent"}},ei=function(t,n){var e=ti(t),r=e.get;return{width:r,pixelWidth:r,getWidths:So,getCellDelta:o,singleColumnWidth:function(t,n){return[Math.max(Jn(),t+n)-t]},minCellWidth:Jn,setElementWidth:no,adjustTableWidth:function(t){var o=r()+t;no(n,o),e.set(o)},label:"pixel"}},ri=function(t){return uo(t).fold(function(){return function(t){var n=function(){return Pr(t)},o=r(0);return{width:n,pixelWidth:n,getWidths:So,getCellDelta:o,singleColumnWidth:r([0]),minCellWidth:o,setElementWidth:e,adjustTableWidth:e,label:"none"}}(t)},function(n){return function(t,n){var e=mo().exec(n);if(null!==e)return ni(e[1],t);var r=go().exec(n);if(null!==r){var o=parseInt(r[1],10);return ei(o,t)}var u=Pr(t);return ei(u,t)}(t,n)})},oi=ei,ui=ni,ii=function(t,n){if(Wu(t)){var e=Gu(t,n.dom()).filter(Yu).getOrThunk(function(){return ko(n)});return ui(e,n)}return ju(t)?oi(Pr(n),n):ri(n)},ci=function(t){st(t,"width")},ai=function(t,n){var e,r,o,u;r=_o(Zu),o=ii(t,n),u=so(e=n),Eo(e,h.some(u),h.none(),r,o),ci(e)},li=function(t,n){!function(t,n,e){var r=Pr(t)+"px";Eo(t,h.some(r),h.none(),n,e),ci(t)}(n,_o(Zu),ii(t,n))},fi=function(t){Sn(t,"width"),M(ee(t),function(t){Sn(t,"width"),ci(t)}),ci(t)},si=function(n){var e,o,u=h.none(),i=h.none(),c=h.none(),a=function(t){return"TABLE"===t.nodeName};return n.on("init",function(){var e,o,a=_o(Zu),l=(e=n).inline?function(t,n){return{parent:r(n),view:r(t),origin:r(yr(0,0))}}(qu(e),function(){var n=yt.fromTag("div");return vn(n,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),Rn(gn(yt.fromDom(t.document)),n),n}()):Tr(yt.fromDom(e.getDoc()));if(c=h.some(l),o=n.getParam("object_resizing",!0),(w(o)?"table"===o:o)&&n.getParam("table_resize_bars",!0,"boolean")){var f=Su(l,a,function(t){return ii(n,t)});f.on(),f.events.startDrag.bind(function(t){u=h.some(n.selection.getRng())}),f.events.beforeResize.bind(function(t){var e,r,o,u,i=t.table().dom();e=n,o=Vu(r=i),u=Uu(i),e.fire("ObjectResizeStart",{target:r,width:o,height:u})}),f.events.afterResize.bind(function(t){var e,r,o,i,c=t.table(),a=c.dom();Xu(c),u.each(function(t){n.selection.setRng(t),n.focus()}),e=n,o=Vu(r=a),i=Uu(a),e.fire("ObjectResized",{target:r,width:o,height:i}),n.undoManager.add()}),i=h.some(f)}}),n.on("ObjectResizeStart",function(t){var r=t.target;if(a(r)){var u=yt.fromDom(r);!Mo(u)&&ju(n)?li(n,u):!Io(u)&&Wu(n)&&ai(n,u),e=t.width,o=Gu(n,r).getOr("")}}),n.on("ObjectResized",function(t){var r=t.target;if(a(r)){var u=yt.fromDom(r);if(""===o||!Yu(o)&&zu(n))ai(n,u);else if(Yu(o)){var i=parseFloat(o.replace("%","")),c=t.width*i/e;hn(u,"width",c+"%")}else M(ee(u),function(t){var n=bn(t,"width");hn(t,"width",n),st(t,"width")});Xu(u)}}),n.on("SwitchMode",function(){i.each(function(t){n.mode.isReadOnly()?t.hideBars():t.showBars()})}),{lazyResize:function(){return i},lazyWire:function(){return c.getOr(Tr(yt.fromDom(n.getBody())))},destroy:function(){i.each(function(t){t.destroy()}),c.each(function(t){var e;e=t,n.inline&&Pn(e.parent())})}}},di=function(t,n){return{element:r(t),offset:r(n)}},mi=function(t,n,e){return t.property().isText(n)&&0===t.property().getText(n).trim().length||t.property().isComment(n)?e(n).bind(function(n){return mi(t,n,e).orThunk(function(){return h.some(n)})}):h.none()},gi=function(t,n){return t.property().isText(n)?t.property().getText(n).length:t.property().children(n).length},pi=function(t,n){var e=mi(t,n,t.query().prevSibling).getOr(n);if(t.property().isText(e))return di(e,gi(t,e));var r=t.property().children(e);return 0<r.length?pi(t,r[r.length-1]):di(e,gi(t,e))},hi=pi,vi=qe(),bi=function(t,n){uo(t).bind(function(t){var n=Qr.exec(t);return null!==n?h.some({width:r(parseFloat(n[1])),unit:r(n[3])}):h.none()}).each(function(e){var r=e.width()/2;fo(t,r,e.unit()),fo(n,r,e.unit())})},wi=function(t){return le(t).grid},yi=function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n},Si=function(t,n,e,r){e===r?st(t,n):it(t,n,e)},Ci=function(t,n,e){t.cells()[n]=e},xi=function(t,n){return Nn(n,t.section())},Ti=function(t,n){var e=t.cells(),r=I(e,n);return Nn(r,t.section())},Ri=function(t,n){return t.cells()[n]},Oi=function(t,n){return Ri(t,n).element()},Di=function(t){return t.cells().length},Ai=function(t,n){if(0===t.length)return 0;var e=t[0];return j(t,function(t){return!n(e.element(),t.element())}).fold(function(){return t.length},function(t){return t})},Bi=function(t,n){var e=I(t,function(t){return I(t.cells(),function(){return!1})});return I(t,function(o,u){var i,c;return i=F(o.cells(),function(o,i){if(!1!==e[u][i])return[];var c,a,l,f,s=function(t,n,e,r){var o,u=t[n].cells().slice(e),i=Ai(u,r),c=(o=e,I(t,function(t){return Ri(t,o)}).slice(n));return{colspan:i,rowspan:Ai(c,r)}}(t,u,i,n);return function(t,n,r,o){for(var u=t;u<t+r;u++)for(var i=n;i<n+o;i++)e[u][i]=!0}(u,i,s.rowspan,s.colspan),[(c=o.element(),a=s.rowspan,l=s.colspan,f=o.isNew(),{element:r(c),rowspan:r(a),colspan:r(l),isNew:r(f)})]}),c=o.section(),{details:r(i),section:r(c)}})},Pi=function(t,n,e){for(var r=[],o=0;o<t.grid.rows();o++){for(var u=[],i=0;i<t.grid.columns();i++){var c=se(t,o,i).map(function(t){return kn(t.element(),e)}).getOrThunk(function(){return kn(n.gap(),!0)});u.push(c)}var a=Nn(u,t.all[o].section());r.push(a)}return r},Ei=function(t,n){return function(t,n){return I(t,function(t){var e,o,u,i,c,a=(e=t.details(),q(e,function(t){return nn(t.element()).map(function(t){var n=nn(t).isNone();return kn(t,n)})}).getOrThunk(function(){return kn(n.row(),!0)}));return o=a.element(),u=t.details(),i=t.section(),c=a.isNew(),{element:r(o),cells:r(u),section:r(i),isNew:r(c)}})}(Bi(t,Jt),n)},Ii=function(t,n){return q(t.all,function(t){return W(t.cells(),function(t){return Jt(n,t.element())})})},Mi=function(t,n,e,o,i){return function(c,a,l,f,s,d){var m=le(a);return n(m,l).map(function(n){var e=Pi(m,f,!1),o=t(e,n,Jt,i(f)),u=Ei(o.grid(),f);return{grid:r(u),cursor:o.cursor}}).fold(function(){return h.none()},function(t){var n=function(t,n){var e=[],r=[],o=H(jn(t,"caption,colgroup")).fold(function(){return u(Tn,t)},function(t){return u(xn,t)}),i=function(n,u){0<n.length?function(n,u){var i=qn(t,u).getOrThunk(function(){var n=yt.fromTag(u,tn(t).dom());return"thead"===u?o(n):Rn(t,n),n});Bn(i);var c=I(n,function(t){t.isNew()&&e.push(t.element());var n=t.element();return Bn(n),M(t.cells(),function(t){t.isNew()&&r.push(t.element()),Si(t.element(),"colspan",t.colspan(),1),Si(t.element(),"rowspan",t.rowspan(),1),Rn(n,t.element())}),n});An(i,c)}(n,u):qn(t,u).each(Pn)},c=[],a=[],l=[];return M(n,function(t){switch(t.section()){case"thead":c.push(t);break;case"tbody":a.push(t);break;case"tfoot":l.push(t)}}),i(c,"thead"),i(a,"tbody"),i(l,"tfoot"),{newRows:e,newCells:r}}(a,t.grid()),i=h.from(d).getOrThunk(function(){return ri(a)});return e(a,t.grid(),s,i),o(a),pu(c,a,Hr,s),h.some({cursor:t.cursor,newRows:r(n.newRows),newCells:r(n.newCells)})})}},ki=function(t,n){return ne(n.element()).bind(function(n){return Ii(t,n)})},Ni=function(t,n){var e=I(n.selection(),function(n){return ne(n).bind(function(n){return Ii(t,n)})}),r=yi(e);return 0<r.length?h.some({cells:r,generators:n.generators,clipboard:n.clipboard}):h.none()},_i=function(t,n){var e=I(n.selection(),function(n){return ne(n).bind(function(n){return Ii(t,n)})}),r=yi(e);return 0<r.length?h.some(r):h.none()},Wi=function(t,n,e,r){for(var o=!0,u=0;u<t.length;u++)for(var i=0;i<Di(t[0]);i++){var c=e(Oi(t[u],i),n);!0===c&&!1===o?Ci(t[u],i,kn(r(),!0)):!0===c&&(o=!1)}return t},ji=function(t){return{is:function(n){return t===n},isValue:d,isError:s,getOr:r(t),getOrThunk:r(t),getOrDie:r(t),or:function(n){return ji(t)},orThunk:function(n){return ji(t)},fold:function(n,e){return e(t)},map:function(n){return ji(n(t))},mapError:function(n){return ji(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return h.some(t)}}},zi=function(t){return{is:s,isValue:s,isError:d,getOr:o,getOrThunk:function(t){return t()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(t){return t},orThunk:function(t){return t()},fold:function(n,e){return n(t)},map:function(n){return zi(t)},mapError:function(n){return zi(n(t))},each:e,bind:function(n){return zi(t)},exists:s,forall:d,toOption:h.none}},Fi={value:ji,error:zi,fromOption:function(t,n){return t.fold(function(){return zi(n)},ji)}},Li=function(t,n){return{rowDelta:0,colDelta:Di(t[0])-Di(n[0])}},Hi=function(t,n){return{rowDelta:t.length-n.length,colDelta:0}},qi=function(t,n){return I(t,function(){return kn(n.cell(),!0)})},Vi=function(t,n,e){return I(t,function(t){return xi(t,t.cells().concat(qi(E(n,o),e)))})},Ui=function(t,n,e){var r=n.colDelta<0?Vi:o;return(n.rowDelta<0?function(t,n,e){return t.concat(E(n,function(){return xi(t[t.length-1],qi(t[t.length-1].cells(),e))}))}:o)(r(t,Math.abs(n.colDelta),e),Math.abs(n.rowDelta),e)},Ki=function(t,n,e,r,o){var u,i,c,a;u=n,i=t,c=o,a=r.cell,0<i&&i<u[0].cells().length&&M(u,function(t){var n=t.cells()[i-1],e=t.cells()[i];c(e.element(),n.element())&&Ci(t,i,kn(a(),!0))});var l=Hi(e,n),f=Ui(e,l,r),s=Hi(n,f),d=Ui(n,s,r);return I(d,function(n,e){var r=n.cells().slice(0,t).concat(f[e].cells()).concat(n.cells().slice(t,n.cells().length));return xi(n,r)})},$i=function(t,n,e,r,o){!function(t,n,e,r){if(0<n&&n<t.length){var o=t[n-1].cells(),u=(i=e,_(o,function(t,n){return P(t,function(t){return i(t.element(),n.element())})?t:t.concat([n])},[]));M(u,function(o){for(var u=h.none(),i=function(n){for(var i=function(i){var c=t[n].cells()[i];e(c.element(),o.element())&&(u.isNone()&&(u=h.some(r())),u.each(function(e){Ci(t[n],i,kn(e,!0))}))},c=0;c<Di(t[0]);c++)i(c)},c=n;c<t.length;c++)i(c)})}var i}(n,t,o,r.cell);var u=Li(e,n),i=Ui(e,u,r),c=Li(n,i),a=Ui(n,c,r);return a.slice(0,t).concat(i).concat(a.slice(t,a.length))},Xi=function(t,n,e,r,o){var u=t.slice(0,n),i=t.slice(n),c=Ti(t[e],function(e,u){return 0<n&&n<t.length&&r(Oi(t[n-1],u),Oi(t[n],u))?Ri(t[n],u):kn(o(e.element(),r),!0)});return u.concat([c]).concat(i)},Gi=function(t,n,e,r,o){return I(t,function(t){var u,i,c,a,l,f,s,d=0<n&&n<Di(t)&&r(Oi(t,n-1),Oi(t,n))?Ri(t,n):kn(o(Oi(t,e),r),!0);return i=n,c=d,l=(a=(u=t).cells()).slice(0,i),f=a.slice(i),s=l.concat([c]).concat(f),xi(u,s)})},Yi=function(t,n,e,r){return I(t,function(t){return Ti(t,function(t){return o=t,P(n,function(t){return e(o.element(),t.element())})?kn(r(t.element(),e),!0):t;var o})})},Ji=function(t,n,e,r){return void 0!==Oi(t[n],e)&&0<n&&r(Oi(t[n-1],e),Oi(t[n],e))},Qi=function(t,n,e){return 0<n&&e(Oi(t,n-1),Oi(t,n))},Zi=function(t,n,e,r){var o=F(t,function(r,o){return Ji(t,o,n,e)||Qi(r,n,e)?[]:[Ri(r,n)]});return Yi(t,o,e,r)},tc=function(t,n,e,r){var o=t[n],u=F(o.cells(),function(r,u){return Ji(t,n,u,e)||Qi(o,u,e)?[]:[r]});return Yi(t,u,e,r)},nc=eu(["cell","row","replace","gap"]),ec=function(t){var n=Kn(t,"colspan",1),e=Kn(t,"rowspan",1);return{element:r(t),colspan:r(n),rowspan:r(e)}},rc=function(t,n){void 0===n&&(n=ec),nc(t);var e=ti(h.none()),r=function(r){var u=function(e){var r;return r=n(e),t.cell(r)}(r);return e.get().isNone()&&e.set(h.some(u)),o=h.some({item:r,replacement:u}),u},o=h.none();return{getOrInit:function(t,n){return o.fold(function(){return r(t)},function(e){return n(t,e.item)?e.replacement:r(t)})},cursor:e.get}},oc=function(t,n){return function(e){var r=ti(h.none());nc(e);var o=[],u=function(u){var i={scope:t},c=e.replace(u,n,i);return o.push({item:u,sub:c}),r.get().isNone()&&r.set(h.some(c)),c};return{replaceOrInit:function(t,n){return e=t,r=n,W(o,function(t){return r(t.item,e)}).fold(function(){return u(t)},function(e){return n(t,e.item)?e.sub:u(t)});var e,r},cursor:r.get}}},uc=function(t){nc(t);var n=ti(h.none());return{combine:function(e){return n.get().isNone()&&n.set(h.some(e)),function(){var n=t.cell({element:r(e),colspan:r(1),rowspan:r(1)});return Sn(n,"width"),Sn(e,"width"),n}},cursor:n.get}},ic=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],cc=qe(),ac=function(t){return n=t,e=cc.property().name(n),B(ic,e);var n,e},lc=function(t){return n=t,e=cc.property().name(n),B(["ol","ul"],e);var n,e},fc=function(t){var n,e=function(t){return"br"===J(t)},r=function(t){return Te(t).bind(function(n){var r=on(n).map(function(t){return!!ac(t)||!!function(t){return n=t,B(["br","img","hr","input"],cc.property().name(n));var n}(t)&&"img"!==J(t)}).getOr(!1);return nn(n).map(function(o){return!0===r||"li"===J(u=o)||Ln(u,lc).isSome()||e(n)||ac(o)&&!Jt(t,o)?[]:[yt.fromTag("br")];var u})}).getOr([])},o=0===(n=F(t,function(t){var n=un(t);return L(n,function(t){return e(t)||et(t)&&0===ve(t).trim().length})?[]:n.concat(r(t))})).length?[yt.fromTag("br")]:n;Bn(t[0]),An(t[0],o)},sc=function(t){0===ee(t).length&&Pn(t)},dc=function(t,n){return{grid:r(t),cursor:r(n)}},mc=function(t,n,e){return gc(t,n,e).orThunk(function(){return gc(t,0,0)})},gc=function(t,n,e){return h.from(t[n]).bind(function(t){return h.from(t.cells()[e]).bind(function(t){return h.from(t.element())})})},pc=function(t,n,e){return dc(t,gc(t,n,e))},hc=function(t){return _(t,function(t,n){return P(t,function(t){return t.row()===n.row()})?t:t.concat([n])},[]).sort(function(t,n){return t.row()-n.row()})},vc=function(t){return _(t,function(t,n){return P(t,function(t){return t.column()===n.column()})?t:t.concat([n])},[]).sort(function(t,n){return t.column()-n.column()})},bc=function(t,n,e){var r,o=(r=e,I(t,function(t){var n=I(ee(t),function(t){var n=Kn(t,"rowspan",1),e=Kn(t,"colspan",1);return In(t,n,e)});return Mn(t,n,r.section())})),u=fe(o);return Pi(u,n,!0)},wc=function(t,n){var e=k(t,n);return 0===e.length?h.some("td"):e.length===t.length?h.some("th"):h.none()},yc=function(t,n,e,r){var o=fe(n),u=r.getWidths(o,e,r),i=Ho(o,u);M(i,function(t){r.setElementWidth(t.element,t.width)})},Sc=Mi(function(t,n,e,r){var o=n[0].row(),u=n[0].row(),i=hc(n),c=_(i,function(t,n){return Xi(t,u,o,e,r.getOrInit)},t);return pc(c,u,n[0].column())},_i,e,e,rc),Cc=Mi(function(t,n,e,r){var o=hc(n),u=o[o.length-1].row(),i=o[o.length-1].row()+o[o.length-1].rowspan(),c=_(o,function(t,n){return Xi(t,i,u,e,r.getOrInit)},t);return pc(c,i,n[0].column())},_i,e,e,rc),xc=Mi(function(t,n,e,r){var o=vc(n),u=o[0].column(),i=o[0].column(),c=_(o,function(t,n){return Gi(t,i,u,e,r.getOrInit)},t);return pc(c,n[0].row(),i)},_i,yc,e,rc),Tc=Mi(function(t,n,e,r){var o=n[n.length-1].column(),u=n[n.length-1].column()+n[n.length-1].colspan(),i=vc(n),c=_(i,function(t,n){return Gi(t,u,o,e,r.getOrInit)},t);return pc(c,n[0].row(),u)},_i,yc,e,rc),Rc=Mi(function(t,n,e,r){var o,u,i,c,a=vc(n),l=(o=t,u=a[0].column(),i=a[a.length-1].column(),c=I(o,function(t){var n=t.cells().slice(0,u).concat(t.cells().slice(i+1));return Nn(n,t.section())}),k(c,function(t){return 0<t.cells().length})),f=mc(l,n[0].row(),n[0].column());return dc(l,f)},_i,yc,sc,rc),Oc=Mi(function(t,n,e,r){var o,u,i,c=hc(n),a=(o=t,u=c[0].row(),i=c[c.length-1].row(),o.slice(0,u).concat(o.slice(i+1))),l=mc(a,n[0].row(),n[0].column());return dc(a,l)},_i,e,sc,rc),Dc=Mi(function(t,n,e,r){var o=Zi(t,n.column(),e,r.replaceOrInit);return pc(o,n.row(),n.column())},ki,e,e,oc("row","th")),Ac=Mi(function(t,n,e,r){var o=Zi(t,n.column(),e,r.replaceOrInit);return pc(o,n.row(),n.column())},ki,e,e,oc(null,"td")),Bc=(Mi(function(t,n,e,r){var o=tc(t,n.row(),e,r.replaceOrInit);return pc(o,n.row(),n.column())},ki,e,e,oc("col","th")),Mi(function(t,n,e,r){var o=tc(t,n.row(),e,r.replaceOrInit);return pc(o,n.row(),n.column())},ki,e,e,oc(null,"td")),Mi(function(t,n,e,o){var u=n.cells();fc(u);var i=function(t,n,e){if(0===t.length)return t;for(var r=n.startRow();r<=n.finishRow();r++)for(var o=n.startCol();o<=n.finishCol();o++)Ci(t[r],o,kn(e(),!1));return t}(t,n.bounds(),r(u[0]));return dc(i,h.from(u[0]))},function(t,n){return n.mergable()},e,e,uc)),Pc=Mi(function(t,n,e,r){var o=N(n,function(t,n){return Wi(t,n,e,r.combine(n))},t);return dc(o,h.from(n[0]))},function(t,n){return n.unmergable()},yc,e,uc),Ec=Mi(function(t,n,e,o){var i,c,a,l,f,s=(i=n.clipboard(),c=n.generators(),a=le(i),Pi(a,c,!0));return function(t,n,e,r,o){return function(t,n,e){if(t.row()>=n.length||t.column()>Di(n[0]))return Fi.error("invalid start address out of table bounds, row: "+t.row()+", column: "+t.column());var r=n.slice(t.row()),o=r[0].cells().slice(t.column()),u=Di(e[0]),i=e.length;return Fi.value({rowDelta:r.length-i,colDelta:o.length-u})}(t,n,e).map(function(i){var c=Ui(n,i,r);return function(t,n,e,r,o){for(var i,c,a,l,f,s=t.row(),d=t.column(),m=s+e.length,g=d+Di(e[0]),p=s;p<m;p++)for(var h=d;h<g;h++){a=h,f=l=void 0,l=u(o,Ri((i=n)[c=p],a).element()),f=i[c],1<i.length&&1<Di(f)&&(0<a&&l(Oi(f,a-1))||a<f.cells().length-1&&l(Oi(f,a+1))||0<c&&l(Oi(i[c-1],a))||c<i.length-1&&l(Oi(i[c+1],a)))&&Wi(n,Oi(n[p],h),o,r.cell);var v=Oi(e[p-s],h-d),b=r.replace(v);Ci(n[p],h,kn(b,!0))}return n}(t,c,e,r,o)})}((l=n.row(),f=n.column(),{row:r(l),column:r(f)}),t,s,n.generators(),e).fold(function(){return dc(t,h.some(n.element()))},function(t){var e=mc(t,n.row(),n.column());return dc(t,e)})},function(t,n){return ne(n.element()).bind(function(e){return Ii(t,e).map(function(t){return St(St({},t),{generators:n.generators,clipboard:n.clipboard})})})},yc,e,rc),Ic=Mi(function(t,n,e,r){var o=t[n.cells[0].row()],u=n.cells[0].column(),i=bc(n.clipboard(),n.generators(),o),c=Ki(u,t,i,n.generators(),e),a=mc(c,n.cells[0].row(),n.cells[0].column());return dc(c,a)},Ni,e,e,rc),Mc=Mi(function(t,n,e,r){var o=t[n.cells[0].row()],u=n.cells[n.cells.length-1].column()+n.cells[n.cells.length-1].colspan(),i=bc(n.clipboard(),n.generators(),o),c=Ki(u,t,i,n.generators(),e),a=mc(c,n.cells[0].row(),n.cells[0].column());return dc(c,a)},Ni,e,e,rc),kc=Mi(function(t,n,e,r){var o=t[n.cells[0].row()],u=n.cells[0].row(),i=bc(n.clipboard(),n.generators(),o),c=$i(u,t,i,n.generators(),e),a=mc(c,n.cells[0].row(),n.cells[0].column());return dc(c,a)},Ni,e,e,rc),Nc=Mi(function(t,n,e,r){var o=t[n.cells[0].row()],u=n.cells[n.cells.length-1].row()+n.cells[n.cells.length-1].rowspan(),i=bc(n.clipboard(),n.generators(),o),c=$i(u,t,i,n.generators(),e),a=mc(c,n.cells[0].row(),n.cells[0].column());return dc(c,a)},Ni,e,e,rc),_c=function(t,n){var e=le(t);return _i(e,n).bind(function(t){var n=t[t.length-1],r=t[0].column(),o=n.column()+n.colspan(),u=z(I(e.all,function(t){return k(t.cells(),function(t){return t.column()>=r&&t.column()<o})}));return wc(u,function(t){return"th"===J(t.element())})}).getOr("")},Wc=function(t){return Hu(t.parentNode)},jc=function(t,n){var e="thead"===Wc(n),r=!P(n.cells,function(t){return"th"!==Hu(t)});return e||r?h.some({thead:e,ths:r}):h.none()},zc=function(t,n){return"thead"===(e=jc(0,n).fold(function(){return Wc(n)},function(t){return"thead"}))?"header":"tfoot"===e?"footer":"body";var e},Fc=function(t,n,e){var r=t.getParent(n,"table"),o=n.parentNode,u=Hu(o);if(e!==u){var i=t.select(e,r)[0];if(!i){i=t.create(e);var c=r.firstChild;"thead"===e?H(jn(yt.fromDom(r),"caption,colgroup")).fold(function(){return r.insertBefore(i,c)},function(n){return t.insertAfter(i,n.dom())}):r.appendChild(i)}"tbody"===e&&"thead"===u&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),o.hasChildNodes()||t.remove(o)}},Lc=function(t,n,e,r){return M(n,function(n){var o=Hu(n)!==e?t.rename(n,e):n;t.setAttrib(o,"scope",r)})},Hc=function(t,n,e){var r,o=t.dom;if("header"===e){var u=Fu(t),i="auto"===u?(r=re(yt.fromDom(n.cells[0])).map(function(t){return oe(t)}).getOr([]),q(r,function(t){return jc(0,t.dom())}).map(function(t){return t.thead&&t.ths?"sectionCells":t.thead?"section":"cells"}).getOr("section")):u;Lc(o,n.cells,"section"===i?"td":"th","col"),Fc(o,n,"cells"===i?"tbody":"thead")}else Lc(o,n.cells,"td",null),Fc(o,n,"footer"===e?"tfoot":"tbody")},qc=function(t){return{get:function(){var n=qu(t);return Je(n,er).fold(function(){return void 0===t.selection.getStart()?dr():gr(t.selection)},function(t){return mr(t)})}}},Vc=function(t){return function(n){return h.from(n.dom.getParent(n.selection.getStart(),t)).map(function(t){return yt.fromDom(t)})}},Uc=Vc("th,td"),Kc=Vc("th,td,caption"),$c=function(t){return Uc(t).map(function(n){return pr(n,qc(t))}).map(function(t){return I(t,function(t){return t.dom()})}).getOr([])},Xc=function(t){var n,e,r,o=Uc(t);return e=o.bind(function(t){return re(t)}).map(function(t){return oe(t)}).map(function(t){return I(t,function(t){return t.dom()})}),r=function(n,e){return k(e,function(e){return P(e.cells,function(e){return"1"===t.dom.getAttrib(e,nr)||e===n.dom()})})},((n=o).isSome()&&e.isSome()?h.some(r(n.getOrDie(),e.getOrDie())):h.none()).getOr([])},Gc=function(t,n){var r=function(t){return"table"===J(qu(t))},o=Lu(t),u=function(n,e,r,u){return function(i,c){Xu(i);var a=u(),l=yt.fromDom(t.getDoc()),f=_o(Zu),s=Me(r,l,o),d=ii(t,i);return e(i)?n(a,i,c,s,f,d).bind(function(n){return M(n.newRows(),function(n){Cu(t,n.dom())}),M(n.newCells(),function(n){xu(t,n.dom())}),n.cursor().map(function(n){var e=hi(vi,n),r=t.dom.createRng();return r.setStart(e.element().dom(),e.offset()),r.setEnd(e.element().dom(),e.offset()),r})}):h.none()}},i=u(Oc,function(n){return!1===r(t)||1<wi(n).rows()},e,n),c=u(Rc,function(n){return!1===r(t)||1<wi(n).columns()},e,n),a=u(Sc,d,e,n),l=u(Cc,d,e,n),f=u(xc,d,bi,n),s=u(Tc,d,bi,n),m=u(Bc,d,e,n),g=u(Pc,d,e,n),p=u(Ic,d,e,n),v=u(Mc,d,e,n),b=u(kc,d,e,n),w=u(Nc,d,e,n),y=u(Ec,d,e,n),S=function(t,n){return G(t,"type").filter(function(t){return B(n,t)})};return{deleteRow:i,deleteColumn:c,insertRowsBefore:a,insertRowsAfter:l,insertColumnsBefore:f,insertColumnsAfter:s,mergeCells:m,unmergeCells:g,pasteColsBefore:p,pasteColsAfter:v,pasteRowsBefore:b,pasteRowsAfter:w,pasteCells:y,setTableCellType:function(t,n){return S(n,["td","th"]).each(function(n){Lc(t.dom,$c(t),n,null)})},setTableRowType:function(t,n){return S(n,["header","body","footer"]).each(function(n){I(Xc(t),function(e){return Hc(t,e,n)})})},makeColumnHeader:u(Dc,d,e,n),unmakeColumnHeader:u(Ac,d,e,n),getTableRowType:function(t){var n=Xc(t);if(0<n.length){var e=I(n,function(t){return zc(0,t)}),r=B(e,"header"),o=B(e,"footer");if(r||o){var u=B(e,"body");return!r||u||o?r||u||!o?"":"footer":"header"}return"body"}},getTableCellType:function(t){return wc($c(t),function(t){return"th"===Hu(t)}).getOr("")},getTableColType:_c}},Yc={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"}},Jc=function(t,n,e,r){return E(t,function(t){return function(t,n,e,r){for(var o=yt.fromTag("tr"),u=0;u<t;u++){var i=r<n||u<e?yt.fromTag("th"):yt.fromTag("td");u<e&&it(i,"scope","row"),r<n&&it(i,"scope","col"),Rn(i,yt.fromTag("br")),Rn(o,i)}return o}(n,e,r,t)})},Qc=function(t,n){t.selection.select(n.dom(),!0),t.selection.collapse(!0)},Zc=function(t,n,e,r,o){var i=Eu(t),c={styles:i,attributes:Pu(t)},a=function(t,n,e,r,o,u){void 0===u&&(u=Yc);var i=yt.fromTag("table"),c="cells"!==o;vn(i,u.styles),ct(i,u.attributes);var a=Math.min(t,e);if(c&&0<e){var l=yt.fromTag("thead");Rn(i,l);var f=Jc(e,n,"sectionCells"===o?a:0,r);An(l,f)}var s=yt.fromTag("tbody");Rn(i,s);var d=Jc(c?t-a:t,n,c?0:e,r);return An(s,d),i}(e,n,o,r,Fu(t),c);it(a,"data-mce-id","__mce");var l,f,s,d=(l=a,f=yt.fromTag("div"),s=yt.fromDom(l.dom().cloneNode(!0)),Rn(f,s),f.dom().innerHTML);return t.insertContent(d),Vn(qu(t),'table[data-mce-id="__mce"]').map(function(n){var e,r,o;return ju(t)?li(t,n):zu(t)?fi(n):(Wu(t)||(e=i.width,w(e)&&-1!==e.indexOf("%")))&&ai(t,n),Xu(n),st(n,"data-mce-id"),r=t,M(zn(n,"tr"),function(t){Cu(r,t.dom()),M(zn(t,"th,td"),function(t){xu(r,t.dom())})}),o=t,Vn(n,"td,th").each(u(Qc,o)),n.dom()}).getOr(null)},ta=function(t,n,e,r,o){void 0===r&&(r={});var u=function(t){return R(t)&&0<t};if(u(n)&&u(e)){var i=r.headerRows||0,c=r.headerColumns||0;return Zc(t,e,n,c,i)}return console.error(o),null},na=function(t){return function(){return t().fold(function(){return[]},function(t){return I(t,function(t){return t.dom()})})}},ea=function(t){return function(n){var e=0<n.length?h.some(I(n,yt.fromDom)):h.none();t(e)}},ra=function(t,n,e,r){return{insertTable:function(n,e,r){return void 0===r&&(r={}),ta(t,e,n,r,"Invalid values for insertTable - rows and columns values are required to insert a table.")},setClipboardRows:ea(n.setRows),getClipboardRows:na(n.getRows),setClipboardCols:ea(n.setColumns),getClipboardCols:na(n.getColumns),resizeHandler:e,selectionTargets:r}},oa=tinymce.util.Tools.resolve("tinymce.util.Tools"),ua=function(t,n,e){return function(n,r){for(var o=0;o<r.length;o++){var u=t.getStyle(r[o],e);if(void 0===n&&(n=u),n!==u)return""}return n}(void 0,t.select("td,th",n))},ia=function(t,n,e){e&&t.formatter.apply("align"+e,{},n)},ca=function(t,n){oa.each("left center right".split(" "),function(e){t.formatter.remove("align"+e,{},n)})},aa=function(t,n){return(n||[]).concat(I(t,function(t){return{text:t.text||t.title,value:t.value}}))},la=function(t){return function(n){return mt(n,"rgb",0)?t.toHex(n):n}},fa=function(t,n){var e=yt.fromDom(n);return{borderwidth:yn(e,"border-width").getOr(""),borderstyle:yn(e,"border-style").getOr(""),bordercolor:yn(e,"border-color").map(la(t)).getOr(""),backgroundcolor:yn(e,"background-color").map(la(t)).getOr("")}},sa=function(t){var n=t[0],e=t.slice(1);return M(e,function(t){M(V(n),function(e){K(t,function(t,r){var o=n[e];""!==o&&e===r&&o!==t&&(n[e]="")})})}),n},da=function(t){var n=[{name:"borderstyle",type:"selectbox",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]},{name:"bordercolor",type:"colorinput",label:"Border color"},{name:"backgroundcolor",type:"colorinput",label:"Background color"}];return{title:"Advanced",name:"advanced",items:"cell"===t?[{name:"borderwidth",type:"input",label:"Border width"}].concat(n):n}},ma=function(t,n,e,r){return W(t,function(t){return e.formatter.matchNode(r,n+t)}).getOr("")},ga=u(ma,["left","center","right"],"align"),pa=u(ma,["top","middle","bottom"],"valign"),ha=[{name:"width",type:"input",label:"Width"},{name:"height",type:"input",label:"Height"},{name:"celltype",type:"selectbox",label:"Cell type",items:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{name:"scope",type:"selectbox",label:"Scope",items:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{name:"halign",type:"selectbox",label:"H Align",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{name:"valign",type:"selectbox",label:"V Align",items:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}],va=function(t){return(0<(n=aa(t.getParam("table_cell_class_list",[],"array"))).length?h.some({name:"class",type:"selectbox",label:"Class",items:n}):h.none()).fold(function(){return ha},function(t){return ha.concat(t)});var n},ba=function(t){return function(n,e){var r=n.dom;return{setAttrib:function(n,o){t&&!o||r.setAttrib(e,n,o)},setStyle:function(n,o){t&&!o||r.setStyle(e,n,o)},setFormat:function(r,o){t&&!o||(""===o?n.formatter.remove(r,{value:null},e,!0):n.formatter.apply(r,{value:o},e))}}}},wa={normal:ba(!1),ifTruthy:ba(!0)},ya=function(t,n,e){var r=e.getData();e.close(),t.undoManager.transact(function(){(function(t,n,e){var r=t.dom,o=1===n.length;M(n,function(n){var u,i,c,a,l,f,s,d,m,g=e.celltype&&Hu(n)!==e.celltype?r.rename(n,e.celltype):n,p=o?wa.normal(t,g):wa.ifTruthy(t,g);i=e,(u=p).setAttrib("scope",i.scope),u.setAttrib("class",i.class),u.setStyle("width",$u(i.width)),u.setStyle("height",$u(i.height)),Mu(t)&&(a=e,(c=p).setFormat("tablecellbackgroundcolor",a.backgroundcolor),c.setFormat("tablecellbordercolor",a.bordercolor),c.setFormat("tablecellborderstyle",a.borderstyle),c.setFormat("tablecellborderwidth",$u(a.borderwidth))),o&&(ca(t,g),l=t,f=g,oa.each("top middle bottom".split(" "),function(t){l.formatter.remove("valign"+t,{},f)})),e.halign&&ia(t,g,e.halign),e.valign&&(s=t,d=g,(m=e.valign)&&s.formatter.apply("valign"+m,{},d))})})(t,n,r),t.focus()})},Sa=function(t){var n=$c(t);if(0!==n.length){var e=I(n,function(n){return r=n,o=Mu(e=t),u=e.dom,St({width:u.getStyle(r,"width")||u.getAttrib(r,"width"),height:u.getStyle(r,"height")||u.getAttrib(r,"height"),scope:u.getAttrib(r,"scope"),celltype:Hu(r),class:u.getAttrib(r,"class",""),halign:ga(e,r),valign:pa(e,r)},o?fa(u,r):{});var e,r,o,u}),r=sa(e),o={type:"tabpanel",tabs:[{title:"General",name:"general",items:va(t)},da("cell")]},i={type:"panel",items:[{type:"grid",columns:2,items:va(t)}]};t.windowManager.open({title:"Cell Properties",size:"normal",body:Mu(t)?o:i,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:r,onSubmit:u(ya,t,n)})}},Ca=[{type:"selectbox",name:"type",label:"Row type",items:[{text:"Header",value:"header"},{text:"Body",value:"body"},{text:"Footer",value:"footer"}]},{type:"selectbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height",type:"input"}],xa=function(t){return(0<(n=aa(t.getParam("table_row_class_list",[],"array"))).length?h.some({name:"class",type:"selectbox",label:"Class",items:n}):h.none()).fold(function(){return Ca},function(t){return Ca.concat(t)});var n},Ta=function(t,n,e,r){var o=r.getData();r.close(),t.undoManager.transact(function(){(function(t,n,e,r){var o=1===n.length;M(n,function(n){r.type!==Hu(n.parentNode)&&Hc(t,n,r.type);var u,i,c,a,l=o?wa.normal(t,n):wa.ifTruthy(t,n);i=r,(u=l).setAttrib("scope",i.scope),u.setAttrib("class",i.class),u.setStyle("height",$u(i.height)),ku(t)&&(a=r,(c=l).setStyle("background-color",a.backgroundcolor),c.setStyle("border-color",a.bordercolor),c.setStyle("border-style",a.borderstyle)),r.align!==e.align&&(ca(t,n),ia(t,n,r.align))})})(t,n,e,o),t.focus()})},Ra=function(t){var n=Xc(t);if(0!==n.length){var e=I(n,function(n){return r=n,o=ku(e=t),u=e.dom,St({height:u.getStyle(r,"height")||u.getAttrib(r,"height"),scope:u.getAttrib(r,"scope"),class:u.getAttrib(r,"class",""),type:zc(0,r),align:ga(e,r)},o?fa(u,r):{});var e,r,o,u}),r=sa(e),o={type:"tabpanel",tabs:[{title:"General",name:"general",items:xa(t)},da("row")]},i={type:"panel",items:[{type:"grid",columns:2,items:xa(t)}]};t.windowManager.open({title:"Row Properties",size:"normal",body:ku(t)?o:i,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:r,onSubmit:u(Ta,t,n,r)})}},Oa=tinymce.util.Tools.resolve("tinymce.Env"),Da=function(t,n,e,r){if("TD"===n.tagName||"TH"===n.tagName)w(e)?t.setStyle(n,e,r):t.setStyle(n,e);else if(n.children)for(var o=0;o<n.children.length;o++)Da(t,n.children[o],e,r)},Aa=function(t,n,e){var r,o=t.dom,u=e.getData();e.close(),""===u.class&&delete u.class,t.undoManager.transact(function(){if(!n){var e=parseInt(u.cols,10)||1,i=parseInt(u.rows,10)||1;n=Zc(t,e,i,0,0)}!function(t,n,e){var r,o=t.dom,u={},i={};if(u.class=e.class,i.height=$u(e.height),o.getAttrib(n,"width")&&!_u(t)?u.width=(r=e.width)?r.replace(/px$/,""):"":i.width=$u(e.width),_u(t)?(i["border-width"]=$u(e.border),i["border-spacing"]=$u(e.cellspacing)):(u.border=e.border,u.cellpadding=e.cellpadding,u.cellspacing=e.cellspacing),_u(t)&&n.children)for(var c=0;c<n.children.length;c++)Da(o,n.children[c],{"border-width":$u(e.border),padding:$u(e.cellpadding)}),Nu(t)&&Da(o,n.children[c],{"border-color":e.bordercolor});Nu(t)&&(i["background-color"]=e.backgroundcolor,i["border-color"]=e.bordercolor,i["border-style"]=e.borderstyle),u.style=o.serializeStyle(St(St({},Eu(t)),i)),o.setAttribs(n,St(St({},Pu(t)),u))}(t,n,u),(r=o.select("caption",n)[0])&&!u.caption&&o.remove(r),!r&&u.caption&&((r=o.create("caption")).innerHTML=Oa.ie?"Â ":'<br data-mce-bogus="1"/>',n.insertBefore(r,n.firstChild)),""===u.align?ca(t,n):ia(t,n,u.align),t.focus(),t.addVisual()})},Ba=function(t,n){var e,r,o,i,c,a,l,f,s=t.dom,d=function(t,n){var e,r,o,u,i=Eu(t),c=Pu(t),a=n?(e=t.dom,{borderstyle:G(i,"border-style").getOr(""),bordercolor:la(e)(G(i,"border-color").getOr("")),backgroundcolor:la(e)(G(i,"background-color").getOr(""))}):{};return St(St(St(St(St(St({},{height:"",width:"100%",cellspacing:"",cellpadding:"",caption:!1,class:"",align:"",border:""}),i),c),a),(u=i["border-width"],_u(t)&&u?{border:u}:G(c,"border").fold(function(){return{}},function(t){return{border:t}}))),(r=G(i,"border-spacing").or(G(c,"cellspacing")).fold(function(){return{}},function(t){return{cellspacing:t}}),o=G(i,"border-padding").or(G(c,"cellpadding")).fold(function(){return{}},function(t){return{cellpadding:t}}),St(St({},r),o)))}(t,Nu(t));!1===n?(e=s.getParent(t.selection.getStart(),"table"))?(o=e,i=Nu(r=t),f=r.dom,d=St({width:f.getStyle(o,"width")||f.getAttrib(o,"width"),height:f.getStyle(o,"height")||f.getAttrib(o,"height"),cellspacing:f.getStyle(o,"border-spacing")||f.getAttrib(o,"cellspacing"),cellpadding:f.getAttrib(o,"cellpadding")||ua(r.dom,o,"padding"),border:(c=f,a=o,l=yn(yt.fromDom(a),"border-width"),_u(r)&&l.isSome()?l.getOr(""):c.getAttrib(a,"border")||ua(r.dom,a,"border-width")||ua(r.dom,a,"border")),caption:!!f.select("caption",o)[0],class:f.getAttrib(o,"class",""),align:ga(r,o)},i?fa(f,o):{})):Nu(t)&&(d.borderstyle="",d.bordercolor="",d.backgroundcolor=""):(d.cols="1",d.rows="1",Nu(t)&&(d.borderstyle="",d.bordercolor="",d.backgroundcolor=""));var m=aa(t.getParam("table_class_list",[],"array"));0<m.length&&d.class&&(d.class=d.class.replace(/\s*mce\-item\-table\s*/g,""));var g,p,h,v,b={type:"grid",columns:2,items:(g=m,p=n?[{type:"input",name:"cols",label:"Cols",inputMode:"numeric"},{type:"input",name:"rows",label:"Rows",inputMode:"numeric"}]:[],h=t.getParam("table_appearance_options",!0,"boolean")?[{type:"input",name:"cellspacing",label:"Cell spacing",inputMode:"numeric"},{type:"input",name:"cellpadding",label:"Cell padding",inputMode:"numeric"},{type:"input",name:"border",label:"Border width"},{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[],v=0<g.length?[{type:"selectbox",name:"class",label:"Class",items:g}]:[],p.concat([{type:"input",name:"width",label:"Width"},{type:"input",name:"height",label:"Height"}]).concat(h).concat([{type:"selectbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]).concat(v))},w=Nu(t)?{type:"tabpanel",tabs:[{title:"General",name:"general",items:[b]},da("table")]}:{type:"panel",items:[b]};t.windowManager.open({title:"Table Properties",size:"normal",body:w,onSubmit:u(Aa,t,e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:d})},Pa=function(t,n,o,i,c){var a=Ku(t),l=function(t){return re(t,a)},s=function(n){return Uc(t).each(function(e){l(e).each(function(r){var u=vr(i,r,e);n(r,u).each(function(n){t.selection.setRng(n),t.focus(),o.clear(r),Xu(r)})})})},d=function(){return Uc(t).map(function(n){return l(n).bind(function(r){return function(t,n,e){var r=le(t);return _i(r,n).map(function(t){var n=Pi(r,e,!1).slice(t[0].row(),t[t.length-1].row()+t[t.length-1].rowspan()),o=Ei(n,e);return I(o,function(t){var n=De(t.element());return M(t.cells(),function(t){var e=Ae(t.element());Si(e,"colspan",t.colspan(),1),Si(e,"rowspan",t.rowspan(),1),Rn(n,e)}),n})})}(r,vr(i,r,n),Me(e,yt.fromDom(t.getDoc()),h.none()))})})},m=function(){return Uc(t).map(function(t){return l(t).bind(function(n){return function(t,n){var e=le(t);return _i(e,n).map(function(t){var n=t[t.length-1],r=t[0].column(),o=n.column()+n.colspan();return I(e.all,function(t){var n=k(t.cells(),function(t){return t.column()>=r&&t.column()<o}),e=I(n,function(t){var n,e,u,i,c=Ae(t.element());return u=o-r,i=$n(n=c,e="colspan"),1===u||i<=1?st(n,e):it(n,e,Math.min(u,i)),c}),u=yt.fromTag("tr");return An(u,e),u})})}(n,vr(i,n,t))})})},g=function(n,e){return e().each(function(e){var u=I(e,function(t){return Ae(t)});Uc(t).each(function(e){return l(e).each(function(c){var a,l,f=ke(yt.fromDom(t.getDoc())),s=(a=u,l=f,{selection:r(pr(e,i)),clipboard:r(a),generators:r(l)});n(c,s).each(function(n){t.selection.setRng(n),t.focus(),o.clear(c)})})})})};K({mceTableSplitCells:function(){return s(n.unmergeCells)},mceTableMergeCells:function(){return s(n.mergeCells)},mceTableInsertRowBefore:function(){return s(n.insertRowsBefore)},mceTableInsertRowAfter:function(){return s(n.insertRowsAfter)},mceTableInsertColBefore:function(){return s(n.insertColumnsBefore)},mceTableInsertColAfter:function(){return s(n.insertColumnsAfter)},mceTableDeleteCol:function(){return s(n.deleteColumn)},mceTableDeleteRow:function(){return s(n.deleteRow)},mceTableCutCol:function(t){return m().each(function(t){c.setColumns(t),s(n.deleteColumn)})},mceTableCutRow:function(t){return d().each(function(t){c.setRows(t),s(n.deleteRow)})},mceTableCopyCol:function(t){return m().each(function(t){return c.setColumns(t)})},mceTableCopyRow:function(t){return d().each(function(t){return c.setRows(t)})},mceTablePasteColBefore:function(t){return g(n.pasteColsBefore,c.getColumns)},mceTablePasteColAfter:function(t){return g(n.pasteColsAfter,c.getColumns)},mceTablePasteRowBefore:function(t){return g(n.pasteRowsBefore,c.getRows)},mceTablePasteRowAfter:function(t){return g(n.pasteRowsAfter,c.getRows)},mceTableDelete:function(){return Kc(t).each(function(n){re(n,a).filter(f(a)).each(function(n){var e=yt.fromText("");if(xn(n,e),Pn(n),t.dom.isEmpty(t.getBody()))t.setContent(""),t.selection.setCursorLocation();else{var r=t.dom.createRng();r.setStart(e.dom(),0),r.setEnd(e.dom(),0),t.selection.setRng(r),t.nodeChanged()}})})},mceTableSizingMode:function(n,e){return r=e,Kc(t).each(function(n){zu(t)||ju(t)||Wu(t)||re(n,a).each(function(n){"relative"!==r||Io(n)?"fixed"!==r||Mo(n)?"responsive"!==r||function(t){return uo(t).isNone()}(n)||fi(n):li(t,n):ai(t,n),Xu(n)})});var r}},function(n,e){return t.addCommand(e,n)}),K({mceTableCellType:function(e,r){return n.setTableCellType(t,r)},mceTableRowType:function(e,r){return n.setTableRowType(t,r)}},function(n,e){return t.addCommand(e,n)}),t.addCommand("mceTableColType",function(t,e){return G(e,"type").each(function(t){return s("th"===t?n.makeColumnHeader:n.unmakeColumnHeader)})}),K({mceTableProps:u(Ba,t,!1),mceTableRowProps:u(Ra,t),mceTableCellProps:u(Sa,t)},function(n,e){return t.addCommand(e,function(){return n()})}),t.addCommand("mceInsertTable",function(n,e){y(e)&&0<V(e).length?ta(t,e.rows,e.columns,e.options,"Invalid values for mceInsertTable - rows and columns values are required to insert a table."):Ba(t,!0)}),t.addCommand("mceTableApplyCellStyle",function(n,e){if(y(e)){var r=$c(t);0!==r.length&&K(e,function(n,e){var o="tablecell"+e.toLowerCase().replace("-","");t.formatter.has(o)&&w(n)&&M(r,function(e){wa.normal(t,e).setFormat(o,n)})})}})},Ea=function(t,n,e){var r=Ku(t);K({mceTableRowType:function(){return n.getTableRowType(t)},mceTableCellType:function(){return n.getTableCellType(t)},mceTableColType:function(){return Uc(t).bind(function(t){return re(t,r).map(function(r){var o=vr(e,r,t);return n.getTableColType(r,o)})}).getOr("")}},function(n,e){return t.addQueryValueHandler(e,n)})},Ia=function(){var t=ti(h.none()),n=ti(h.none()),e=function(t){t.set(h.none())};return{getRows:t.get,setRows:function(r){t.set(r),e(n)},clearRows:function(){return e(t)},getColumns:n.get,setColumns:function(r){n.set(r),e(t)},clearColumns:function(){return e(n)}}},Ma=lr([{none:["current"]},{first:["current"]},{middle:["current","target"]},{last:["current"]}]),ka=St(St({},Ma),{none:function(t){return void 0===t&&(t=void 0),Ma.none(t)}}),Na=function(t,n){return re(t,n).bind(function(n){var e=ee(n);return j(e,function(n){return Jt(t,n)}).map(function(t){return{index:t,all:e}})})},_a=function(t,n,e,o){return{start:r(t),soffset:r(n),finish:r(e),foffset:r(o)}},Wa=lr([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),ja={before:Wa.before,on:Wa.on,after:Wa.after,cata:function(t,n,e,r){return t.fold(n,e,r)},getStart:function(t){return t.fold(o,o,o)}},za=lr([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Fa={domRange:za.domRange,relative:za.relative,exact:za.exact,exactFromRange:function(t){return za.exact(t.start(),t.soffset(),t.finish(),t.foffset())},getWin:function(t){var n;return n=t.match({domRange:function(t){return yt.fromDom(t.startContainer)},relative:function(t,n){return ja.getStart(t)},exact:function(t,n,e,r){return t}}),yt.fromDom(n.dom().ownerDocument.defaultView)},range:_a},La=function(t,n,e){var r,o,u=t.document.createRange();return r=u,n.fold(function(t){r.setStartBefore(t.dom())},function(t,n){r.setStart(t.dom(),n)},function(t){r.setStartAfter(t.dom())}),o=u,e.fold(function(t){o.setEndBefore(t.dom())},function(t,n){o.setEnd(t.dom(),n)},function(t){o.setEndAfter(t.dom())}),u},Ha=function(t,n,e,r,o){var u=t.document.createRange();return u.setStart(n.dom(),e),u.setEnd(r.dom(),o),u},qa=function(t){return{left:r(t.left),top:r(t.top),right:r(t.right),bottom:r(t.bottom),width:r(t.width),height:r(t.height)}},Va=lr([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Ua=function(t,n,e){return n(yt.fromDom(e.startContainer),e.startOffset,yt.fromDom(e.endContainer),e.endOffset)},Ka=function(t,n){var e,o,u,i=(e=t,n.match({domRange:function(t){return{ltr:r(t),rtl:h.none}},relative:function(t,n){return{ltr:Ct(function(){return La(e,t,n)}),rtl:Ct(function(){return h.some(La(e,n,t))})}},exact:function(t,n,r,o){return{ltr:Ct(function(){return Ha(e,t,n,r,o)}),rtl:Ct(function(){return h.some(Ha(e,r,o,t,n))})}}}));return(u=(o=i).ltr()).collapsed?o.rtl().filter(function(t){return!1===t.collapsed}).map(function(t){return Va.rtl(yt.fromDom(t.endContainer),t.endOffset,yt.fromDom(t.startContainer),t.startOffset)}).getOrThunk(function(){return Ua(0,Va.ltr,u)}):Ua(0,Va.ltr,u)},$a=function(t,n){return Ka(t,n).match({ltr:function(n,e,r,o){var u=t.document.createRange();return u.setStart(n.dom(),e),u.setEnd(r.dom(),o),u},rtl:function(n,e,r,o){var u=t.document.createRange();return u.setStart(r.dom(),o),u.setEnd(n.dom(),e),u}})},Xa=(Va.ltr,Va.rtl,function(t,n,e){return n>=t.left&&n<=t.right&&e>=t.top&&e<=t.bottom}),Ga=function(t,n,e,r){return et(n)?function(t,n,e,r){var o=t.dom().createRange();o.selectNode(n.dom());var u=o.getClientRects();return q(u,function(t){return Xa(t,e,r)?h.some(t):h.none()}).map(function(o){return function(t,n,e,r,o){var u=function(e){var r=t.dom().createRange();return r.setStart(n.dom(),e),r.collapse(!0),r},i=ve(n).length,c=function(t,n,e,r,o){if(0===o)return 0;if(n===r)return o-1;for(var u=r,i=1;i<o;i++){var c=t(i),a=Math.abs(n-c.left);if(e<=c.bottom){if(e<c.top||u<a)return i-1;u=a}}return 0}(function(t){return u(t).getBoundingClientRect()},e,r,o.right,i);return u(c)}(t,n,e,r,o)})}(t,n,e,r):(u=n,i=e,c=r,a=(o=t).dom().createRange(),l=un(u),q(l,function(t){return a.selectNode(t.dom()),Xa(a.getBoundingClientRect(),i,c)?Ga(o,t,i,c):h.none()}));var o,u,i,c,a,l},Ya=function(t,n){return n-t.left<t.right-n},Ja=function(t,n,e){var r=t.dom().createRange();return r.selectNode(n.dom()),r.collapse(e),r},Qa=document.caretPositionFromPoint?function(t,n,e){return h.from(t.dom().caretPositionFromPoint(n,e)).bind(function(n){if(null===n.offsetNode)return h.none();var e=t.dom().createRange();return e.setStart(n.offsetNode,n.offset),e.collapse(),h.some(e)})}:document.caretRangeFromPoint?function(t,n,e){return h.from(t.dom().caretRangeFromPoint(n,e))}:function(t,n,e){return yt.fromPoint(t,n,e).bind(function(r){var o=function(){return e=t,u=n,(0===un(o=r).length?function(t,n,e){var r=n.dom().getBoundingClientRect(),o=Ya(r,e);return h.some(Ja(t,n,o))}:function(t,n,e){var r=t.dom().createRange();r.selectNode(n.dom());var o=r.getBoundingClientRect(),u=Ya(o,e);return(!0===u?xe:Te)(n).map(function(n){return Ja(t,n,u)})})(e,o,u);var e,o,u};return 0===un(r).length?o():function(t,n,e,r){var o=t.dom().createRange();o.selectNode(n.dom());var u=o.getBoundingClientRect();return function(t,n,e,r){var o=t.dom().createRange();o.selectNode(n.dom());var u=o.getBoundingClientRect(),i=Math.max(u.left,Math.min(u.right,e)),c=Math.max(u.top,Math.min(u.bottom,r));return Ga(t,n,i,c)}(t,n,Math.max(u.left,Math.min(u.right,e)),Math.max(u.top,Math.min(u.bottom,r)))}(t,r,n,e).orThunk(o)})},Za=function(t,n){var e=J(t);return"input"===e?ja.after(t):B(["br","img"],e)?0===n?ja.before(t):ja.after(t):ja.on(t,n)},tl=function(t,n){var e=t.fold(ja.before,Za,ja.after),r=n.fold(ja.before,Za,ja.after);return Fa.relative(e,r)},nl=function(t,n,e,r){var o=Za(t,n),u=Za(e,r);return Fa.relative(o,u)},el=function(t,n){h.from(t.getSelection()).each(function(t){t.removeAllRanges(),t.addRange(n)})},rl=function(t,n,e,r,o){var u=Ha(t,n,e,r,o);el(t,u)},ol=function(t,n){return Ka(t,n).match({ltr:function(n,e,r,o){rl(t,n,e,r,o)},rtl:function(n,e,r,o){var u,i,c,a,l,f=t.getSelection();if(f.setBaseAndExtent)f.setBaseAndExtent(n.dom(),e,r.dom(),o);else if(f.extend)try{i=n,c=e,a=r,l=o,(u=f).collapse(i.dom(),c),u.extend(a.dom(),l)}catch(u){rl(t,r,o,n,e)}else rl(t,r,o,n,e)}})},ul=function(t,n,e,r,o){var u=nl(n,e,r,o);ol(t,u)},il=function(t,n,e){var r=tl(n,e);ol(t,r)},cl=function(t){var n=yt.fromDom(t.anchorNode),e=yt.fromDom(t.focusNode);return function(t,n,e,r){var o,u,i,c,a,l=(u=n,i=e,c=r,(a=tn(o=t).dom().createRange()).setStart(o.dom(),u),a.setEnd(i.dom(),c),a),f=Jt(t,e)&&n===r;return l.collapsed&&!f}(n,t.anchorOffset,e,t.focusOffset)?h.some(_a(n,t.anchorOffset,e,t.focusOffset)):function(t){if(0<t.rangeCount){var n=t.getRangeAt(0),e=t.getRangeAt(t.rangeCount-1);return h.some(_a(yt.fromDom(n.startContainer),n.startOffset,yt.fromDom(e.endContainer),e.endOffset))}return h.none()}(t)},al=function(t){return n=t,h.from(n.getSelection()).filter(function(t){return 0<t.rangeCount}).bind(cl).map(function(t){return Fa.exact(t.start(),t.soffset(),t.finish(),t.foffset())});var n},ll=tinymce.util.Tools.resolve("tinymce.util.VK"),fl=function(t,n){return function(t){var n=Fa.getWin(t).dom(),e=function(t,e,r,o){return Ha(n,t,e,r,o)},r=t.match({domRange:function(t){var n=yt.fromDom(t.startContainer),e=yt.fromDom(t.endContainer);return nl(n,t.startOffset,e,t.endOffset)},relative:tl,exact:nl});return Ka(n,r).match({ltr:e,rtl:e})}(Fa.exact(n,0,n,0))},sl=function(t,n,e,r,o){return e.fold(h.none,h.none,function(t,n){return xe(n).map(function(t){return fl(0,t)})},function(e){return re(e,n).bind(function(n){var o,u=hr(e);return t.undoManager.transact(function(){r.insertRowsAfter(n,u)}),o=zn(n,"tr"),H(o).bind(function(t){return Vn(t,"td,th").map(function(t){return fl(0,t)})})})})},dl=["table","li","dl"],ml=function(t,n,e,r){if(t.keyCode===ll.TAB){var o=qu(n),u=function(t){var n=J(t);return Jt(t,o)||B(dl,n)},i=n.selection.getRng();if(i.collapsed){var c=yt.fromDom(i.startContainer);ne(c,u).each(function(o){t.preventDefault(),(t.shiftKey?function(t,n,e,r){return sl(t,n,Na(o=e,void 0).fold(function(){return ka.none()},function(t){return 0<=t.index-1?ka.middle(o,t.all[t.index-1]):ka.first(o)}),r);var o}:function(t,n,e,r){return sl(t,n,Na(o=e,void 0).fold(function(){return ka.none(o)},function(t){return t.index+1<t.all.length?ka.middle(o,t.all[t.index+1]):ka.last(o)}),r);var o})(n,u,o,e,r).each(function(t){n.selection.setRng(t)})})}}},gl=function(t,n){return{selection:r(t),kill:r(n)}},pl=function(t,n,e,o){return{start:r(ja.on(t,n)),finish:r(ja.on(e,o))}},hl=function(t,n){var e=$a(t,n);return _a(yt.fromDom(e.startContainer),e.startOffset,yt.fromDom(e.endContainer),e.endOffset)},vl=pl,bl=function(t,n,e,r,o){return Jt(e,r)?h.none():Ye(e,r,n).bind(function(n){var r=n.boxes.getOr([]);return 0<r.length?(o(t,r,n.start,n.finish),h.some(gl(h.some(vl(e,0,e,ye(e))),!0))):h.none()})},wl=function(t,n){return{item:r(t),mode:r(n)}},yl=function(t,n,e,r){return void 0===r&&(r=Sl),t.property().parent(n).map(function(t){return wl(t,r)})},Sl=function(t,n,e,r){return void 0===r&&(r=Cl),e.sibling(t,n).map(function(t){return wl(t,r)})},Cl=function(t,n,e,r){void 0===r&&(r=Cl);var o=t.property().children(n);return e.first(o).map(function(t){return wl(t,r)})},xl=[{current:yl,next:Sl,fallback:h.none()},{current:Sl,next:Cl,fallback:h.some(yl)},{current:Cl,next:Cl,fallback:h.some(Sl)}],Tl=function(t,n,e,r,o){return void 0===o&&(o=xl),W(o,function(t){return t.current===e}).bind(function(e){return e.current(t,n,r,e.next).orThunk(function(){return e.fallback.bind(function(e){return Tl(t,n,e,r)})})})},Rl=function(t,n,e,r,o,u){return Tl(t,n,r,o).bind(function(n){return u(n.item())?h.none():e(n.item())?h.some(n.item()):Rl(t,n.item(),e,n.mode(),o,u)})},Ol=function(t){return function(n){return 0===t.property().children(n).length}},Dl=function(t,n,e,r){return Rl(t,n,e,Sl,{sibling:function(t,n){return t.query().prevSibling(n)},first:function(t){return 0<t.length?h.some(t[t.length-1]):h.none()}},r)},Al=function(t,n,e,r){return Rl(t,n,e,Sl,{sibling:function(t,n){return t.query().nextSibling(n)},first:function(t){return 0<t.length?h.some(t[0]):h.none()}},r)},Bl=qe(),Pl=function(t,n){return Dl(e=Bl,t,Ol(e),n);var e},El=function(t,n){return Al(e=Bl,t,Ol(e),n);var e},Il=lr([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),Ml=function(t){return Un(t,"tr")},kl=St(St({},Il),{verify:function(t,n,e,r,o,u,i){return Un(r,"td,th",i).bind(function(e){return Un(n,"td,th",i).map(function(n){return Jt(e,n)?Jt(r,e)&&ye(e)===o?u(n):Il.none("in same cell"):Xe(Ml,[e,n]).fold(function(){return o=n,i=e,c=(r=t).getRect(o),(a=r.getRect(i)).right>c.left&&a.left<c.right?Il.success():u(n);var r,o,i,c,a},function(t){return u(n)})})}).getOr(Il.none("default"))},cata:function(t,n,e,r,o){return t.fold(n,e,r,o)}}),Nl=function(t,n){return j(t,u(Jt,n))},_l=function(t){return"br"===J(t)},Wl=function(t,n,e){return n(t,e).bind(function(t){return et(t)&&0===ve(t).trim().length?Wl(t,n,e):h.some(t)})},jl=function(t,n,e,o){return cn(u=n,i=e).filter(_l).orThunk(function(){return cn(u,i-1).filter(_l)}).bind(function(n){return o.traverse(n).fold(function(){return Wl(n,o.gather,t).map(o.relative)},function(t){return(n=t,nn(n).bind(function(t){var e=un(t);return Nl(e,n).map(function(o){return{parent:r(t),children:r(e),element:r(n),index:r(o)}})})).map(function(t){return ja.on(t.parent(),t.index())});var n})});var u,i},zl=function(t,n){return{left:t.left,top:t.top+n,right:t.right,bottom:t.bottom+n}},Fl=function(t,n){return{left:t.left,top:t.top-n,right:t.right,bottom:t.bottom-n}},Ll=function(t,n,e){return{left:t.left+n,top:t.top+e,right:t.right+n,bottom:t.bottom+e}},Hl=function(t){return{left:t.left,top:t.top,right:t.right,bottom:t.bottom}},ql=function(t,n){return h.some(t.getRect(n))},Vl=function(t,n,e){return nt(n)?ql(t,n).map(Hl):et(n)?(r=t,o=n,(0<=(u=e)&&u<ye(o)?r.getRangedRect(o,u,o,u+1):0<u?r.getRangedRect(o,u-1,o,u):h.none()).map(Hl)):h.none();var r,o,u},Ul=function(t,n){return nt(n)?ql(t,n).map(Hl):et(n)?t.getRangedRect(n,0,n,ye(n)).map(Hl):h.none()},Kl=lr([{none:[]},{retry:["caret"]}]),$l=function(t,n,e){return Fn(function(t,n){return n(t)},Ln,n,ac,void 0).fold(r(!1),function(n){return Ul(t,n).exists(function(t){return r=t,(n=e).left<r.left||Math.abs(r.right-n.left)<1||n.left>r.right;var n,r})})},Xl={point:function(t){return t.bottom},adjuster:function(t,n,e,r,o){var u=zl(o,5);return Math.abs(e.bottom-r.bottom)<1||e.top>o.bottom?Kl.retry(u):e.top===o.bottom?Kl.retry(zl(o,1)):$l(t,n,o)?Kl.retry(Ll(u,5,0)):Kl.none()},move:zl,gather:El},Gl=function(t,n,e,r,o){return 0===o?h.some(r):(a=t,l=r.left,f=n.point(r),a.elementFromPoint(l,f).filter(function(t){return"table"===J(t)}).isSome()?(i=r,c=o-1,Gl(t,u=n,e,u.move(i,5),c)):t.situsFromPoint(r.left,n.point(r)).bind(function(u){return u.start().fold(h.none,function(u){return Ul(t,u).bind(function(i){return n.adjuster(t,u,i,e,r).fold(h.none,function(r){return Gl(t,n,e,r,o-1)})}).orThunk(function(){return h.some(r)})},h.none)}));var u,i,c,a,l,f},Yl=function(t,n,e){var r,o,u,i=t.move(e,5),c=Gl(n,t,e,i,100).getOr(i);return o=c,u=n,((r=t).point(o)>u.getInnerHeight()?h.some(r.point(o)-u.getInnerHeight()):r.point(o)<0?h.some(-r.point(o)):h.none()).fold(function(){return n.situsFromPoint(c.left,t.point(c))},function(e){return n.scrollBy(0,e),n.situsFromPoint(c.left,t.point(c)-e)})},Jl={tryUp:u(Yl,{point:function(t){return t.top},adjuster:function(t,n,e,r,o){var u=Fl(o,5);return Math.abs(e.top-r.top)<1||e.bottom<o.top?Kl.retry(u):e.bottom===o.top?Kl.retry(Fl(o,1)):$l(t,n,o)?Kl.retry(Ll(u,5,0)):Kl.none()},move:Fl,gather:Pl}),tryDown:u(Yl,Xl),ieTryUp:function(t,n){return t.situsFromPoint(n.left,n.top-5)},ieTryDown:function(t,n){return t.situsFromPoint(n.left,n.bottom+5)},getJumpSize:r(5)},Ql=function(t,n,e){return t.getSelection().bind(function(o){return function(t,n,e,o){var u,i,c;return(_l(n)?(u=t,i=n,(c=o).traverse(i).orThunk(function(){return Wl(i,c.gather,u)}).map(c.relative)):jl(t,n,e,o)).map(function(t){return{start:r(t),finish:r(t)}})}(n,o.finish(),o.foffset(),e).fold(function(){return h.some(di(o.finish(),o.foffset()))},function(r){var u,i=t.fromSitus(r);return u=kl.verify(t,o.finish(),o.foffset(),i.finish(),i.foffset(),e.failure,n),kl.cata(u,function(t){return h.none()},function(){return h.none()},function(t){return h.some(di(t,0))},function(t){return h.some(di(t,ye(t)))})})})},Zl=function(t,n,e,r,o,u){return 0===u?h.none():ef(t,n,e,r,o).bind(function(i){var c=t.fromSitus(i),a=kl.verify(t,e,r,c.finish(),c.foffset(),o.failure,n);return kl.cata(a,function(){return h.none()},function(){return h.some(i)},function(i){return Jt(e,i)&&0===r?tf(t,e,r,Fl,o):Zl(t,n,i,0,o,u-1)},function(i){return Jt(e,i)&&r===ye(i)?tf(t,e,r,zl,o):Zl(t,n,i,ye(i),o,u-1)})})},tf=function(t,n,e,r,o){return Vl(t,n,e).bind(function(n){return nf(t,o,r(n,Jl.getJumpSize()))})},nf=function(t,n,e){var r=Xt().browser;return r.isChrome()||r.isSafari()||r.isFirefox()||r.isEdge()?n.otherRetry(t,e):r.isIE()?n.ieRetry(t,e):h.none()},ef=function(t,n,e,r,o){return Vl(t,e,r).bind(function(n){return nf(t,o,n)})},rf=function(t,n,e,o,u){return Un(o,"td,th",n).bind(function(o){return Un(o,"table",n).bind(function(i){return function(t,n){return Ln(t,function(t){return nn(t).exists(function(t){return Jt(t,n)})},void 0).isSome()}(u,i)?Ql(c=t,a=n,l=e).bind(function(t){return Zl(c,a,t.element(),t.offset(),l,20).map(c.fromSitus)}).bind(function(t){return Un(t.finish(),"td,th",n).map(function(n){return{start:r(o),finish:r(n),range:r(t)}})}):h.none();var c,a,l})})},of=function(t,n,e,r,o,u){return Xt().browser.isIE()?h.none():u(r,n).orThunk(function(){return rf(t,n,e,r,o).map(function(t){var n=t.range();return gl(h.some(vl(n.start(),n.soffset(),n.finish(),n.foffset())),!0)})})},uf=function(t,n){return Un(t,"tr",n).bind(function(t){return Un(t,"table",n).bind(function(e){var r=zn(e,"tr");return Jt(t,r[0])?Dl(Bl,e,function(t){return Te(t).isSome()},n).map(function(t){var n=ye(t);return gl(h.some(vl(t,n,t,n)),!0)}):h.none()})})},cf=function(t,n){return Un(t,"tr",n).bind(function(t){return Un(t,"table",n).bind(function(e){var r=zn(e,"tr");return Jt(t,r[r.length-1])?Al(Bl,e,function(t){return xe(t).isSome()},n).map(function(t){return gl(h.some(vl(t,0,t,0)),!0)}):h.none()})})},af=function(t,n,e,r,o,u,i){return rf(t,e,r,o,u).bind(function(t){return bl(n,e,t.start(),t.finish(),i)})},lf=function(t,n){return Un(t,"td,th",n)},ff={traverse:on,gather:El,relative:ja.before,otherRetry:Jl.tryDown,ieRetry:Jl.ieTryDown,failure:kl.failedDown},sf={traverse:rn,gather:Pl,relative:ja.before,otherRetry:Jl.tryUp,ieRetry:Jl.ieTryUp,failure:kl.failedUp},df=function(t){return function(n){return n===t}},mf=df(38),gf=df(40),pf=function(t){return 37<=t&&t<=40},hf={isBackward:df(37),isForward:df(39)},vf={isBackward:df(39),isForward:df(37)},bf=function(t){return{left:t.left(),top:t.top(),right:t.right(),bottom:t.bottom(),width:t.width(),height:t.height()}},wf=function(n){return{elementFromPoint:function(t,e){return yt.fromPoint(yt.fromDom(n.document),t,e)},getRect:function(t){return t.dom().getBoundingClientRect()},getRangedRect:function(t,e,r,o){var u=Fa.exact(t,e,r,o);return function(t,n){var e,r,o;return 0<(o=0<(r=(e=$a(t,n)).getClientRects()).length?r[0]:e.getBoundingClientRect()).width||0<o.height?h.some(o).map(qa):h.none()}(n,u).map(bf)},getSelection:function(){return al(n).map(function(t){return hl(n,t)})},fromSitus:function(t){var e=Fa.relative(t.start(),t.finish());return hl(n,e)},situsFromPoint:function(t,e){return function(t,n,e){return r=t,o=n,u=e,i=yt.fromDom(r.document),Qa(i,o,u).map(function(t){return _a(yt.fromDom(t.startContainer),t.startOffset,yt.fromDom(t.endContainer),t.endOffset)});var r,o,u,i}(n,t,e).map(function(t){return pl(t.start(),t.soffset(),t.finish(),t.foffset())})},clearSelection:function(){n.getSelection().removeAllRanges()},collapseSelection:function(t){void 0===t&&(t=!1),al(n).each(function(e){return e.fold(function(n){return n.collapse(t)},function(e,r){var o=t?e:r;il(n,o,o)},function(e,r,o,u){var i=t?e:o,c=t?r:u;ul(n,i,c,i,c)})})},setSelection:function(t){ul(n,t.start(),t.soffset(),t.finish(),t.foffset())},setRelativeSelection:function(t,e){il(n,t,e)},selectContents:function(t){!function(t,n){var e,r,o=(e=n,function(t,n){t.selectNodeContents(n.dom())}(r=t.document.createRange(),e),r);el(t,o)}(n,t)},getInnerHeight:function(){return n.innerHeight},getScrollY:function(){var e,r,o,u;return(e=yt.fromDom(n.document),r=void 0!==e?e.dom():t.document,o=r.body.scrollLeft||r.documentElement.scrollLeft,u=r.body.scrollTop||r.documentElement.scrollTop,yr(o,u)).top()},scrollBy:function(e,r){var o,u,i;o=e,u=r,(void 0!==(i=yt.fromDom(n.document))?i.dom():t.document).defaultView.scrollBy(o,u)}}},yf=function(t,n){return{rows:t,cols:n}},Sf=function(t,n,e,r){var o=function(t,n,e,r){var o=h.none(),u=function(){o=h.none()};return{mousedown:function(t){r.clear(n),o=lf(t.target(),e)},mouseover:function(u){o.each(function(o){r.clearBeforeUpdate(n),lf(u.target(),e).each(function(u){Ye(o,u,e).each(function(e){var i=e.boxes.getOr([]);(1<i.length||1===i.length&&!Jt(o,u))&&(r.selectRange(n,i,e.start,e.finish),t.selectContents(u))})})})},mouseup:function(t){o.each(u)}}}(wf(t),n,e,r);return{mousedown:o.mousedown,mouseover:o.mouseover,mouseup:o.mouseup}},Cf=function(t,n,e,r){var o=wf(t),i=function(){return r.clear(n),h.none()};return{keydown:function(t,c,a,l,f,s){var d=t.raw(),m=d.which,g=!0===d.shiftKey;return Je(n,r.selectedSelector).fold(function(){return gf(m)&&g?u(af,o,n,e,ff,l,c,r.selectRange):mf(m)&&g?u(af,o,n,e,sf,l,c,r.selectRange):gf(m)?u(of,o,e,ff,l,c,cf):mf(m)?u(of,o,e,sf,l,c,uf):h.none},function(t){var e=function(e){return function(){return q(e,function(e){return o=e.rows,u=e.cols,i=n,Ze(t,o,u,(c=r).firstSelectedSelector,c.lastSelectedSelector).map(function(t){return c.clearBeforeUpdate(i),c.selectRange(i,t.boxes,t.start,t.finish),t.boxes});var o,u,i,c}).fold(function(){return Qe(n,r.firstSelectedSelector,r.lastSelectedSelector).map(function(t){var e=gf(m)||s.isForward(m)?ja.after:ja.before;return o.setRelativeSelection(ja.on(t.first(),0),e(t.table())),r.clear(n),gl(h.none(),!0)})},function(t){return h.some(gl(h.none(),!0))})}};return gf(m)&&g?e([yf(1,0)]):mf(m)&&g?e([yf(-1,0)]):s.isBackward(m)&&g?e([yf(0,-1),yf(-1,0)]):s.isForward(m)&&g?e([yf(0,1),yf(1,0)]):pf(m)&&0==g?i:h.none})()},keyup:function(t,o,u,i,c){return Je(n,r.selectedSelector).fold(function(){var a,l,f,s,d,m,g,p=t.raw(),v=p.which;return 0!=(!0===p.shiftKey)&&pf(v)?(a=n,l=e,f=o,s=u,d=i,m=c,g=r.selectRange,Jt(f,d)&&s===m?h.none():Un(f,"td,th",l).bind(function(t){return Un(d,"td,th",l).bind(function(n){return bl(a,l,t,n,g)})})):h.none()},h.none)}}},xf=function(t,n,e,r){var o=wf(t);return function(t,u){r.clearBeforeUpdate(n),Ye(t,u,e).each(function(t){var e=t.boxes.getOr([]);r.selectRange(n,e,t.start,t.finish),o.selectContents(u),o.collapseSelection()})}},Tf=function(t,n){M(n,function(n){!function(t,n){Go(t)?t.dom().classList.remove(n):function(t,n){return o=n,0<(u=k(Xo(e=t,r="class"),function(t){return t!==o})).length?it(e,r,u.join(" ")):st(e,r),!1;var e,r,o,u}(t,n),function(t){0===(Go(t)?t.dom().classList:Xo(t,"class")).length&&st(t,"class")}(t)}(t,n)})},Rf={byClass:function(t){var n,e,r=(n=t.selected,function(t){Yo(t,n)}),o=(e=[t.selected,t.lastSelected,t.firstSelected],function(t){Tf(t,e)}),u=function(n){var e=zn(n,t.selectedSelector);M(e,o)};return{clearBeforeUpdate:u,clear:u,selectRange:function(n,e,o,i){u(n),M(e,r),Yo(o,t.firstSelected),Yo(i,t.lastSelected)},selectedSelector:t.selectedSelector,firstSelectedSelector:t.firstSelectedSelector,lastSelectedSelector:t.lastSelectedSelector}},byAttr:function(t,n,e){var r=function(n){st(n,t.selected),st(n,t.firstSelected),st(n,t.lastSelected)},o=function(n){it(n,t.selected,"1")},u=function(t){i(t),e()},i=function(n){var e=zn(n,t.selectedSelector);M(e,r)};return{clearBeforeUpdate:i,clear:u,selectRange:function(e,r,i,c){u(e),M(r,o),it(i,t.firstSelected,"1"),it(c,t.lastSelected,"1"),n(r,i,c)},selectedSelector:t.selectedSelector,firstSelectedSelector:t.firstSelectedSelector,lastSelectedSelector:t.lastSelectedSelector}}},Of=function(t,n,e){var r=le(t);return _i(r,n).map(function(t){var n,o,u,i,c,a,l,f,s,d=Pi(r,e,!1);return{upOrLeftCells:(n=t,o=e,u=d.slice(0,n[n.length-1].row()+1),i=Ei(u,o),F(i,function(t){var e=t.cells().slice(0,n[n.length-1].column()+1);return I(e,function(t){return t.element()})})),downOrRightCells:(a=t,l=e,f=(c=d).slice(a[0].row()+a[0].rowspan()-1,c.length),s=Ei(f,l),F(s,function(t){var n=t.cells().slice(a[0].column()+a[0].colspan()-1,+t.cells().length);return I(n,function(t){return t.element()})}))}})},Df=function(t){return!1===Jo(yt.fromDom(t.target),"ephox-snooker-resizer-bar")};var Af=function(t,n){var e=ti(h.none()),r=ti([]),o=function(){return Kc(t).bind(function(t){return re(t).map(function(e){return"caption"===J(t)?hr(t):vr(n,e,t)})})},u=function(){e.set(Ct(o)()),M(r.get(),function(t){return t()})},i=function(t,n){var o=function(){return e.get().fold(function(){t.setDisabled(!0)},function(e){t.setDisabled(n(e))})};return o(),r.set(r.get().concat([o])),function(){r.set(k(r.get(),function(t){return t!==o}))}};return t.on("NodeChange ExecCommand TableSelectorChange",u),{onSetupTable:function(t){return i(t,function(t){return!1})},onSetupCellOrRow:function(t){return i(t,function(t){return"caption"===J(t.element())})},onSetupPasteable:function(t){return function(n){return i(n,function(n){return"caption"===J(n.element())||t().isNone()})}},onSetupMergeable:function(t){return i(t,function(t){return t.mergable().isNone()})},onSetupUnmergeable:function(t){return i(t,function(t){return t.unmergable().isNone()})},resetTargets:u,targets:function(){return e.get()}}},Bf=function(t,n,e){t.ui.registry.addMenuButton("table",{tooltip:"Table",icon:"table",fetch:function(t){return t("inserttable | cell row column | advtablesort | tableprops deletetable")}});var r=function(n){return function(){return t.execCommand(n)}};t.ui.registry.addButton("tableprops",{tooltip:"Table properties",onAction:r("mceTableProps"),icon:"table",onSetup:n.onSetupTable}),t.ui.registry.addButton("tabledelete",{tooltip:"Delete table",onAction:r("mceTableDelete"),icon:"table-delete-table",onSetup:n.onSetupTable}),t.ui.registry.addButton("tablecellprops",{tooltip:"Cell properties",onAction:r("mceTableCellProps"),icon:"table-cell-properties",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablemergecells",{tooltip:"Merge cells",onAction:r("mceTableMergeCells"),icon:"table-merge-cells",onSetup:n.onSetupMergeable}),t.ui.registry.addButton("tablesplitcells",{tooltip:"Split cell",onAction:r("mceTableSplitCells"),icon:"table-split-cells",onSetup:n.onSetupUnmergeable}),t.ui.registry.addButton("tableinsertrowbefore",{tooltip:"Insert row before",onAction:r("mceTableInsertRowBefore"),icon:"table-insert-row-above",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tableinsertrowafter",{tooltip:"Insert row after",onAction:r("mceTableInsertRowAfter"),icon:"table-insert-row-after",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tabledeleterow",{tooltip:"Delete row",onAction:r("mceTableDeleteRow"),icon:"table-delete-row",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablerowprops",{tooltip:"Row properties",onAction:r("mceTableRowProps"),icon:"table-row-properties",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tableinsertcolbefore",{tooltip:"Insert column before",onAction:r("mceTableInsertColBefore"),icon:"table-insert-column-before",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tableinsertcolafter",{tooltip:"Insert column after",onAction:r("mceTableInsertColAfter"),icon:"table-insert-column-after",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tabledeletecol",{tooltip:"Delete column",onAction:r("mceTableDeleteCol"),icon:"table-delete-column",onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablecutrow",{tooltip:"Cut row",icon:"cut-row",onAction:r("mceTableCutRow"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablecopyrow",{tooltip:"Copy row",icon:"duplicate-row",onAction:r("mceTableCopyRow"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablepasterowbefore",{tooltip:"Paste row before",icon:"paste-row-before",onAction:r("mceTablePasteRowBefore"),onSetup:n.onSetupPasteable(e.getRows)}),t.ui.registry.addButton("tablepasterowafter",{tooltip:"Paste row after",icon:"paste-row-after",onAction:r("mceTablePasteRowAfter"),onSetup:n.onSetupPasteable(e.getRows)}),t.ui.registry.addButton("tablecutcol",{tooltip:"Cut column",icon:"cut-column",onAction:r("mceTableCutCol"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablecopycol",{tooltip:"Copy column",icon:"duplicate-column",onAction:r("mceTableCopyCol"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addButton("tablepastecolbefore",{tooltip:"Paste column before",icon:"paste-column-before",onAction:r("mceTablePasteColBefore"),onSetup:n.onSetupPasteable(e.getColumns)}),t.ui.registry.addButton("tablepastecolafter",{tooltip:"Paste column after",icon:"paste-column-after",onAction:r("mceTablePasteColAfter"),onSetup:n.onSetupPasteable(e.getColumns)}),t.ui.registry.addButton("tableinsertdialog",{tooltip:"Insert table",onAction:r("mceInsertTable"),icon:"table"})},Pf=function(t){var n=t.getParam("table_toolbar","tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol");0<n.length&&t.ui.registry.addContextToolbar("table",{predicate:function(n){return t.dom.is(n,"table")&&t.getBody().contains(n)},items:n,scope:"node",position:"node"})},Ef=function(t,n,e){var r=function(n){return function(){return t.execCommand(n)}},o=function(n){var e=n.numRows,r=n.numColumns;t.undoManager.transact(function(){Zc(t,r,e,0,0)}),t.addVisual()},u={text:"Table properties",onSetup:n.onSetupTable,onAction:r("mceTableProps")},i={text:"Delete table",icon:"table-delete-table",onSetup:n.onSetupTable,onAction:r("mceTableDelete")};t.ui.registry.addMenuItem("tableinsertrowbefore",{text:"Insert row before",icon:"table-insert-row-above",onAction:r("mceTableInsertRowBefore"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tableinsertrowafter",{text:"Insert row after",icon:"table-insert-row-after",onAction:r("mceTableInsertRowAfter"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tabledeleterow",{text:"Delete row",icon:"table-delete-row",onAction:r("mceTableDeleteRow"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablerowprops",{text:"Row properties",icon:"table-row-properties",onAction:r("mceTableRowProps"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablecutrow",{text:"Cut row",icon:"cut-row",onAction:r("mceTableCutRow"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablecopyrow",{text:"Copy row",icon:"duplicate-row",onAction:r("mceTableCopyRow"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablepasterowbefore",{text:"Paste row before",icon:"paste-row-before",onAction:r("mceTablePasteRowBefore"),onSetup:n.onSetupPasteable(e.getRows)}),t.ui.registry.addMenuItem("tablepasterowafter",{text:"Paste row after",icon:"paste-row-after",onAction:r("mceTablePasteRowAfter"),onSetup:n.onSetupPasteable(e.getRows)}),t.ui.registry.addMenuItem("tableinsertcolumnbefore",{text:"Insert column before",icon:"table-insert-column-before",onAction:r("mceTableInsertColBefore"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tableinsertcolumnafter",{text:"Insert column after",icon:"table-insert-column-after",onAction:r("mceTableInsertColAfter"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tabledeletecolumn",{text:"Delete column",icon:"table-delete-column",onAction:r("mceTableDeleteCol"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablecutcolumn",{text:"Cut column",icon:"cut-column",onAction:r("mceTableCutCol"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablecopycolumn",{text:"Copy column",icon:"duplicate-column",onAction:r("mceTableCopyCol"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablepastecolumnbefore",{text:"Paste column before",icon:"paste-column-before",onAction:r("mceTablePasteColBefore"),onSetup:n.onSetupPasteable(e.getColumns)}),t.ui.registry.addMenuItem("tablepastecolumnafter",{text:"Paste column after",icon:"paste-column-after",onAction:r("mceTablePasteColAfter"),onSetup:n.onSetupPasteable(e.getColumns)}),t.ui.registry.addMenuItem("tablecellprops",{text:"Cell properties",icon:"table-cell-properties",onAction:r("mceTableCellProps"),onSetup:n.onSetupCellOrRow}),t.ui.registry.addMenuItem("tablemergecells",{text:"Merge cells",icon:"table-merge-cells",onAction:r("mceTableMergeCells"),onSetup:n.onSetupMergeable}),t.ui.registry.addMenuItem("tablesplitcells",{text:"Split cell",icon:"table-split-cells",onAction:r("mceTableSplitCells"),onSetup:n.onSetupUnmergeable}),!1===t.getParam("table_grid",!0,"boolean")?t.ui.registry.addMenuItem("inserttable",{text:"Table",icon:"table",onAction:r("mceInsertTable")}):t.ui.registry.addNestedMenuItem("inserttable",{text:"Table",icon:"table",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"inserttable",onAction:o}]}}),t.ui.registry.addMenuItem("inserttabledialog",{text:"Insert table",icon:"table",onAction:r("mceInsertTable")}),t.ui.registry.addMenuItem("tableprops",u),t.ui.registry.addMenuItem("deletetable",i),t.ui.registry.addNestedMenuItem("row",{type:"nestedmenuitem",text:"Row",getSubmenuItems:function(){return"tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter"}}),t.ui.registry.addNestedMenuItem("column",{type:"nestedmenuitem",text:"Column",getSubmenuItems:function(){return"tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn"}}),t.ui.registry.addNestedMenuItem("cell",{type:"nestedmenuitem",text:"Cell",getSubmenuItems:function(){return"tablecellprops tablemergecells tablesplitcells"}}),t.ui.registry.addContextMenu("table",{update:function(){return n.resetTargets(),n.targets().fold(function(){return""},function(t){return"caption"===J(t.element())?"tableprops deletetable":"cell row column | advtablesort | tableprops deletetable"})}})},If={tablecellbackgroundcolor:{selector:"td,th",styles:{backgroundColor:"%value"},remove_similar:!0},tablecellbordercolor:{selector:"td,th",styles:{borderColor:"%value"},remove_similar:!0},tablecellborderstyle:{selector:"td,th",styles:{borderStyle:"%value"},remove_similar:!0},tablecellborderwidth:{selector:"td,th",styles:{borderWidth:"%value"},remove_similar:!0}},Mf=function(t){t.formatter.register(If)};function kf(t){var n=qc(t),r=Af(t,n),o=si(t),u=function(t,n,r){var o=Rf.byAttr(ar,function(n,o,u){r.targets().each(function(r){re(o).each(function(i){var c=Lu(t),a=Me(e,yt.fromDom(t.getDoc()),c),l=Of(i,r,a);Tu(t,n,o,u,l)})})},function(){return Ru(t)});return t.on("init",function(r){var u=t.getWin(),i=qu(t),c=Ku(t),a=Sf(u,i,c,o),l=Cf(u,i,c,o),f=xf(u,i,c,o);t.on("TableSelectorChange",function(t){return f(t.start,t.finish)});var s,d,m=function(n,e){!0===n.raw().shiftKey&&(e.kill()&&n.kill(),e.selection().each(function(n){var e=Fa.relative(n.start(),n.finish()),r=$a(u,e);t.selection.setRng(r)}))},g=function(t){return 0===t.button},p=(s=ti(yt.fromDom(i)),d=ti(0),{touchEnd:function(t){var n=yt.fromDom(t.target);if("td"===J(n)||"th"===J(n)){var e=s.get(),r=d.get();Jt(e,n)&&t.timeStamp-r<300&&(t.preventDefault(),f(n,n))}s.set(n),d.set(t.timeStamp)}});t.on("mousedown",function(t){g(t)&&Df(t)&&a.mousedown($o(t))}),t.on("mouseover",function(t){var n;(void 0===(n=t).buttons||Oa.browser.isEdge()&&0===n.buttons||0!=(1&n.buttons))&&Df(t)&&a.mouseover($o(t))}),t.on("mouseup",function(t){g(t)&&Df(t)&&a.mouseup($o(t))}),t.on("touchend",p.touchEnd),t.on("keyup",function(n){var e=$o(n);if(e.raw().shiftKey&&pf(e.raw().which)){var r=t.selection.getRng(),o=yt.fromDom(r.startContainer),u=yt.fromDom(r.endContainer);l.keyup(e,o,r.startOffset,u,r.endOffset).each(function(t){m(e,t)})}}),t.on("keydown",function(e){var r=$o(e);n().each(function(t){return t.hideBars()});var o=t.selection.getRng(),u=yt.fromDom(t.selection.getStart()),i=yt.fromDom(o.startContainer),c=yt.fromDom(o.endContainer),a=Zu(u).isRtl()?vf:hf;l.keydown(r,i,o.startOffset,c,o.endOffset,a).each(function(t){m(r,t)}),n().each(function(t){return t.showBars()})}),t.on("NodeChange",function(){var n=t.selection,r=yt.fromDom(n.getStart()),u=yt.fromDom(n.getEnd());Xe(re,[r,u]).fold(function(){return o.clear(i)},e)})}),{clear:o.clear}}(t,o.lazyResize,r),i=Gc(t,o.lazyWire),c=Ia();return Pa(t,i,u,n,c),Ea(t,i,n),br(t,n,i,u),Ef(t,r,c),Bf(t,r,c),Pf(t),t.on("PreInit",function(){t.serializer.addTempAttr(or),t.serializer.addTempAttr(ir),Mf(t)}),Iu(t)&&t.on("keydown",function(n){ml(n,t,i,o.lazyWire)}),t.on("remove",function(){o.destroy()}),ra(t,c,o,r)}n.add("table",kf)}(window);