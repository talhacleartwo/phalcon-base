!function(n){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=function(){},r=function(n){return function(){return n}},o=function(n){return n};function u(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=t.concat(e);return n.apply(null,o)}}var i=function(n){return function(t){return!n(t)}},c=r(!1),a=r(!0),l=function(){return f},f=function(){var n=function(n){return n.isNone()},t=function(n){return n()},o=function(n){return n};return{fold:function(n,t){return n()},is:c,isSome:c,isNone:a,getOr:o,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:r(null),getOrUndefined:r(void 0),or:o,orThunk:t,map:l,each:e,bind:l,exists:c,forall:a,filter:l,equals:n,equals_:n,toArray:function(){return[]},toString:r("none()")}}(),s=function(n){var t=r(n),e=function(){return u},o=function(t){return t(n)},u={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:a,isNone:c,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return s(t(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?u:f},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(c,function(t){return e(n,t)})}};return u},d={some:s,none:l,from:function(n){return null==n?f:s(n)}},m=function(n){return function(t){return r=typeof(e=t),(null===e?"null":"object"===r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===n;var e,r}},g=function(n){return function(t){return typeof t===n}},p=m("string"),h=m("object"),v=m("array"),b=g("boolean"),w=function(n){return!function(n){return null==n}(n)},y=g("function"),C=g("number"),S=Array.prototype.slice,x=Array.prototype.indexOf,T=Array.prototype.push,R=function(n,t){return e=n,r=t,x.call(e,r)>-1;var e,r},O=function(n,t){for(var e=0,r=n.length;e<r;e++){if(t(n[e],e))return!0}return!1},D=function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e},A=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var u=n[o];r[o]=t(u,o)}return r},B=function(n,t){for(var e=0,r=n.length;e<r;e++){t(n[e],e)}},I=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var u=n[r];t(u,r)&&e.push(u)}return e},P=function(n,t,e){return function(n,t){for(var e=n.length-1;e>=0;e--)t(n[e],e)}(n,function(n){e=t(e,n)}),e},k=function(n,t,e){return B(n,function(n){e=t(e,n)}),e},E=function(n,t){return function(n,t,e){for(var r=0,o=n.length;r<o;r++){var u=n[r];if(t(u,r))return d.some(u);if(e(u,r))break}return d.none()}(n,t,c)},M=function(n,t){for(var e=0,r=n.length;e<r;e++){if(t(n[e],e))return d.some(e)}return d.none()},N=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!v(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);T.apply(t,n[e])}return t},_=function(n,t){return N(A(n,t))},W=function(n,t){for(var e=0,r=n.length;e<r;++e){if(!0!==t(n[e],e))return!1}return!0},j=function(n){return 0===n.length?d.none():d.some(n[n.length-1])},z=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return d.none()},F=Object.keys,L=Object.hasOwnProperty,H=function(n,t){for(var e=F(n),r=0,o=e.length;r<o;r++){var u=e[r];t(n[u],u)}},q=function(n,t){return V(n,function(n,e){return{k:e,v:t(n,e)}})},V=function(n,t){var e={};return H(n,function(n,r){var o=t(n,r);e[o.k]=o.v}),e},U=function(n,t){var r,o={};return function(n,t,e,r){H(n,function(n,o){(t(n,o)?e:r)(n,o)})}(n,t,(r=o,function(n,t){r[t]=n}),e),o},K=function(n,t){return $(n,t)?d.from(n[t]):d.none()},$=function(n,t){return L.call(n,t)},X=(void 0!==n.window?n.window:Function("return this;")(),function(n){return n.dom().nodeName.toLowerCase()}),G=function(n){return n.dom().nodeType},Y=function(n){return function(t){return G(t)===n}},J=function(n){return 8===G(n)||"#comment"===X(n)},Q=Y(1),Z=Y(3),nn=Y(9),tn=Y(11),en=function(t,e,r){if(!(p(r)||b(r)||C(r)))throw n.console.error("Invalid call to Attr.set. Key ",e,":: Value ",r,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,r+"")},rn=function(n,t,e){en(n.dom(),t,e)},on=function(n,t){var e=n.dom();H(t,function(n,t){en(e,t,n)})},un=function(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e},cn=function(n,t){return d.from(un(n,t))},an=function(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)},ln=function(n,t){n.dom().removeAttribute(t)},fn=function(n){return k(n.dom().attributes,function(n,t){return n[t.name]=t.value,n},{})},sn=function(n,t,e){return""===t||n.length>=t.length&&n.substr(e,e+t.length)===t},dn=function(n,t){return-1!==n.indexOf(t)},mn=function(n,t){return sn(n,t,n.length-t.length)},gn=function(n){return function(t){return t.replace(n,"")}}(/^\s+|\s+$/g),pn=function(n){return n.length>0},hn=function(n){return void 0!==n.style&&y(n.style.getPropertyValue)},vn=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:r(n)}},bn={fromHtml:function(t,e){var r=(e||n.document).createElement("div");if(r.innerHTML=t,!r.hasChildNodes()||r.childNodes.length>1)throw n.console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return vn(r.childNodes[0])},fromTag:function(t,e){var r=(e||n.document).createElement(t);return vn(r)},fromText:function(t,e){var r=(e||n.document).createTextNode(t);return vn(r)},fromDom:vn,fromPoint:function(n,t,e){var r=n.dom();return d.from(r.elementFromPoint(t,e)).map(vn)}},wn=function(){return(wn=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},yn=function(n){var t,e=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e||(e=!0,t=n.apply(null,r)),t}},Cn=function(){return Sn(0,0)},Sn=function(n,t){return{major:n,minor:t}},xn={nu:Sn,detect:function(n,t){var e=String(t).toLowerCase();return 0===n.length?Cn():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return Sn(r(1),r(2))}(n,e)},unknown:Cn},Tn=function(n){var t=n.current,e=n.version,r=function(n){return function(){return t===n}};return{current:t,version:e,isEdge:r("Edge"),isChrome:r("Chrome"),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r("Firefox"),isSafari:r("Safari")}},Rn={unknown:function(){return Tn({current:void 0,version:xn.unknown()})},nu:Tn,edge:r("Edge"),chrome:r("Chrome"),ie:r("IE"),opera:r("Opera"),firefox:r("Firefox"),safari:r("Safari")},On=function(n){var t=n.current,e=n.version,r=function(n){return function(){return t===n}};return{current:t,version:e,isWindows:r("Windows"),isiOS:r("iOS"),isAndroid:r("Android"),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r("Solaris"),isFreeBSD:r("FreeBSD"),isChromeOS:r("ChromeOS")}},Dn={unknown:function(){return On({current:void 0,version:xn.unknown()})},nu:On,windows:r("Windows"),ios:r("iOS"),android:r("Android"),linux:r("Linux"),osx:r("OSX"),solaris:r("Solaris"),freebsd:r("FreeBSD"),chromeos:r("ChromeOS")},An=function(n,t){var e=String(t).toLowerCase();return E(n,function(n){return n.search(e)})},Bn=function(n,t){return An(n,t).map(function(n){var e=xn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},In=function(n,t){return An(n,t).map(function(n){var e=xn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Pn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,kn=function(n){return function(t){return dn(t,n)}},En=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return dn(n,"edge/")&&dn(n,"chrome")&&dn(n,"safari")&&dn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Pn],search:function(n){return dn(n,"chrome")&&!dn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return dn(n,"msie")||dn(n,"trident")}},{name:"Opera",versionRegexes:[Pn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:kn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:kn("firefox")},{name:"Safari",versionRegexes:[Pn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(dn(n,"safari")||dn(n,"mobile/"))&&dn(n,"applewebkit")}}],Mn=[{name:"Windows",search:kn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return dn(n,"iphone")||dn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:kn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:kn("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:kn("linux"),versionRegexes:[]},{name:"Solaris",search:kn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:kn("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:kn("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Nn={browsers:r(En),oses:r(Mn)},_n=function(n,t){var e=Nn.browsers(),o=Nn.oses(),u=Bn(e,n).fold(Rn.unknown,Rn.nu),i=In(o,n).fold(Dn.unknown,Dn.nu),c=function(n,t,e,o){var u=n.isiOS()&&!0===/ipad/i.test(e),i=n.isiOS()&&!u,c=n.isiOS()||n.isAndroid(),a=c||o("(pointer:coarse)"),l=u||!i&&c&&o("(min-device-width:768px)"),f=i||c&&!l,s=t.isSafari()&&n.isiOS()&&!1===/safari/i.test(e),d=!f&&!l&&!s;return{isiPad:r(u),isiPhone:r(i),isTablet:r(l),isPhone:r(f),isTouch:r(a),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:r(s),isDesktop:r(d)}}(i,u,n,t);return{browser:u,os:i,deviceType:c}},Wn=function(t){return n.window.matchMedia(t).matches},jn=yn(function(){return _n(n.navigator.userAgent,Wn)}),zn=function(){return jn()},Fn=function(n,t){var e=n.dom();if(1!==e.nodeType)return!1;var r=e;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Ln=function(n){return 1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType||0===n.childElementCount},Hn=function(n,t){return n.dom()===t.dom()},qn=function(t,e){return r=t.dom(),o=e.dom(),function(n,t,e){return 0!=(n.compareDocumentPosition(t)&e)}(r,o,n.Node.DOCUMENT_POSITION_CONTAINED_BY);var r,o},Vn=function(n,t){return zn().browser.isIE()?qn(n,t):function(n,t){var e=n.dom(),r=t.dom();return e!==r&&e.contains(r)}(n,t)},Un=Fn,Kn=function(n){return bn.fromDom(n.dom().ownerDocument)},$n=function(n){return d.from(n.dom().parentNode).map(bn.fromDom)},Xn=function(n,t){for(var e=y(t)?t:c,r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var u=r.parentNode,i=bn.fromDom(u);if(o.push(i),!0===e(i))break;r=u}return o},Gn=function(n){return d.from(n.dom().previousSibling).map(bn.fromDom)},Yn=function(n){return d.from(n.dom().nextSibling).map(bn.fromDom)},Jn=function(n){return A(n.dom().childNodes,bn.fromDom)},Qn=function(n,t){var e=n.dom().childNodes;return d.from(e[t]).map(bn.fromDom)},Zn=y(n.Element.prototype.attachShadow)&&y(n.Node.prototype.getRootNode),nt=r(Zn),tt=Zn?function(n){return bn.fromDom(n.dom().getRootNode())}:function(n){return nn(n)?n:Kn(n)},et=function(n){var t=tt(n);return tn(t)?d.some(t):d.none()},rt=function(n){return bn.fromDom(n.dom().host)},ot=function(n){if(nt()&&w(n.target)){var t=bn.fromDom(n.target);if(Q(t)&&ut(bn.fromDom(n.target))){var e=n;if(e.composed&&e.composedPath){var r=e.composedPath();if(r)return 0===(o=r).length?d.none():d.some(o[0])}}}var o;return d.from(n.target)},ut=function(n){return w(n.dom().shadowRoot)},it=function(n){var t,e,r=Z(n)?n.dom().parentNode:n.dom();return null!=r&&null!==r.ownerDocument&&et(bn.fromDom(r)).fold(function(){return r.ownerDocument.body.contains(r)},(t=it,e=rt,function(n){return t(e(n))}))},ct=function(n){var t=n.dom().body;if(null==t)throw new Error("Body is not available yet");return bn.fromDom(t)},at=function(t,e,r){if(!p(r))throw n.console.error("Invalid call to CSS.set. Property ",e,":: Value ",r,":: Element ",t),new Error("CSS value must be a string: "+r);hn(t)&&t.style.setProperty(e,r)},lt=function(n,t,e){var r=n.dom();at(r,t,e)},ft=function(n,t){var e=n.dom();H(t,function(n,t){at(e,t,n)})},st=function(t,e){var r=t.dom(),o=n.window.getComputedStyle(r).getPropertyValue(e);return""!==o||it(t)?o:dt(r,e)},dt=function(n,t){return hn(n)?n.style.getPropertyValue(t):""},mt=function(n,t){var e=n.dom(),r=dt(e,t);return d.from(r).filter(function(n){return n.length>0})},gt=function(n,t){!function(n,t){hn(n)&&n.style.removeProperty(t)}(n.dom(),t),cn(n,"style").map(gn).is("")&&ln(n,"style")},pt=function(n,t){$n(n).each(function(e){e.dom().insertBefore(t.dom(),n.dom())})},ht=function(n,t){Yn(n).fold(function(){$n(n).each(function(n){bt(n,t)})},function(n){pt(n,t)})},vt=function(n,t){(function(n){return Qn(n,0)})(n).fold(function(){bt(n,t)},function(e){n.dom().insertBefore(t.dom(),e.dom())})},bt=function(n,t){n.dom().appendChild(t.dom())},wt=function(n,t){pt(n,t),bt(t,n)},yt=function(n,t){B(t,function(e,r){var o=0===r?n:t[r-1];ht(o,e)})},Ct=function(n,t){B(t,function(t){bt(n,t)})},St=function(n){n.dom().textContent="",B(Jn(n),function(n){xt(n)})},xt=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Tt=function(n){var t,e=Jn(n);e.length>0&&(t=n,B(e,function(n){pt(t,n)})),xt(n)},Rt=function(n,t,e){return{element:r(n),rowspan:r(t),colspan:r(e)}},Ot=function(n,t,e){return{element:r(n),cells:r(t),section:r(e)}},Dt=function(n,t){return{element:r(n),isNew:r(t)}},At=function(n,t){return{cells:r(n),section:r(t)}},Bt=function(n,t){var e=[];return B(Jn(n),function(n){t(n)&&(e=e.concat([n])),e=e.concat(Bt(n,t))}),e},It=function(n,t,e){return function(n,t,e){return I(Xn(n,e),t)}(n,function(n){return Fn(n,t)},e)},Pt=function(n,t){return function(n,t){return I(Jn(n),t)}(n,function(n){return Fn(n,t)})},kt=function(t,e){return function(t,e){var r=void 0===e?n.document:e.dom();return Ln(r)?[]:A(r.querySelectorAll(t),bn.fromDom)}(e,t)};function Et(n,t,e,r,o){return n(e,r)?d.some(e):y(o)&&o(e)?d.none():t(e,r,o)}var Mt=function(n,t,e){for(var o=n.dom(),u=y(e)?e:r(!1);o.parentNode;){o=o.parentNode;var i=bn.fromDom(o);if(t(i))return d.some(i);if(u(i))break}return d.none()},Nt=function(n,t,e){return Mt(n,function(n){return Fn(n,t)},e)},_t=function(n,t){return function(n,t){return E(n.dom().childNodes,function(n){return t(bn.fromDom(n))}).map(bn.fromDom)}(n,function(n){return Fn(n,t)})},Wt=function(t,e){return function(t,e){var r=void 0===e?n.document:e.dom();return Ln(r)?d.none():d.from(r.querySelector(t)).map(bn.fromDom)}(e,t)},jt=function(n,t,e){return Et(function(n,t){return Fn(n,t)},Nt,n,t,e)},zt=function(n,t,e){return void 0===e&&(e=0),cn(n,t).map(function(n){return parseInt(n,10)}).getOr(e)},Ft=function(n,t){return zt(n,t,1)},Lt=function(n){return Ft(n,"colspan")>1},Ht=function(n){return Ft(n,"rowspan")>1},qt=function(n,t){return parseInt(st(n,t),10)},Vt=r(10),Ut=r(10),Kt=function(n,t){return $t(n,t,r(!0))},$t=function(n,t,e){return _(Jn(n),function(n){return Fn(n,t)?e(n)?[n]:[]:$t(n,t,e)})},Xt=function(n,t){return function(n,t,e){if(void 0===e&&(e=c),e(t))return d.none();if(R(n,X(t)))return d.some(t);return Nt(t,n.join(","),function(n){return Fn(n,"table")||e(n)})}(["td","th"],n,t)},Gt=function(n){return Kt(n,"th,td")},Yt=function(n,t){return jt(n,"table",t)},Jt=function(n){return Kt(n,"tr")},Qt=function(n){var t=Jt(n);return A(t,function(n){var t=n,e=$n(t).map(function(n){var t=X(n);return"tfoot"===t||"thead"===t||"tbody"===t?t:"tbody"}).getOr("tbody"),r=A(Gt(n),function(n){var t=zt(n,"rowspan",1),e=zt(n,"colspan",1);return Rt(n,t,e)});return Ot(t,r,e)})},Zt=function(n,t){return n+","+t},ne=function(n,t){var e=_(n.all,function(n){return n.cells()});return I(e,t)},te=function(n){var t,e={},o=[],u=n.length,i=0;return B(n,function(n,t){var u=[];B(n.cells(),function(n){for(var o=0;void 0!==e[Zt(t,o)];)o++;for(var c,a,l,f,s,d=(c=n.element(),a=n.rowspan(),l=n.colspan(),f=t,s=o,{element:r(c),rowspan:r(a),colspan:r(l),row:r(f),column:r(s)}),m=0;m<n.colspan();m++)for(var g=0;g<n.rowspan();g++){var p=o+m,h=Zt(t+g,p);e[h]=d,i=Math.max(i,p+1)}u.push(d)}),o.push(Ot(n.element(),u,n.section()))}),{grid:(t=i,{rows:r(u),columns:r(t)}),access:e,all:o}},ee={fromTable:function(n){var t=Qt(n);return te(t)},generate:te,getAt:function(n,t,e){var r=n.access[Zt(t,e)];return void 0!==r?d.some(r):d.none()},findItem:function(n,t,e){var r=ne(n,function(n){return e(t,n.element())});return r.length>0?d.some(r[0]):d.none()},filterItems:ne,justCells:function(n){var t=A(n.all,function(n){return n.cells()});return N(t)}},re=function(n,t,e){var r=n[e].element(),o=bn.fromTag("td");bt(o,bn.fromTag("br")),(t?bt:vt)(r,o)},oe=function(n,t){var e=function(n){return Fn(n.element(),t)},r=Qt(n),o=ee.generate(r),u=function(n,t){var e=n.grid.columns(),r=n.grid.rows(),o=e,u=0,i=0;return H(n.access,function(n){if(t(n)){var e=n.row(),c=e+n.rowspan()-1,a=n.column(),l=a+n.colspan()-1;e<r?r=e:c>u&&(u=c),a<o?o=a:l>i&&(i=l)}}),function(n,t,e,r){return{minRow:n,minCol:t,maxRow:e,maxCol:r}}(r,o,u,i)}(o,e),i="th:not("+t+"),td:not("+t+")",c=$t(n,"th,td",function(n){return Fn(n,i)});return B(c,xt),function(n,t,e,r){for(var o=t.grid.columns(),u=t.grid.rows(),i=0;i<u;i++)for(var c=!1,a=0;a<o;a++)i<e.minRow||i>e.maxRow||a<e.minCol||a>e.maxCol||(ee.getAt(t,i,a).filter(r).isNone()?re(n,c,i):c=!0)}(r,o,u,e),function(n,t){var e=I(Kt(n,"tr"),function(n){return 0===n.dom().childElementCount});B(e,xt),t.minCol!==t.maxCol&&t.minRow!==t.maxRow||B(Kt(n,"th,td"),function(n){ln(n,"rowspan"),ln(n,"colspan")}),ln(n,"width"),ln(n,"height"),gt(n,"width"),gt(n,"height")}(n,u),n};var ue=function(n,t){var e=function(t){return n(t)?d.from(t.dom().nodeValue):d.none()};return{get:function(r){if(!n(r))throw new Error("Can only get "+t+" value of a "+t+" node");return e(r).getOr("")},getOption:e,set:function(e,r){if(!n(e))throw new Error("Can only set raw "+t+" value of a "+t+" node");e.dom().nodeValue=r}}}(Z,"text"),ie=function(n){return ue.get(n)},ce=function(n){return ue.getOption(n)},ae=function(n,t){return ue.set(n,t)},le=function(n){return"img"===X(n)?1:ce(n).fold(function(){return Jn(n).length},function(n){return n.length})},fe=["img","br"],se=function(n){return ce(n).filter(function(n){return 0!==n.trim().length||n.indexOf(" ")>-1}).isSome()||R(fe,X(n))},de=function(n){return t=se,(e=function(n){for(var r=0;r<n.childNodes.length;r++){var o=bn.fromDom(n.childNodes[r]);if(t(o))return d.some(o);var u=e(n.childNodes[r]);if(u.isSome())return u}return d.none()})(n.dom());var t,e},me=function(n){return ge(n,se)},ge=function(n,t){var e=function(n){for(var r=Jn(n),o=r.length-1;o>=0;o--){var u=r[o];if(t(u))return d.some(u);var i=e(u);if(i.isSome())return i}return d.none()};return e(n)},pe=function(n,t){return bn.fromDom(n.dom().cloneNode(t))},he=function(n){return pe(n,!1)},ve=function(n){return pe(n,!0)},be=function(n,t){var e=function(n,t){var e=bn.fromTag(t),r=fn(n);return on(e,r),e}(n,t),r=Jn(ve(n));return Ct(e,r),e},we=function(){var n=bn.fromTag("td");return bt(n,bn.fromTag("br")),n},ye=function(n,t,e){var r=be(n,t);return H(e,function(n,t){null===n?ln(r,t):rn(r,t,n)}),r},Ce=function(n){return n},Se=function(n){return function(){return bn.fromTag("tr",n.dom())}},xe=function(n,t,e){return{row:Se(t),cell:function(t){var r,o,u,i,c=Kn(t.element()),a=bn.fromTag(X(t.element()),c.dom()),l=e.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),f=l.length>0?function(n,t,e){return de(n).map(function(r){var o=e.join(","),u=It(r,o,function(t){return Hn(t,n)});return P(u,function(n,t){var e=he(t);return ln(e,"contenteditable"),bt(n,e),e},t)}).getOr(t)}(t.element(),a,l):a;return bt(f,bn.fromTag("br")),r=t.element(),o=a,u=r.dom(),i=o.dom(),hn(u)&&hn(i)&&(i.style.cssText=u.style.cssText),gt(a,"height"),1!==t.colspan()&&gt(t.element(),"width"),n(t.element(),a),a},replace:ye,gap:we}},Te=function(n){return{row:Se(n),cell:we,replace:Ce,gap:we}},Re=function(n,t){var e=t.column(),r=t.column()+t.colspan()-1,o=t.row(),u=t.row()+t.rowspan()-1;return e<=n.finishCol()&&r>=n.startCol()&&o<=n.finishRow()&&u>=n.startRow()},Oe=function(n,t){return t.column()>=n.startCol()&&t.column()+t.colspan()-1<=n.finishCol()&&t.row()>=n.startRow()&&t.row()+t.rowspan()-1<=n.finishRow()},De=function(n,t){return e=Math.min(n.row(),t.row()),o=Math.min(n.column(),t.column()),u=Math.max(n.row()+n.rowspan()-1,t.row()+t.rowspan()-1),i=Math.max(n.column()+n.colspan()-1,t.column()+t.colspan()-1),{startRow:r(e),startCol:r(o),finishRow:r(u),finishCol:r(i)};var e,o,u,i},Ae=function(n,t,e){var r=ee.findItem(n,t,Hn),o=ee.findItem(n,e,Hn);return r.bind(function(n){return o.map(function(t){return De(n,t)})})},Be=function(n,t,e){return Ae(n,t,e).bind(function(t){return function(n,t){for(var e=!0,r=u(Oe,t),o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)e=e&&ee.getAt(n,o,i).exists(r);return e?d.some(t):d.none()}(n,t)})},Ie=function(n,t,e){return Ae(n,t,e).map(function(t){var e=ee.filterItems(n,u(Re,t));return A(e,function(n){return n.element()})})},Pe=function(n,t){return ee.findItem(n,t,function(n,t){return Vn(t,n)}).map(function(n){return n.element()})},ke=function(n,t,e){return Yt(n).bind(function(r){return function(n,t,e,r){return ee.findItem(n,t,Hn).bind(function(t){var o=e>0?t.row()+t.rowspan()-1:t.row(),u=r>0?t.column()+t.colspan()-1:t.column();return ee.getAt(n,o+e,u+r).map(function(n){return n.element()})})}(Me(r),n,t,e)})},Ee=function(n,t,e,r,o){var u=Me(n),i=Hn(n,e)?d.some(t):Pe(u,t),c=Hn(n,o)?d.some(r):Pe(u,r);return i.bind(function(n){return c.bind(function(t){return Ie(u,n,t)})})},Me=ee.fromTable,Ne=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function _e(){return{up:r({selector:Nt,closest:jt,predicate:Mt,all:Xn}),down:r({selector:kt,predicate:Bt}),styles:r({get:st,getRaw:mt,set:lt,remove:gt}),attrs:r({get:un,set:rn,remove:ln,copyTo:function(n,t){var e=fn(n);on(t,e)}}),insert:r({before:pt,after:ht,afterAll:yt,append:bt,appendAll:Ct,prepend:vt,wrap:wt}),remove:r({unwrap:Tt,remove:xt}),create:r({nu:bn.fromTag,clone:function(n){return bn.fromDom(n.dom().cloneNode(!1))},text:bn.fromText}),query:r({comparePosition:function(n,t){return n.dom().compareDocumentPosition(t.dom())},prevSibling:Gn,nextSibling:Yn}),property:r({children:Jn,name:X,parent:$n,document:function(n){return n.dom().ownerDocument},isText:Z,isComment:J,isElement:Q,getText:ie,setText:ae,isBoundary:function(n){return!!Q(n)&&("body"===X(n)||R(Ne,X(n)))},isEmptyTag:function(n){return!!Q(n)&&R(["br","img","hr","input"],X(n))},isNonEditable:function(n){return Q(n)&&"false"===un(n,"contenteditable")}}),eq:Hn,is:Un}}var We=function(n,t,e,r){var o=t(n,e);return P(r,function(e,r){var o=t(n,r);return je(n,e,o)},o)},je=function(n,t,e){return t.bind(function(t){return e.filter(u(n.eq,t))})},ze=function(n,t,e){return e.length>0?function(n,t,e,r){return r(n,t,e[0],e.slice(1))}(n,t,e,We):d.none()},Fe=function(n,t,e,o){void 0===o&&(o=c);var i=[t].concat(n.up().all(t)),a=[e].concat(n.up().all(e)),l=function(n){return M(n,o).fold(function(){return n},function(t){return n.slice(0,t+1)})},f=l(i),s=l(a),d=E(f,function(t){return O(s,function(n,t){return u(n.eq,t)}(n,t))});return{firstpath:r(f),secondpath:r(s),shared:r(d)}},Le=_e(),He=function(n,t){return ze(Le,function(t,e){return n(e)},t)},qe=function(n){return Nt(n,"table")},Ve=function(n,t,e){var r=function(n){return function(t){return void 0!==e&&e(t)||Hn(t,n)}};return Hn(n,t)?d.some({boxes:d.some([n]),start:n,finish:t}):qe(n).bind(function(o){return qe(t).bind(function(u){if(Hn(o,u))return d.some({boxes:(l=o,f=n,s=t,m=Me(l),Ie(m,f,s)),start:n,finish:t});if(Vn(o,u)){var i=(c=It(t,"td,th",r(o))).length>0?c[c.length-1]:t;return d.some({boxes:Ee(o,n,o,t,u),start:n,finish:i})}if(Vn(u,o)){var c,a=(c=It(n,"td,th",r(u))).length>0?c[c.length-1]:n;return d.some({boxes:Ee(u,n,o,t,u),start:n,finish:a})}return function(n,t,e){return Fe(Le,n,t,e)}(n,t).shared().bind(function(i){return jt(i,"table",e).bind(function(e){var i=It(t,"td,th",r(e)),c=i.length>0?i[i.length-1]:t,a=It(n,"td,th",r(e)),l=a.length>0?a[a.length-1]:n;return d.some({boxes:Ee(e,n,o,t,u),start:l,finish:c})})});var l,f,s,m})})},Ue=function(n,t){var e=kt(n,t);return e.length>0?d.some(e):d.none()},Ke=function(n,t,e){return Wt(n,t).bind(function(t){return Wt(n,e).bind(function(n){return He(qe,[t,n]).map(function(e){return{first:r(t),last:r(n),table:r(e)}})})})},$e=function(n,t,e,r,o){return function(n,t){return E(n,function(n){return Fn(n,t)})}(n,o).bind(function(n){return ke(n,t,e).bind(function(n){return function(n,t){return Nt(n,"table").bind(function(e){return Wt(e,t).bind(function(t){return Ve(t,n).bind(function(n){return n.boxes.map(function(t){return{boxes:t,start:n.start,finish:n.finish}})})})})}(n,r)})})},Xe=function(n,t,e){return Ke(n,t,e).bind(function(t){var e=function(t){return Hn(n,t)},r=Nt(t.first(),"thead,tfoot,tbody,table",e),o=Nt(t.last(),"thead,tfoot,tbody,table",e);return r.bind(function(n){return o.bind(function(e){return Hn(n,e)?(r=t.table(),o=t.first(),u=t.last(),i=Me(r),Be(i,o,u)):d.none();var r,o,u,i})})})},Ge="data-mce-first-selected",Ye="data-mce-last-selected",Je=Object.freeze({__proto__:null,selected:"data-mce-selected",selectedSelector:"td[data-mce-selected],th[data-mce-selected]",attributeSelector:"[data-mce-selected]",firstSelected:Ge,firstSelectedSelector:"td[data-mce-first-selected],th[data-mce-first-selected]",lastSelected:Ye,lastSelectedSelector:"td[data-mce-last-selected],th[data-mce-last-selected]"}),Qe=function(t){if(!v(t))throw new Error("cases must be an array");if(0===t.length)throw new Error("there must be at least one case");var e=[],r={};return B(t,function(o,u){var i=F(o);if(1!==i.length)throw new Error("one and only one name per case");var c=i[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!v(a))throw new Error("case arguments must be an array");e.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),i=0;i<o.length;i++)o[i]=arguments[i];return{fold:function(){if(arguments.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+arguments.length);return arguments[u].apply(null,o)},match:function(n){var t=F(n);if(e.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+t.join(","));if(!W(e,function(n){return R(t,n)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+e.join(", "));return n[c].apply(null,o)},log:function(t){n.console.log(t,{constructors:e,constructor:c,params:o})}}}}),r},Ze=Qe([{none:[]},{multiple:["elements"]},{single:["selection"]}]),nr=function(n,t,e,r){return n.fold(t,e,r)},tr=Ze.none,er=Ze.multiple,rr=Ze.single,or=function(n,t){return nr(t.get(),r([]),o,r([n]))},ur=function(n,t){var e=or(n,t);return e.length>0&&W(e,function(n){return an(n,"rowspan")&&parseInt(un(n,"rowspan"),10)>1||an(n,"colspan")&&parseInt(un(n,"colspan"),10)>1})?d.some(e):d.none()},ir=function(n,t){return nr(t.get(),d.none,function(t,e){return 0===t.length?d.none():Xe(n,"td[data-mce-first-selected],th[data-mce-first-selected]","td[data-mce-last-selected],th[data-mce-last-selected]").bind(function(n){return t.length>1?d.some({bounds:r(n),cells:r(t)}):d.none()})},d.none)},cr=function(n){return{element:r(n),mergable:d.none,unmergable:d.none,selection:r([n])}},ar=function(n,t,e){return{element:r(e),mergable:r(ir(t,n)),unmergable:r(ur(e,n)),selection:r(or(e,n))}},lr=function(t,o,u,i){t.on("BeforeGetContent",function(n){!0===n.selection&&nr(o.get(),e,function(e){n.preventDefault(),function(n){return Yt(n[0]).map(ve).map(function(n){return[oe(n,"[data-mce-selected]")]})}(e).each(function(e){n.content="text"===n.format?function(n){return A(n,function(n){return n.dom().innerText}).join("")}(e):function(n,t){return A(t,function(t){return n.selection.serializer.serialize(t.dom(),{})}).join("")}(t,e)})},e)}),t.on("BeforeSetContent",function(e){!0===e.selection&&!0===e.paste&&d.from(t.dom.getParent(t.selection.getStart(),"th,td")).each(function(o){var c=bn.fromDom(o);Yt(c).each(function(o){var a,l,f,s,d=I((a=e.content,(f=(l||n.document).createElement("div")).innerHTML=a,Jn(bn.fromDom(f))),function(n){return"meta"!==X(n)});if(1===d.length&&(s=d[0],"table"===X(s))){e.preventDefault();var m=bn.fromDom(t.getDoc()),g=Te(m),p=function(n,t,e){return{element:r(n),clipboard:r(t),generators:r(e)}}(c,d[0],g);u.pasteCells(o,p).each(function(n){t.selection.setRng(n),t.focus(),i.clear(o)})}})})})},fr=function(n,t){return{left:r(n),top:r(t),translate:function(e,r){return fr(n+e,t+r)}}},sr=fr,dr=function(n,t){return void 0!==n?n:void 0!==t?t:0},mr=function(n){var t=n.dom().ownerDocument,e=t.body,r=t.defaultView,o=t.documentElement;if(e===n.dom())return sr(e.offsetLeft,e.offsetTop);var u=dr(r.pageYOffset,o.scrollTop),i=dr(r.pageXOffset,o.scrollLeft),c=dr(o.clientTop,e.clientTop),a=dr(o.clientLeft,e.clientLeft);return gr(n).translate(i-a,u-c)},gr=function(n){var t=n.dom(),e=t.ownerDocument.body;return e===t?sr(e.offsetLeft,e.offsetTop):it(n)?function(n){var t=n.getBoundingClientRect();return sr(t.left,t.top)}(t):sr(0,0)},pr=function(n){var t=d.from(n.dom().documentElement).map(bn.fromDom).getOr(n);return{parent:r(t),view:r(n),origin:r(sr(0,0))}},hr=function(n,t){return{parent:r(t),view:r(n),origin:r(sr(0,0))}};function vr(n,t){var e=function(e){var r=t(e);if(r<=0||null===r){var o=st(e,n);return parseFloat(o)||0}return r},r=function(n,t){return k(t,function(t,e){var r=st(n,e),o=void 0===r?0:parseInt(r,10);return isNaN(o)?t:t+o},0)};return{set:function(t,e){if(!C(e)&&!e.match(/^[0-9]+$/))throw new Error(n+".set accepts only positive integer values. Value was "+e);var r=t.dom();hn(r)&&(r.style[n]=e+"px")},get:e,getOuter:e,aggregate:r,max:function(n,t,e){var o=r(n,e);return t>o?t-o:0}}}var br=vr("height",function(n){var t=n.dom();return it(n)?t.getBoundingClientRect().height:t.offsetHeight}),wr=function(n){return br.get(n)},yr=function(n){return br.getOuter(n)},Cr=vr("width",function(n){return n.dom().offsetWidth}),Sr=function(n){return Cr.get(n)},xr=function(n){return Cr.getOuter(n)},Tr=function(n,t){return{row:n,y:t}},Rr=function(n,t){return{col:n,x:t}},Or=function(n){return mr(n).left()+xr(n)},Dr=function(n){return mr(n).left()},Ar=function(n,t){return Rr(n,Dr(t))},Br=function(n,t){return Rr(n,Or(t))},Ir=function(n){return mr(n).top()},Pr=function(n,t){return Tr(n,Ir(t))},kr=function(n,t){return Tr(n,Ir(t)+yr(t))},Er=function(n,t,e){if(0===e.length)return[];var r=A(e.slice(1),function(t,e){return t.map(function(t){return n(e,t)})}),o=e[e.length-1].map(function(n){return t(e.length-1,n)});return r.concat([o])},Mr={delta:o,positions:function(n){return Er(Pr,kr,n)},edge:Ir},Nr={delta:o,edge:Dr,positions:function(n){return Er(Ar,Br,n)}},_r={delta:function(n){return-n},edge:Or,positions:function(n){return Er(Br,Ar,n)}},Wr=function(n){var t=n.grid,e=D(t.columns(),o),u=D(t.rows(),o);return A(e,function(t){return jr(function(){return _(u,function(e){return ee.getAt(n,e,t).filter(function(n){return n.column()===t}).fold(r([]),function(n){return[n]})})},function(n){return 1===n.colspan()},function(){return ee.getAt(n,0,t)})})},jr=function(n,t,e){var r=n();return E(r,t).orThunk(function(){return d.from(r[0]).orThunk(e)}).map(function(n){return n.element()})},zr=function(n){var t=n.grid,e=D(t.rows(),o),u=D(t.columns(),o);return A(e,function(t){return jr(function(){return _(u,function(e){return ee.getAt(n,t,e).filter(function(n){return n.row()===t}).fold(r([]),function(n){return[n]})})},function(n){return 1===n.rowspan()},function(){return ee.getAt(n,t,0)})})},Fr=function(n,t){if(t<0||t>=n.length-1)return d.none();var e=n[t].fold(function(){var e=function(n){var t=S.call(n,0);return t.reverse(),t}(n.slice(0,t));return z(e,function(n,t){return n.map(function(n){return{value:n,delta:t+1}})})},function(n){return d.some({value:n,delta:0})}),r=n[t+1].fold(function(){var e=n.slice(t+1);return z(e,function(n,t){return n.map(function(n){return{value:n,delta:t+1}})})},function(n){return d.some({value:n,delta:1})});return e.bind(function(n){return r.map(function(t){var e=t.delta+n.delta;return Math.abs(t.value-n.value)/e})})},Lr=function(){var n=zn().browser;return n.isIE()||n.isEdge()},Hr=function(n,t,e){return function(n,t){var e=parseFloat(n);return isNaN(e)?t:e}(st(n,t),e)},qr=function(n){return Lr()?function(n){var t=n.dom().getBoundingClientRect().height;return"border-box"===st(n,"box-sizing")?t:t-Hr(n,"padding-top",0)-Hr(n,"padding-bottom",0)-(Hr(n,"border-top-width",0)+Hr(n,"border-bottom-width",0))}(n):Hr(n,"height",wr(n))},Vr=function(n){return Lr()?function(n){var t=n.dom().getBoundingClientRect().width;return"border-box"===st(n,"box-sizing")?t:t-Hr(n,"padding-left",0)-Hr(n,"padding-right",0)-(Hr(n,"border-left-width",0)+Hr(n,"border-right-width",0))}(n):Hr(n,"width",Sr(n))},Ur=/(\d+(\.\d+)?)(\w|%)*/,Kr=/(\d+(\.\d+)?)%/,$r=/(\d+(\.\d+)?)px|em/,Xr=function(n,t){var e,r=(e=n,d.from(e.dom().offsetParent).map(bn.fromDom)).getOr(ct(Kn(n)));return t(n)/t(r)*100},Gr=function(n,t){lt(n,"width",t+"px")},Yr=function(n,t){lt(n,"width",t+"%")},Jr=function(n,t){lt(n,"height",t+"px")},Qr=function(n,t,e,r){var o=parseInt(n,10);return mn(n,"%")&&"table"!==X(t)?function(n,t,e,r){var o=Yt(n).map(function(n){var r=e(n);return Math.floor(t/100*r)}).getOr(t);return r(n,o),o}(t,o,e,r):o},Zr=function(n){var t=function(n){return mt(n,"height").getOrThunk(function(){return qr(n)+"px"})}(n);return t?Qr(t,n,wr,Jr):wr(n)},no=function(n){return mt(n,"width").fold(function(){return d.from(un(n,"width"))},function(n){return d.some(n)})},to=function(n,t){return n/t.pixelWidth()*100},eo=function(n,t){return no(n).fold(function(){var e=Sr(n);return to(e,t)},function(e){return function(n,t,e){var r=Kr.exec(t);if(null!==r)return parseFloat(r[1]);var o=Vr(n);return to(o,e)}(n,e,t)})},ro=function(n,t){return no(n).fold(function(){return Vr(n)},function(e){return function(n,t,e){var r=$r.exec(t);if(null!==r)return parseInt(r[1],10);var o=Kr.exec(t);return null!==o?function(n,t){return n/100*t.pixelWidth()}(parseFloat(o[1]),e):Vr(n)}(n,e,t)})},oo=function(n){return function(n,t,e){return e(n)/Ft(n,t)}(n,"rowspan",Zr)},uo=function(n,t,e){lt(n,"width",t+e)},io=function(n){return Xr(n,Sr)+"%"},co=r(Kr),ao=r($r),lo=function(n,t,e){return mt(n,t).fold(function(){return e(n)+"px"},function(n){return n})},fo=function(n,t){return lo(n,"width",function(n){return ro(n,t)})},so=function(n){return lo(n,"height",oo)},mo=function(n,t,e,r,o){var u=Wr(n),c=A(u,function(n){return n.map(t.edge)});return A(u,function(n,t){return n.filter(i(Lt)).fold(function(){var n=Fr(c,t);return r(n)},function(n){return e(n,o)})})},go=function(n){return n.map(function(n){return n+"px"}).getOr("")},po=function(n,t,e){return mo(n,t,eo,function(n){return n.fold(function(){return e.minCellWidth()},function(n){return n/e.pixelWidth()*100})},e)},ho=function(n,t,e){return mo(n,t,ro,function(n){return n.getOrThunk(e.minCellWidth)},e)},vo=function(n,t,e,r){var o=zr(n),u=A(o,function(n){return n.map(t.edge)});return A(o,function(n,t){return n.filter(i(Ht)).fold(function(){var n=Fr(u,t);return r(n)},function(n){return e(n)})})},bo=Qe([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),wo=function(n,t,e){var r=e.substring(0,e.length-n.length),o=parseFloat(r);return r===o.toString()?t(o):bo.invalid(e)},yo=wn(wn({},bo),{from:function(n){return mn(n,"%")?wo("%",bo.percent,n):mn(n,"px")?wo("px",bo.pixels,n):bo.invalid(n)}}),Co=function(n,t,e){return n.fold(function(){return t},function(n){return function(n,t,e){var r=e/t;return A(n,function(n){return yo.from(n).fold(function(){return n},function(n){return n*r+"px"},function(n){return n/100*e+"px"})})}(t,e,n)},function(n){return function(n,t){return A(n,function(n){return yo.from(n).fold(function(){return n},function(n){return n/t*100+"%"},function(n){return n+"%"})})}(t,e)})},So=function(n,t,e){var o,u,i,c=yo.from(e),a=W(n,function(n){return"0px"===n})?(o=c,u=n.length,i=o.fold(function(){return r("")},function(n){return r(n/u+"px")},function(n){return r(n/u+"px")}),D(u,i)):Co(c,n,t);return To(a)},xo=function(n,t){return 0===n.length?t:P(n,function(n,t){return yo.from(t).fold(r(0),o,o)+n},0)},To=function(n){if(0===n.length)return n;var t,e,o=P(n,function(n,t){var e=yo.from(t).fold(function(){return{value:t,remainder:0}},function(n){return function(n,t){var e=Math.floor(n);return{value:e+t,remainder:n-e}}(n,"px")},function(n){return{value:n+"%",remainder:0}});return{output:[e.value].concat(n.output),remainder:n.remainder+e.remainder}},{output:[],remainder:0}),u=o.output;return u.slice(0,u.length-1).concat([(t=u[u.length-1],e=Math.round(o.remainder),yo.from(t).fold(r(t),function(n){return n+e+"px"},function(n){return n+e+"%"}))])},Ro=yo.from,Oo=function(n){return Ro(n).fold(r("px"),r("px"),r("%"))},Do=function(n,t,e,r,o){var u=ee.fromTable(n),i=u.all,c=ee.justCells(u);t.each(function(t){var e=Oo(t),i=Sr(n),a=function(n,t,e){return mo(n,t,fo,go,e)}(u,r,o);!function(n,t,e){B(t,function(t){var r=n.slice(t.column(),t.colspan()+t.column()),o=xo(r,Vt());lt(t.element(),"width",o+e)})}(So(a,i,t),c,e),lt(n,"width",t)}),e.each(function(t){var e=Oo(t),r=wr(n),o=function(n,t){return vo(n,t,so,go)}(u,Mr);!function(n,t,e,r){B(e,function(t){var e=n.slice(t.row(),t.rowspan()+t.row()),o=xo(e,Ut());lt(t.element(),"height",o+r)}),B(t,function(t,e){lt(t.element(),"height",n[e])})}(So(o,r,t),i,c,e),lt(n,"height",t)})},Ao=function(n){return no(n).exists(function(n){return Kr.test(n)})},Bo=function(n){return no(n).exists(function(n){return $r.test(n)})},Io=function(n){return no(n).isNone()},Po=io,ko={ltr:Nr,rtl:_r},Eo=function(n){var t=function(t){return n(t).isRtl()?ko.rtl:ko.ltr};return{delta:function(n,e){return t(e).delta(n,e)},edge:function(n){return t(n).edge(n)},positions:function(n,e){return t(e).positions(n,e)}}},Mo=function(n){var t=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(n.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+t.length+" arguments");var o={};return B(n,function(n,e){o[n]=r(t[e])}),o}}.apply(null,n),e=[];return{bind:function(n){if(void 0===n)throw new Error("Event bind error: undefined handler");e.push(n)},unbind:function(n){e=I(e,function(t){return t!==n})},trigger:function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=t.apply(null,n);B(e,function(n){n(o)})}}},No=function(n){return{registry:q(n,function(n){return{bind:n.bind,unbind:n.unbind}}),trigger:q(n,function(n){return n.trigger})}},_o=Qe([{none:[]},{only:["index"]},{left:["index","next"]},{middle:["prev","index","next"]},{right:["prev","index"]}]),Wo=wn({},_o),jo=function(n,t,e,o){var u=n.slice(0),i=function(n,t){return 0===n.length?Wo.none():1===n.length?Wo.only(0):0===t?Wo.left(0,1):t===n.length-1?Wo.right(t-1,t):t>0&&t<n.length-1?Wo.middle(t-1,t,t+1):Wo.none()}(n,t),c=function(n){return A(n,r(0))},a=r(c(u)),l=function(n,t){if(e>=0){var r=Math.max(o.minCellWidth(),u[t]-e);return c(u.slice(0,n)).concat([e,r-u[t]]).concat(c(u.slice(t+1)))}var i=Math.max(o.minCellWidth(),u[n]+e),a=u[n]-i;return c(u.slice(0,n)).concat([i-u[n],a]).concat(c(u.slice(t+1)))},f=l;return i.fold(a,function(n){return o.singleColumnWidth(u[n],e)},f,function(n,t,e){return l(t,e)},function(n,t){if(e>=0)return c(u.slice(0,t)).concat([e]);var r=Math.max(o.minCellWidth(),u[t]+e);return c(u.slice(0,t)).concat([r-u[t]])})},zo=function(n,t,e){for(var r=0,o=n;o<t;o++)r+=void 0!==e[o]?e[o]:0;return r},Fo=function(n,t){var e=ee.justCells(n);return A(e,function(n){var e=zo(n.column(),n.column()+n.colspan(),t);return{element:n.element(),width:e,colspan:n.colspan()}})},Lo=function(n,t){var e=ee.justCells(n);return A(e,function(n){var e=zo(n.row(),n.row()+n.rowspan(),t);return{element:n.element,height:r(e),rowspan:n.rowspan}})},Ho=function(n,t,e,o){var u=ee.fromTable(n),i=function(n,t){return vo(n,t,oo,function(n){return n.getOrThunk(Ut)})}(u,o),c=A(i,function(n,r){return e===r?Math.max(t+n,Ut()):n}),a=Lo(u,c),l=function(n,t){return A(n.all,function(n,e){return{element:n.element,height:r(t[e])}})}(u,c);B(l,function(n){Jr(n.element(),n.height())}),B(a,function(n){Jr(n.element(),n.height())});var f=P(c,function(n,t){return n+t},0);Jr(n,f)},qo=function(n){var t,e,o=bn.fromDom(ot(n).getOr(n.target)),u=function(){return n.stopPropagation()},i=function(){return n.preventDefault()},c=(t=i,e=u,function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t(e.apply(null,n))});return function(n,t,e,o,u,i,c){return{target:r(n),x:r(t),y:r(e),stop:o,prevent:u,kill:i,raw:r(c)}}(o,n.clientX,n.clientY,u,i,c,n)},Vo=function(n,t,e,r,o){var i=function(n,t){return function(e){n(e)&&t(qo(e))}}(e,r);return n.dom().addEventListener(t,i,o),{unbind:u(Uo,n,t,i,o)}},Uo=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},Ko=r(!0),$o=function(n,t,e){return function(n,t,e,r){return Vo(n,t,e,r,!1)}(n,t,Ko,e)},Xo=qo,Go=function(n,t){var e=un(n,t);return void 0===e||""===e?[]:e.split(" ")},Yo=function(n){return void 0!==n.dom().classList},Jo=function(n,t){return function(n,t,e){var r=Go(n,t).concat([e]);return rn(n,t,r.join(" ")),!0}(n,"class",t)},Qo=function(n,t){return function(n,t,e){var r=I(Go(n,t),function(n){return n!==e});return r.length>0?rn(n,t,r.join(" ")):ln(n,t),!1}(n,"class",t)},Zo=function(n,t){Yo(n)?n.dom().classList.add(t):Jo(n,t)},nu=function(n){0===(Yo(n)?n.dom().classList:function(n){return Go(n,"class")}(n)).length&&ln(n,"class")},tu=function(n,t){return Yo(n)&&n.dom().classList.contains(t)},eu=function(n){var t=n.replace(/\./g,"-");return{resolve:function(n){return t+"-"+n}}},ru=eu("ephox-dragster").resolve,ou=function(n){return n.slice(0).sort()},uu=function(n,t,e){if(0===t.length)throw new Error("You must specify at least one required field.");var r;return function(n,t){if(!v(t))throw new Error("The "+n+" fields must be an array. Was: "+t+".");B(t,function(t){if(!p(t))throw new Error("The value "+t+" in the "+n+" fields was not a string.")})}("required",t),r=ou(t),E(r,function(n,t){return t<r.length-1&&n===r[t+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+r.join(", ")+"].")}),function(r){var o=F(r);W(t,function(n){return R(o,n)})||function(n,t){throw new Error("All required keys ("+ou(n).join(", ")+") were not specified. Specified keys were: "+ou(t).join(", ")+".")}(t,o),n(t,o);var u=I(t,function(n){return!e.validate(r[n],n)});return u.length>0&&function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+ou(n).join(", ")+") were not.")}(u,e.label),r}},iu=function(n,t){var e=I(t,function(t){return!R(n,t)});e.length>0&&function(n){throw new Error("Unsupported keys for object: "+ou(n).join(", "))}(e)},cu=function(n){return function(n,t){return uu(n,t,{validate:y,label:"function"})}(iu,n)},au=cu(["compare","extract","mutate","sink"]),lu=cu(["element","start","stop","destroy"]),fu=cu(["forceDrop","drop","move","delayDrop"]),su=au({compare:function(n,t){return sr(t.left()-n.left(),t.top()-n.top())},extract:function(n){return d.some(sr(n.x(),n.y()))},sink:function(n,t){var e=function(n){var t=wn({layerClass:ru("blocker")},n),e=bn.fromTag("div");return rn(e,"role","presentation"),ft(e,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),Zo(e,ru("blocker")),Zo(e,t.layerClass),{element:function(){return e},destroy:function(){xt(e)}}}(t),r=$o(e.element(),"mousedown",n.forceDrop),o=$o(e.element(),"mouseup",n.drop),u=$o(e.element(),"mousemove",n.move),i=$o(e.element(),"mouseout",n.delayDrop);return lu({element:e.element,start:function(n){bt(n,e.element())},stop:function(){xt(e.element())},destroy:function(){e.destroy(),o.unbind(),u.unbind(),i.unbind(),r.unbind()}})},mutate:function(n,t){n.mutate(t.left(),t.top())}});function du(){var n=d.none(),t=No({move:Mo(["info"])});return{onEvent:function(e,r){r.extract(e).each(function(e){(function(t,e){var r=n.map(function(n){return t.compare(n,e)});return n=d.some(e),r})(r,e).each(function(n){t.trigger.move(n)})})},reset:function(){n=d.none()},events:t.registry}}function mu(){var n={onEvent:e,reset:e},t=du(),r=n;return{on:function(){r.reset(),r=t},off:function(){r.reset(),r=n},isOn:function(){return r===t},onEvent:function(n,t){r.onEvent(n,t)},events:t.events}}var gu=function(t,e,r){var o,u,i,c=!1,a=No({start:Mo([]),stop:Mo([])}),l=mu(),f=function(){m.stop(),l.isOn()&&(l.off(),a.trigger.stop())},s=(o=f,u=200,i=null,{cancel:function(){null!==i&&(n.clearTimeout(i),i=null)},throttle:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!==i&&n.clearTimeout(i),i=n.setTimeout(function(){o.apply(null,t),i=null},u)}});l.events.move.bind(function(n){e.mutate(t,n.info())});var d=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];c&&n.apply(null,t)}},m=e.sink(fu({forceDrop:f,drop:d(f),move:d(function(n){s.cancel(),l.onEvent(n,e)}),delayDrop:d(s.throttle)}),r);return{element:m.element,go:function(n){m.start(n),l.on(),a.trigger.start()},on:function(){c=!0},off:function(){c=!1},destroy:function(){m.destroy()},events:a.registry}},pu=function(n){return"true"===un(n,"contenteditable")},hu=eu("ephox-snooker"),vu=hu.resolve,bu=function(){var n=No({drag:Mo(["xDelta","yDelta","target"])}),t=d.none(),e=function(){var n=No({drag:Mo(["xDelta","yDelta"])});return{mutate:function(t,e){n.trigger.drag(t,e)},events:n.registry}}();e.events.drag.bind(function(e){t.each(function(t){n.trigger.drag(e.xDelta(),e.yDelta(),t)})});return{assign:function(n){t=d.some(n)},get:function(){return t},mutate:e.mutate,events:n.registry}},wu=vu("resizer-bar"),yu=vu("resizer-rows"),Cu=vu("resizer-cols"),Su=function(n){var t=kt(n.parent(),"."+wu);B(t,xt)},xu=function(n,t,e){var r=n.origin();B(t,function(t){t.each(function(t){var o=e(r,t);Zo(o,wu),bt(n.parent(),o)})})},Tu=function(n,t,e,r){xu(n,t,function(n,t){var o,u,i,c,a,l,f=(o=t.col,u=t.x-n.left(),i=e.top()-n.top(),c=7,a=r,l=bn.fromTag("div"),ft(l,{position:"absolute",left:u-c/2+"px",top:i+"px",height:a+"px",width:c+"px"}),on(l,{"data-column":o,role:"presentation"}),l);return Zo(f,Cu),f})},Ru=function(n,t,e,r){xu(n,t,function(n,t){var o,u,i,c,a,l,f=(o=t.row,u=e.left()-n.left(),i=t.y-n.top(),c=r,a=7,l=bn.fromTag("div"),ft(l,{position:"absolute",left:u+"px",top:i-a/2+"px",height:a+"px",width:c+"px"}),on(l,{"data-row":o,role:"presentation"}),l);return Zo(f,yu),f})},Ou=function(n,t,e,r){Su(n);var o=ee.fromTable(t);!function(n,t,e,r,o,u){var i=mr(t),c=e.length>0?o.positions(e,t):[];Ru(n,c,i,xr(t));var a=r.length>0?u.positions(r,t):[];Tu(n,a,i,yr(t))}(n,t,zr(o),Wr(o),e,r)},Du=function(n,t){var e=kt(n.parent(),"."+wu);B(e,t)},Au=function(n){Du(n,function(n){lt(n,"display","none")})},Bu=function(n){Du(n,function(n){lt(n,"display","block")})},Iu=vu("resizer-bar-dragging"),Pu=function(n,t,e){var r=bu(),o=function(n,t){void 0===t&&(t={});var e=void 0!==t.mode?t.mode:su;return gu(n,e,t)}(r,{}),i=d.none(),c=function(n,t){return d.from(un(n,t))};r.events.drag.bind(function(n){c(n.target(),"data-row").each(function(t){var e=qt(n.target(),"top");lt(n.target(),"top",e+n.yDelta()+"px")}),c(n.target(),"data-column").each(function(t){var e=qt(n.target(),"left");lt(n.target(),"left",e+n.xDelta()+"px")})});var a=function(n,t){return qt(n,t)-zt(n,"data-initial-"+t,0)};o.events.stop.bind(function(){r.get().each(function(r){i.each(function(o){c(r,"data-row").each(function(n){var t=a(r,"top");ln(r,"data-initial-top"),p.trigger.adjustHeight(o,t,parseInt(n,10))}),c(r,"data-column").each(function(n){var t=a(r,"left");ln(r,"data-initial-left"),p.trigger.adjustWidth(o,t,parseInt(n,10))}),Ou(n,o,e,t)})})});var l=function(t,e){p.trigger.startAdjust(),r.assign(t),rn(t,"data-initial-"+e,qt(t,e)),Zo(t,Iu),lt(t,"opacity","0.2"),o.go(n.parent())},f=$o(n.parent(),"mousedown",function(n){var t;t=n.target(),tu(t,yu)&&l(n.target(),"top"),function(n){return tu(n,Cu)}(n.target())&&l(n.target(),"left")}),s=function(t){return Hn(t,n.view())},m=function(n){return jt(n,"table",s).filter(function(n){return function(n,t){return jt(n,"[contenteditable]",t)}(n,s).exists(pu)})},g=$o(n.view(),"mouseover",function(r){m(r.target()).fold(function(){it(r.target())&&Su(n)},function(r){i=d.some(r),Ou(n,r,e,t)})}),p=No({adjustHeight:Mo(["table","delta","row"]),adjustWidth:Mo(["table","delta","column"]),startAdjust:Mo([])});return{destroy:function(){f.unbind(),g.unbind(),o.destroy(),Su(n)},refresh:function(r){Ou(n,r,e,t)},on:o.on,off:o.off,hideBars:u(Au,n),showBars:u(Bu,n),events:p.registry}},ku=function(n,t,e){var r=Mr,o=Pu(n,t,r),u=No({beforeResize:Mo(["table"]),afterResize:Mo(["table"]),startDrag:Mo([])});return o.events.adjustHeight.bind(function(n){var t=n.table();u.trigger.beforeResize(t);var e=r.delta(n.delta(),t);Ho(t,e,n.row(),r),u.trigger.afterResize(t)}),o.events.startAdjust.bind(function(n){u.trigger.startDrag()}),o.events.adjustWidth.bind(function(n){var r=n.table();u.trigger.beforeResize(r);var o=t.delta(n.delta(),r),i=e(r);!function(n,t,e,r,o){var u=o.getCellDelta(t),i=ee.fromTable(n),c=o.getWidths(i,r,o),a=jo(c,e,u,o),l=A(a,function(n,t){return n+c[t]}),f=Fo(i,l);B(f,function(n){o.setElementWidth(n.element,n.width)}),e===i.grid.columns()-1&&o.adjustTableWidth(u)}(r,o,n.column(),t,i),u.trigger.afterResize(r)}),{on:o.on,off:o.off,hideBars:o.hideBars,showBars:o.showBars,destroy:o.destroy,events:u.registry}},Eu=function(n,t){return n.fire("newrow",{node:t})},Mu=function(n,t){return n.fire("newcell",{node:t})},Nu=function(n,t,e,r,o){n.fire("TableSelectionChange",{cells:t,start:e,finish:r,otherCells:o})},_u=function(n){n.fire("TableSelectionClear")},Wu={"border-collapse":"collapse",width:"100%"},ju={border:"1"},zu=function(n){return n.getParam("table_sizing_mode","auto")},Fu=function(n){return n.getParam("table_responsive_width")},Lu=function(n){return n.getParam("table_default_attributes",ju,"object")},Hu=function(n){return n.getParam("table_default_styles",function(n){if(Gu(n)){var t=n.getBody().offsetWidth;return wn(wn({},Wu),{width:t+"px"})}return Yu(n)?U(Wu,function(n,t){return"width"!==t}):Wu}(n),"object")},qu=function(n){return n.getParam("table_tab_navigation",!0,"boolean")},Vu=function(n){return n.getParam("table_cell_advtab",!0,"boolean")},Uu=function(n){return n.getParam("table_row_advtab",!0,"boolean")},Ku=function(n){return n.getParam("table_advtab",!0,"boolean")},$u=function(n){return n.getParam("table_style_by_css",!1,"boolean")},Xu=function(n){return"relative"===zu(n)||!0===Fu(n)},Gu=function(n){return"fixed"===zu(n)||!1===Fu(n)},Yu=function(n){return"responsive"===zu(n)},Ju=function(n){var t=n.getParam("table_header_type","section","string");return R(["section","cells","sectionCells","auto"],t)?t:"section"},Qu=function(n){var t=n.getParam("table_clone_elements");return p(t)?d.some(t.split(/[ ,]/)):Array.isArray(t)?d.some(t):d.none()},Zu=function(n){return n.nodeName.toLowerCase()},ni=function(n){return bn.fromDom(n.getBody())},ti=function(n){return n.getBoundingClientRect().width},ei=function(n){return n.getBoundingClientRect().height},ri=function(n){return function(t){return Hn(t,ni(n))}},oi=function(n){return/^\d+(\.\d+)?$/.test(n)?n+"px":n},ui=function(n){ln(n,"data-mce-style"),B(Gt(n),function(n){return ln(n,"data-mce-style")})},ii=function(n,t){var e=n.dom.getStyle(t,"width")||n.dom.getAttrib(t,"width");return d.from(e).filter(pn)},ci=function(n){return/^(\d+(\.\d+)?)%$/.test(n)},ai={isRtl:r(!1)},li={isRtl:r(!0)},fi=function(n){return"rtl"===function(n){return"rtl"===st(n,"direction")?"rtl":"ltr"}(n)?li:ai},si=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}},di=function(n){var t=function(){return Sr(n)},o=r(0);return{width:t,pixelWidth:t,getWidths:ho,getCellDelta:o,singleColumnWidth:r([0]),minCellWidth:o,setElementWidth:e,adjustTableWidth:e,label:"none"}},mi=function(n,t){var e=si(parseFloat(n)),r=si(Sr(t));return{width:e.get,pixelWidth:r.get,getWidths:po,getCellDelta:function(n){return n/r.get()*100},singleColumnWidth:function(n,t){return[100-n]},minCellWidth:function(){return Vt()/r.get()*100},setElementWidth:Yr,adjustTableWidth:function(n){var o=e.get(),u=o+n/100*o;Yr(t,u),e.set(u),r.set(Sr(t))},label:"percent"}},gi=function(n,t){var e=si(n),r=e.get;return{width:r,pixelWidth:r,getWidths:ho,getCellDelta:o,singleColumnWidth:function(n,t){return[Math.max(Vt(),n+t)-n]},minCellWidth:Vt,setElementWidth:Gr,adjustTableWidth:function(n){var o=r()+n;Gr(t,o),e.set(o)},label:"pixel"}},pi=function(n){return no(n).fold(function(){return di(n)},function(t){return function(n,t){var e=co().exec(t);if(null!==e)return mi(e[1],n);var r=ao().exec(t);if(null!==r){var o=parseInt(r[1],10);return gi(o,n)}var u=Sr(n);return gi(u,n)}(n,t)})},hi=gi,vi=mi,bi=function(n,t){if(Xu(n)){var e=ii(n,t.dom()).filter(ci).getOrThunk(function(){return Po(t)});return vi(e,t)}return Gu(n)?hi(Sr(t),t):pi(t)},wi=function(n){ln(n,"width")},yi=function(n,t,e){var r=function(n){return Sr(n)+"px"}(n);Do(n,d.some(r),d.none(),t,e),wi(n)},Ci=function(n,t){!function(n,t,e){var r=io(n);Do(n,d.some(r),d.none(),t,e),wi(n)}(t,Eo(fi),bi(n,t))},Si=function(n,t){var e=Eo(fi),r=bi(n,t);yi(t,e,r)},xi=function(n){gt(n,"width"),B(Gt(n),function(n){gt(n,"width"),wi(n)}),wi(n)},Ti=function(){var t=bn.fromTag("div");return ft(t,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),bt(ct(bn.fromDom(n.document)),t),t},Ri=function(n){var t,e,r=d.none(),o=d.none(),u=d.none(),i=function(n){return"TABLE"===n.nodeName},c=function(){return o};return n.on("init",function(){var t=Eo(fi),e=function(n,t){return n.inline?hr(ni(n),Ti()):pr(bn.fromDom(n.getDoc()))}(n);if(u=d.some(e),function(n){var t=n.getParam("object_resizing",!0);return p(t)?"table"===t:t}(n)&&function(n){return n.getParam("table_resize_bars",!0,"boolean")}(n)){var i=ku(e,t,function(t){return bi(n,t)});i.on(),i.events.startDrag.bind(function(t){r=d.some(n.selection.getRng())}),i.events.beforeResize.bind(function(t){var e=t.table().dom();!function(n,t,e,r){n.fire("ObjectResizeStart",{target:t,width:e,height:r})}(n,e,ti(e),ei(e))}),i.events.afterResize.bind(function(t){var e=t.table(),o=e.dom();ui(e),r.each(function(t){n.selection.setRng(t),n.focus()}),function(n,t,e,r){n.fire("ObjectResized",{target:t,width:e,height:r})}(n,o,ti(o),ei(o)),n.undoManager.add()}),o=d.some(i)}}),n.on("ObjectResizeStart",function(r){var o=r.target;if(i(o)){var u=bn.fromDom(o);!Bo(u)&&Gu(n)?Si(n,u):!Ao(u)&&Xu(n)&&Ci(n,u),t=r.width,e=ii(n,o).getOr("")}}),n.on("ObjectResized",function(r){var o=r.target;if(i(o)){var u=bn.fromDom(o);if(""===e||!ci(e)&&Yu(n))Ci(n,u);else if(ci(e)){var c=parseFloat(e.replace("%","")),a=r.width*c/t;lt(u,"width",a+"%")}else!function(n){B(Gt(n),function(n){var t=st(n,"width");lt(n,"width",t),ln(n,"width")})}(u);ui(u)}}),n.on("SwitchMode",function(){c().each(function(t){n.mode.isReadOnly()?t.hideBars():t.showBars()})}),{lazyResize:c,lazyWire:function(){return u.getOr(pr(bn.fromDom(n.getBody())))},destroy:function(){o.each(function(n){n.destroy()}),u.each(function(t){!function(n,t){n.inline&&xt(t.parent())}(n,t)})}}},Oi=function(n,t){return{element:r(n),offset:r(t)}},Di=function(n,t,e){return n.property().isText(t)&&0===n.property().getText(t).trim().length||n.property().isComment(t)?e(t).bind(function(t){return Di(n,t,e).orThunk(function(){return d.some(t)})}):d.none()},Ai=function(n,t){return n.property().isText(t)?n.property().getText(t).length:n.property().children(t).length},Bi=function(n,t){var e=Di(n,t,n.query().prevSibling).getOr(t);if(n.property().isText(e))return Oi(e,Ai(n,e));var r=n.property().children(e);return r.length>0?Bi(n,r[r.length-1]):Oi(e,Ai(n,e))},Ii=Bi,Pi=_e(),ki=function(n,t){no(n).bind(function(n){var t=Ur.exec(n);return null!==t?d.some({width:r(parseFloat(t[1])),unit:r(t[3])}):d.none()}).each(function(e){var r=e.width()/2;uo(n,r,e.unit()),uo(t,r,e.unit())})},Ei=function(n){return ee.fromTable(n).grid},Mi=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},Ni=function(n,t,e,r){e===r?ln(n,t):rn(n,t,e)},_i=function(n,t){var e=[],r=[],o=j(Pt(n,"caption,colgroup")).fold(function(){return u(vt,n)},function(n){return u(ht,n)}),i=function(t,u){t.length>0?function(t,u){var i=_t(n,u).getOrThunk(function(){var t=bn.fromTag(u,Kn(n).dom());return"thead"===u?o(t):bt(n,t),t});St(i);var c=A(t,function(n){n.isNew()&&e.push(n.element());var t=n.element();return St(t),B(n.cells(),function(n){n.isNew()&&r.push(n.element()),Ni(n.element(),"colspan",n.colspan(),1),Ni(n.element(),"rowspan",n.rowspan(),1),bt(t,n.element())}),t});Ct(i,c)}(t,u):function(t){_t(n,t).each(xt)}(u)},c=[],a=[],l=[];return B(t,function(n){switch(n.section()){case"thead":c.push(n);break;case"tbody":a.push(n);break;case"tfoot":l.push(n)}}),i(c,"thead"),i(a,"tbody"),i(l,"tfoot"),{newRows:e,newCells:r}},Wi=function(n,t,e){n.cells()[t]=e},ji=function(n,t){return At(t,n.section())},zi=function(n,t){var e=n.cells(),r=A(e,t);return At(r,n.section())},Fi=function(n,t){return n.cells()[t]},Li=function(n,t){return Fi(n,t).element()},Hi=function(n){return n.cells().length},qi=function(n,t){if(0===n.length)return 0;var e=n[0];return M(n,function(n){return!t(e.element(),n.element())}).fold(function(){return n.length},function(n){return n})},Vi=function(n,t,e,r){var o=function(n,t){return n[t]}(n,t).cells().slice(e),u=qi(o,r),i=function(n,t){return A(n,function(n){return Fi(n,t)})}(n,e).slice(t);return{colspan:u,rowspan:qi(i,r)}},Ui=function(n,t){var e=A(n,function(n){return A(n.cells(),function(){return!1})});return A(n,function(o,u){return function(n,t){return{details:r(n),section:r(t)}}(_(o.cells(),function(o,i){if(!1===e[u][i]){var c=Vi(n,u,i,t);return function(n,t,r,o){for(var u=n;u<n+r;u++)for(var i=t;i<t+o;i++)e[u][i]=!0}(u,i,c.rowspan,c.colspan),[(a=o.element(),l=c.rowspan,f=c.colspan,s=o.isNew(),{element:r(a),rowspan:r(l),colspan:r(f),isNew:r(s)})]}return[];var a,l,f,s}),o.section())})},Ki=function(n,t,e){for(var r=[],o=0;o<n.grid.rows();o++){for(var u=[],i=0;i<n.grid.columns();i++){var c=ee.getAt(n,o,i).map(function(n){return Dt(n.element(),e)}).getOrThunk(function(){return Dt(t.gap(),!0)});u.push(c)}var a=At(u,n.all[o].section());r.push(a)}return r},$i=function(n,t){return A(n,function(n){var e,o,u,i,c=function(n){return z(n,function(n){return $n(n.element()).map(function(n){var t=$n(n).isNone();return Dt(n,t)})}).getOrThunk(function(){return Dt(t.row(),!0)})}(n.details());return e=c.element(),o=n.details(),u=n.section(),i=c.isNew(),{element:r(e),cells:r(o),section:r(u),isNew:r(i)}})},Xi=function(n,t){var e=Ui(n,Hn);return $i(e,t)},Gi=function(n,t){return z(n.all,function(n){return E(n.cells(),function(n){return Hn(t,n.element())})})},Yi=function(n,t,e,o,u){return function(i,c,a,l,f,s){var m=ee.fromTable(c);return t(m,a).map(function(t){var e=function(n,t){return Ki(n,t,!1)}(m,l),o=n(e,t,Hn,u(l)),i=Xi(o.grid(),l);return{grid:r(i),cursor:o.cursor}}).fold(function(){return d.none()},function(n){var t=_i(c,n.grid()),u=d.from(s).getOrThunk(function(){return pi(c)});return e(c,n.grid(),f,u),o(c),Ou(i,c,Mr,f),d.some({cursor:n.cursor,newRows:r(t.newRows),newCells:r(t.newCells)})})}},Ji=function(n,t){return Xt(t.element()).bind(function(t){return Gi(n,t)})},Qi=function(n,t){var e=A(t.selection(),function(t){return Xt(t).bind(function(t){return Gi(n,t)})}),r=Mi(e);return r.length>0?d.some({cells:r,generators:t.generators,clipboard:t.clipboard}):d.none()},Zi=function(n,t){var e=A(t.selection(),function(t){return Xt(t).bind(function(t){return Gi(n,t)})}),r=Mi(e);return r.length>0?d.some(r):d.none()},nc=function(n,t,e,r){for(var o=!0,u=0;u<n.length;u++)for(var i=0;i<Hi(n[0]);i++){var c=e(Li(n[u],i),t);!0===c&&!1===o?Wi(n[u],i,Dt(r(),!0)):!0===c&&(o=!1)}return n},tc=function(n,t,e,r){if(t>0&&t<n.length){var o=function(n,t){return k(n,function(n,e){return O(n,function(n){return t(n.element(),e.element())})?n:n.concat([e])},[])}(n[t-1].cells(),e);B(o,function(o){for(var u=d.none(),i=function(t){for(var i=function(i){var c=n[t].cells()[i];e(c.element(),o.element())&&(u.isNone()&&(u=d.some(r())),u.each(function(e){Wi(n[t],i,Dt(e,!0))}))},c=0;c<Hi(n[0]);c++)i(c)},c=t;c<n.length;c++)i(c)})}return n},ec=function(n){return{is:function(t){return n===t},isValue:a,isError:c,getOr:r(n),getOrThunk:r(n),getOrDie:r(n),or:function(t){return ec(n)},orThunk:function(t){return ec(n)},fold:function(t,e){return e(n)},map:function(t){return ec(t(n))},mapError:function(t){return ec(n)},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return d.some(n)}}},rc=function(n){return{is:c,isValue:c,isError:a,getOr:o,getOrThunk:function(n){return n()},getOrDie:function(){return(t=String(n),function(){throw new Error(t)})();var t},or:function(n){return n},orThunk:function(n){return n()},fold:function(t,e){return t(n)},map:function(t){return rc(n)},mapError:function(t){return rc(t(n))},each:e,bind:function(t){return rc(n)},exists:c,forall:a,toOption:d.none}},oc={value:ec,error:rc,fromOption:function(n,t){return n.fold(function(){return rc(t)},ec)}},uc=function(n,t){return{rowDelta:0,colDelta:Hi(n[0])-Hi(t[0])}},ic=function(n,t){return{rowDelta:n.length-t.length,colDelta:0}},cc=function(n,t){return A(n,function(){return Dt(t.cell(),!0)})},ac=function(n,t,e){return n.concat(D(t,function(){return ji(n[n.length-1],cc(n[n.length-1].cells(),e))}))},lc=function(n,t,e){return A(n,function(n){return ji(n,n.cells().concat(cc(D(t,o),e)))})},fc=function(n,t,e){var r=t.colDelta<0?lc:o;return(t.rowDelta<0?ac:o)(r(n,Math.abs(t.colDelta),e),Math.abs(t.rowDelta),e)},sc=function(n,t,e,r){var o=u(r,Fi(n[t],e).element()),i=n[t];return n.length>1&&Hi(i)>1&&(e>0&&o(Li(i,e-1))||e<i.cells().length-1&&o(Li(i,e+1))||t>0&&o(Li(n[t-1],e))||t<n.length-1&&o(Li(n[t+1],e)))},dc=function(n,t,e,r,o){return function(n,t,e){if(n.row()>=t.length||n.column()>Hi(t[0]))return oc.error("invalid start address out of table bounds, row: "+n.row()+", column: "+n.column());var r=t.slice(n.row()),o=r[0].cells().slice(n.column()),u=Hi(e[0]),i=e.length;return oc.value({rowDelta:r.length-i,colDelta:o.length-u})}(n,t,e).map(function(u){var i=fc(t,u,r);return function(n,t,e,r,o){for(var u=n.row(),i=n.column(),c=u+e.length,a=i+Hi(e[0]),l=u;l<c;l++)for(var f=i;f<a;f++){sc(t,l,f,o)&&nc(t,Li(t[l],f),o,r.cell);var s=Li(e[l-u],f-i),d=r.replace(s);Wi(t[l],f,Dt(d,!0))}return t}(n,i,e,r,o)})},mc=function(n,t,e,r,o){!function(n,t,e,r){t>0&&t<n[0].cells().length&&B(n,function(n){var o=n.cells()[t-1],u=n.cells()[t];e(u.element(),o.element())&&Wi(n,t,Dt(r(),!0))})}(t,n,o,r.cell);var u=ic(e,t),i=fc(e,u,r),c=ic(t,i),a=fc(t,c,r);return A(a,function(t,e){var r=t.cells().slice(0,n).concat(i[e].cells()).concat(t.cells().slice(n,t.cells().length));return ji(t,r)})},gc=function(n,t,e,r,o){tc(t,n,o,r.cell);var u=uc(e,t),i=fc(e,u,r),c=uc(t,i),a=fc(t,c,r);return a.slice(0,n).concat(i).concat(a.slice(n,a.length))},pc=function(n,t,e,r,o){var u=n.slice(0,t),i=n.slice(t),c=zi(n[e],function(e,u){return t>0&&t<n.length&&r(Li(n[t-1],u),Li(n[t],u))?Fi(n[t],u):Dt(o(e.element(),r),!0)});return u.concat([c]).concat(i)},hc=function(n,t,e,r,o){return A(n,function(n){var u=t>0&&t<Hi(n)&&r(Li(n,t-1),Li(n,t))?Fi(n,t):Dt(o(Li(n,e),r),!0);return function(n,t,e){var r=n.cells(),o=r.slice(0,t),u=r.slice(t),i=o.concat([e]).concat(u);return ji(n,i)}(n,t,u)})},vc=function(n,t,e,r){return A(n,function(n){return zi(n,function(n){return function(n){return O(t,function(t){return e(n.element(),t.element())})}(n)?Dt(r(n.element(),e),!0):n})})},bc=function(n,t,e,r){return void 0!==Li(n[t],e)&&t>0&&r(Li(n[t-1],e),Li(n[t],e))},wc=function(n,t,e){return t>0&&e(Li(n,t-1),Li(n,t))},yc=function(n,t,e,r){var o=_(n,function(r,o){return bc(n,o,t,e)||wc(r,t,e)?[]:[Fi(r,t)]});return vc(n,o,e,r)},Cc=function(n,t,e,r){var o=n[t],u=_(o.cells(),function(r,u){return bc(n,t,u,e)||wc(o,u,e)?[]:[r]});return vc(n,u,e,r)},Sc=cu(["cell","row","replace","gap"]),xc=function(n){var t=zt(n,"colspan",1),e=zt(n,"rowspan",1);return{element:r(n),colspan:r(t),rowspan:r(e)}},Tc=function(n,t){void 0===t&&(t=xc),Sc(n);var e=si(d.none()),r=function(e){return function(t){return n.cell(t)}(t(e))},o=function(n){var t=r(n);return e.get().isNone()&&e.set(d.some(t)),u=d.some({item:n,replacement:t}),t},u=d.none();return{getOrInit:function(n,t){return u.fold(function(){return o(n)},function(e){return t(n,e.item)?e.replacement:o(n)})},cursor:e.get}},Rc=function(n,t){return function(e){var r=si(d.none());Sc(e);var o=[],u=function(u){var i={scope:n},c=e.replace(u,t,i);return o.push({item:u,sub:c}),r.get().isNone()&&r.set(d.some(c)),c};return{replaceOrInit:function(n,t){return function(n,t){return E(o,function(e){return t(e.item,n)})}(n,t).fold(function(){return u(n)},function(e){return t(n,e.item)?e.sub:u(n)})},cursor:r.get}}},Oc=function(n){Sc(n);var t=si(d.none());return{combine:function(e){return t.get().isNone()&&t.set(d.some(e)),function(){var t=n.cell({element:r(e),colspan:r(1),rowspan:r(1)});return gt(t,"width"),gt(e,"width"),t}},cursor:t.get}},Dc=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],Ac=_e(),Bc=function(n){return t=n,e=Ac.property().name(t),R(Dc,e);var t,e},Ic=function(n){return t=n,e=Ac.property().name(t),R(["ol","ul"],e);var t,e},Pc=function(n){return t=n,R(["br","img","hr","input"],Ac.property().name(t));var t},kc=function(n){var t,e=function(n){return"br"===X(n)},r=function(n){return me(n).bind(function(t){var r=Yn(t).map(function(n){return!!Bc(n)||!!Pc(n)&&"img"!==X(n)}).getOr(!1);return $n(t).map(function(o){return!0===r||("li"===X(u=o)||Mt(u,Ic).isSome())||e(t)||Bc(o)&&!Hn(n,o)?[]:[bn.fromTag("br")];var u})}).getOr([])},o=0===(t=_(n,function(n){var t=Jn(n);return function(n){return W(n,function(n){return e(n)||Z(n)&&0===ie(n).trim().length})}(t)?[]:t.concat(r(n))})).length?[bn.fromTag("br")]:t;St(n[0]),Ct(n[0],o)},Ec=function(n){0===Gt(n).length&&xt(n)},Mc=function(n,t){return{grid:r(n),cursor:r(t)}},Nc=function(n,t,e){return _c(n,t,e).orThunk(function(){return _c(n,0,0)})},_c=function(n,t,e){return d.from(n[t]).bind(function(n){return d.from(n.cells()[e]).bind(function(n){return d.from(n.element())})})},Wc=function(n,t,e){return Mc(n,_c(n,t,e))},jc=function(n){return k(n,function(n,t){return O(n,function(n){return n.row()===t.row()})?n:n.concat([t])},[]).sort(function(n,t){return n.row()-t.row()})},zc=function(n){return k(n,function(n,t){return O(n,function(n){return n.column()===t.column()})?n:n.concat([t])},[]).sort(function(n,t){return n.column()-t.column()})},Fc=function(n,t,e){var r=function(n,t){return A(n,function(n){var e=A(Gt(n),function(n){var t=zt(n,"rowspan",1),e=zt(n,"colspan",1);return Rt(n,t,e)});return Ot(n,e,t.section())})}(n,e),o=ee.generate(r);return Ki(o,t,!0)},Lc=function(n,t){var e=I(n,t);return 0===e.length?d.some("td"):e.length===n.length?d.some("th"):d.none()},Hc=function(n,t,e,r){var o=ee.generate(t),u=r.getWidths(o,e,r),i=Fo(o,u);B(i,function(n){r.setElementWidth(n.element,n.width)})},qc=Yi(function(n,t,e,r){var o=t[0].row(),u=t[0].row(),i=jc(t),c=k(i,function(n,t){return pc(n,u,o,e,r.getOrInit)},n);return Wc(c,u,t[0].column())},Zi,e,e,Tc),Vc=Yi(function(n,t,e,r){var o=jc(t),u=o[o.length-1].row(),i=o[o.length-1].row()+o[o.length-1].rowspan(),c=k(o,function(n,t){return pc(n,i,u,e,r.getOrInit)},n);return Wc(c,i,t[0].column())},Zi,e,e,Tc),Uc=Yi(function(n,t,e,r){var o=zc(t),u=o[0].column(),i=o[0].column(),c=k(o,function(n,t){return hc(n,i,u,e,r.getOrInit)},n);return Wc(c,t[0].row(),i)},Zi,Hc,e,Tc),Kc=Yi(function(n,t,e,r){var o=t[t.length-1].column(),u=t[t.length-1].column()+t[t.length-1].colspan(),i=zc(t),c=k(i,function(n,t){return hc(n,u,o,e,r.getOrInit)},n);return Wc(c,t[0].row(),u)},Zi,Hc,e,Tc),$c=Yi(function(n,t,e,r){var o=zc(t),u=function(n,t,e){var r=A(n,function(n){var r=n.cells().slice(0,t).concat(n.cells().slice(e+1));return At(r,n.section())});return I(r,function(n){return n.cells().length>0})}(n,o[0].column(),o[o.length-1].column()),i=Nc(u,t[0].row(),t[0].column());return Mc(u,i)},Zi,Hc,Ec,Tc),Xc=Yi(function(n,t,e,r){var o=jc(t),u=function(n,t,e){return n.slice(0,t).concat(n.slice(e+1))}(n,o[0].row(),o[o.length-1].row()),i=Nc(u,t[0].row(),t[0].column());return Mc(u,i)},Zi,e,Ec,Tc),Gc=Yi(function(n,t,e,r){var o=yc(n,t.column(),e,r.replaceOrInit);return Wc(o,t.row(),t.column())},Ji,e,e,Rc("row","th")),Yc=Yi(function(n,t,e,r){var o=yc(n,t.column(),e,r.replaceOrInit);return Wc(o,t.row(),t.column())},Ji,e,e,Rc(null,"td")),Jc=(Yi(function(n,t,e,r){var o=Cc(n,t.row(),e,r.replaceOrInit);return Wc(o,t.row(),t.column())},Ji,e,e,Rc("col","th")),Yi(function(n,t,e,r){var o=Cc(n,t.row(),e,r.replaceOrInit);return Wc(o,t.row(),t.column())},Ji,e,e,Rc(null,"td")),Yi(function(n,t,e,o){var u=t.cells();kc(u);var i=function(n,t,e,r){if(0===n.length)return n;for(var o=t.startRow();o<=t.finishRow();o++)for(var u=t.startCol();u<=t.finishCol();u++)Wi(n[o],u,Dt(r(),!1));return n}(n,t.bounds(),0,r(u[0]));return Mc(i,d.from(u[0]))},function(n,t){return t.mergable()},e,e,Oc)),Qc=Yi(function(n,t,e,r){var o=P(t,function(n,t){return nc(n,t,e,r.combine(t))},n);return Mc(o,d.from(t[0]))},function(n,t){return t.unmergable()},Hc,e,Oc),Zc=Yi(function(n,t,e,o){var u,i,c,a,l,f=(u=t.clipboard(),i=t.generators(),c=ee.fromTable(u),Ki(c,i,!0)),s=(a=t.row(),l=t.column(),{row:r(a),column:r(l)});return dc(s,n,f,t.generators(),e).fold(function(){return Mc(n,d.some(t.element()))},function(n){var e=Nc(n,t.row(),t.column());return Mc(n,e)})},function(n,t){return Xt(t.element()).bind(function(e){return Gi(n,e).map(function(n){return wn(wn({},n),{generators:t.generators,clipboard:t.clipboard})})})},Hc,e,Tc),na=Yi(function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[0].column(),i=Fc(t.clipboard(),t.generators(),o),c=mc(u,n,i,t.generators(),e),a=Nc(c,t.cells[0].row(),t.cells[0].column());return Mc(c,a)},Qi,e,e,Tc),ta=Yi(function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[t.cells.length-1].column()+t.cells[t.cells.length-1].colspan(),i=Fc(t.clipboard(),t.generators(),o),c=mc(u,n,i,t.generators(),e),a=Nc(c,t.cells[0].row(),t.cells[0].column());return Mc(c,a)},Qi,e,e,Tc),ea=Yi(function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[0].row(),i=Fc(t.clipboard(),t.generators(),o),c=gc(u,n,i,t.generators(),e),a=Nc(c,t.cells[0].row(),t.cells[0].column());return Mc(c,a)},Qi,e,e,Tc),ra=Yi(function(n,t,e,r){var o=n[t.cells[0].row()],u=t.cells[t.cells.length-1].row()+t.cells[t.cells.length-1].rowspan(),i=Fc(t.clipboard(),t.generators(),o),c=gc(u,n,i,t.generators(),e),a=Nc(c,t.cells[0].row(),t.cells[0].column());return Mc(c,a)},Qi,e,e,Tc),oa=function(n,t){var e=ee.fromTable(n);return Zi(e,t).bind(function(n){var t=n[n.length-1],r=n[0].column(),o=t.column()+t.colspan(),u=N(A(e.all,function(n){return I(n.cells(),function(n){return n.column()>=r&&n.column()<o})}));return Lc(u,function(n){return"th"===X(n.element())})}).getOr("")},ua=function(n){return Zu(n.parentNode)},ia=function(n,t){var e="thead"===ua(t),r=!O(t.cells,function(n){return"th"!==Zu(n)});return e||r?d.some({thead:e,ths:r}):d.none()},ca=function(n,t){return"thead"===(e=ia(0,t).fold(function(){return ua(t)},function(n){return"thead"}))?"header":"tfoot"===e?"footer":"body";var e},aa=function(n,t,e){var r=n.getParent(t,"table"),o=t.parentNode,u=Zu(o);if(e!==u){var i=n.select(e,r)[0];if(!i){i=n.create(e);var c=r.firstChild;"thead"===e?j(Pt(bn.fromDom(r),"caption,colgroup")).fold(function(){return r.insertBefore(i,c)},function(t){return n.insertAfter(i,t.dom())}):r.appendChild(i)}"tbody"===e&&"thead"===u&&i.firstChild?i.insertBefore(t,i.firstChild):i.appendChild(t),o.hasChildNodes()||n.remove(o)}},la=function(n,t,e,r){return B(t,function(t){var o=Zu(t)!==e?n.rename(t,e):t;n.setAttrib(o,"scope",r)})},fa=function(n,t,e){var r,o=n.dom;if("header"===e){var u=Ju(n),i="auto"===u?(r=Yt(bn.fromDom(t.cells[0])).map(function(n){return Jt(n)}).getOr([]),z(r,function(n){return ia(0,n.dom())}).map(function(n){return n.thead&&n.ths?"sectionCells":n.thead?"section":"cells"}).getOr("section")):u;la(o,t.cells,"section"===i?"td":"th","col"),aa(o,t,"cells"===i?"tbody":"thead")}else la(o,t.cells,"td",null),aa(o,t,"footer"===e?"tfoot":"tbody")},sa=function(n){return{get:function(){var t,e,r=ni(n);return(t=r,e="td[data-mce-selected],th[data-mce-selected]",Ue(t,e)).fold(function(){return void 0===n.selection.getStart()?tr():rr(n.selection)},function(n){return er(n)})}}},da=function(n){return function(t){return d.from(t.dom.getParent(t.selection.getStart(),n)).map(function(n){return bn.fromDom(n)})}},ma=da("th,td"),ga=da("th,td,caption"),pa=function(n){return ma(n).map(function(t){return or(t,sa(n))}).map(function(n){return A(n,function(n){return n.dom()})}).getOr([])},ha=function(n){var t,e,r,o=ma(n),u=o.bind(function(n){return Yt(n)}).map(function(n){return Jt(n)}).map(function(n){return A(n,function(n){return n.dom()})});return(t=o,e=u,r=function(t,e){return I(e,function(e){return O(e.cells,function(e){return"1"===n.dom.getAttrib(e,"data-mce-selected")||e===t.dom()})})},t.isSome()&&e.isSome()?d.some(r(t.getOrDie(),e.getOrDie())):d.none()).getOr([])},va=function(n,t){var r=function(n){return"table"===X(ni(n))},o=Qu(n),u=function(t,e,r,u){return function(i,c){ui(i);var a=u(),l=bn.fromDom(n.getDoc()),f=Eo(fi),s=xe(r,l,o),m=bi(n,i);return e(i)?t(a,i,c,s,f,m).bind(function(t){return B(t.newRows(),function(t){Eu(n,t.dom())}),B(t.newCells(),function(t){Mu(n,t.dom())}),t.cursor().map(function(t){var e=Ii(Pi,t),r=n.dom.createRng();return r.setStart(e.element().dom(),e.offset()),r.setEnd(e.element().dom(),e.offset()),r})}):d.none()}},i=u(Xc,function(t){return!1===r(n)||Ei(t).rows()>1},e,t),c=u($c,function(t){return!1===r(n)||Ei(t).columns()>1},e,t),l=u(qc,a,e,t),f=u(Vc,a,e,t),s=u(Uc,a,ki,t),m=u(Kc,a,ki,t),g=u(Jc,a,e,t),p=u(Qc,a,e,t),h=u(na,a,e,t),v=u(ta,a,e,t),b=u(ea,a,e,t),w=u(ra,a,e,t),y=u(Zc,a,e,t),C=function(n,t){return K(n,"type").filter(function(n){return R(t,n)})};return{deleteRow:i,deleteColumn:c,insertRowsBefore:l,insertRowsAfter:f,insertColumnsBefore:s,insertColumnsAfter:m,mergeCells:g,unmergeCells:p,pasteColsBefore:h,pasteColsAfter:v,pasteRowsBefore:b,pasteRowsAfter:w,pasteCells:y,setTableCellType:function(n,t){return C(t,["td","th"]).each(function(t){la(n.dom,pa(n),t,null)})},setTableRowType:function(n,t){return C(t,["header","body","footer"]).each(function(t){A(ha(n),function(e){return fa(n,e,t)})})},makeColumnHeader:u(Gc,a,e,t),unmakeColumnHeader:u(Yc,a,e,t),getTableRowType:function(n){var t=ha(n);if(t.length>0){var e=A(t,function(n){return ca(0,n)}),r=R(e,"header"),o=R(e,"footer");if(r||o){var u=R(e,"body");return!r||u||o?r||u||!o?"":"footer":"header"}return"body"}},getTableCellType:function(n){return Lc(pa(n),function(n){return"th"===Zu(n)}).getOr("")},getTableColType:oa}},ba={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"}},wa=function(n,t,e,r){return D(n,function(n){return function(n,t,e,r){for(var o=bn.fromTag("tr"),u=0;u<n;u++){var i=r<t||u<e?bn.fromTag("th"):bn.fromTag("td");u<e&&rn(i,"scope","row"),r<t&&rn(i,"scope","col"),bt(i,bn.fromTag("br")),bt(o,i)}return o}(t,e,r,n)})},ya=function(n,t){n.selection.select(t.dom(),!0),n.selection.collapse(!0)},Ca=function(n,t,e,r,o){var i=Hu(n),c={styles:i,attributes:Lu(n)},a=function(n,t,e,r,o,u){void 0===u&&(u=ba);var i=bn.fromTag("table"),c="cells"!==o;ft(i,u.styles),on(i,u.attributes);var a=Math.min(n,e);if(c&&e>0){var l=bn.fromTag("thead");bt(i,l);var f=wa(e,t,"sectionCells"===o?a:0,r);Ct(l,f)}var s=bn.fromTag("tbody");bt(i,s);var d=wa(c?n-a:n,t,c?0:e,r);return Ct(s,d),i}(e,t,o,r,Ju(n),c);rn(a,"data-mce-id","__mce");var l,f,s,d=(l=a,f=bn.fromTag("div"),s=bn.fromDom(l.dom().cloneNode(!0)),bt(f,s),function(n){return n.dom().innerHTML}(f));return n.insertContent(d),Wt(ni(n),'table[data-mce-id="__mce"]').map(function(t){var e;return Gu(n)?Si(n,t):Yu(n)?xi(t):(Xu(n)||(e=i.width,p(e)&&-1!==e.indexOf("%")))&&Ci(n,t),ui(t),ln(t,"data-mce-id"),function(n,t){B(kt(t,"tr"),function(t){Eu(n,t.dom()),B(kt(t,"th,td"),function(t){Mu(n,t.dom())})})}(n,t),function(n,t){Wt(t,"td,th").each(u(ya,n))}(n,t),t.dom()}).getOr(null)},Sa=function(n,t,e,r,o){void 0===r&&(r={});var u=function(n){return C(n)&&n>0};if(u(t)&&u(e)){var i=r.headerRows||0,c=r.headerColumns||0;return Ca(n,e,t,c,i)}return console.error(o),null},xa=function(n){return function(){return n().fold(function(){return[]},function(n){return A(n,function(n){return n.dom()})})}},Ta=function(n){return function(t){var e=t.length>0?d.some(A(t,bn.fromDom)):d.none();n(e)}},Ra=function(n,t,e,r){return{insertTable:function(t,e,r){return void 0===r&&(r={}),Sa(n,e,t,r,"Invalid values for insertTable - rows and columns values are required to insert a table.")},setClipboardRows:Ta(t.setRows),getClipboardRows:xa(t.getRows),setClipboardCols:Ta(t.setColumns),getClipboardCols:xa(t.getColumns),resizeHandler:e,selectionTargets:r}},Oa=function(n,t){var e=ee.fromTable(n);return Zi(e,t).map(function(n){var t=n[n.length-1],r=n[0].column(),o=t.column()+t.colspan();return A(e.all,function(n){var t=I(n.cells(),function(n){return n.column()>=r&&n.column()<o}),e=A(t,function(n){var t,e,u,i,c=ve(n.element());return u=o-r,i=Ft(t=c,e="colspan"),1===u||i<=1?ln(t,e):rn(t,e,Math.min(u,i)),c}),u=bn.fromTag("tr");return Ct(u,e),u})})},Da=function(n,t,e){var r=ee.fromTable(n);return Zi(r,t).map(function(n){var t=Ki(r,e,!1).slice(n[0].row(),n[n.length-1].row()+n[n.length-1].rowspan());return function(n){return A(n,function(n){var t=he(n.element());return B(n.cells(),function(n){var e=ve(n.element());Ni(e,"colspan",n.colspan(),1),Ni(e,"rowspan",n.rowspan(),1),bt(t,e)}),t})}(Xi(t,e))})},Aa=tinymce.util.Tools.resolve("tinymce.util.Tools"),Ba=function(n,t,e){return function(t,r){for(var o=0;o<r.length;o++){var u=n.getStyle(r[o],e);if(void 0===t&&(t=u),t!==u)return""}return t}(void 0,n.select("td,th",t))},Ia=function(n,t,e){e&&n.formatter.apply("align"+e,{},t)},Pa=function(n,t){Aa.each("left center right".split(" "),function(e){n.formatter.remove("align"+e,{},t)})},ka=function(n,t){var e;return e=n,(t||[]).concat(A(e,function(n){return{text:n.text||n.title,value:n.value}}))},Ea=function(n){return function(t){return sn(t,"rgb",0)?n.toHex(t):t}},Ma=function(n,t){var e=bn.fromDom(t);return{borderwidth:mt(e,"border-width").getOr(""),borderstyle:mt(e,"border-style").getOr(""),bordercolor:mt(e,"border-color").map(Ea(n)).getOr(""),backgroundcolor:mt(e,"background-color").map(Ea(n)).getOr("")}},Na=function(n){var t=n[0],e=n.slice(1);return B(e,function(n){B(F(t),function(e){H(n,function(n,r){var o=t[e];""!==o&&e===r&&o!==n&&(t[e]="")})})}),t},_a=function(n){var t=[{name:"borderstyle",type:"selectbox",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]},{name:"bordercolor",type:"colorinput",label:"Border color"},{name:"backgroundcolor",type:"colorinput",label:"Background color"}];return{title:"Advanced",name:"advanced",items:"cell"===n?[{name:"borderwidth",type:"input",label:"Border width"}].concat(t):t}},Wa=function(n,t,e,r){return E(n,function(n){return e.formatter.matchNode(r,t+n)}).getOr("")},ja=u(Wa,["left","center","right"],"align"),za=u(Wa,["top","middle","bottom"],"valign"),Fa=[{name:"width",type:"input",label:"Width"},{name:"height",type:"input",label:"Height"},{name:"celltype",type:"selectbox",label:"Cell type",items:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{name:"scope",type:"selectbox",label:"Scope",items:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{name:"halign",type:"selectbox",label:"H Align",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{name:"valign",type:"selectbox",label:"V Align",items:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}],La=function(n){return function(n){var t=ka(function(n){return n.getParam("table_cell_class_list",[],"array")}(n));return t.length>0?d.some({name:"class",type:"selectbox",label:"Class",items:t}):d.none()}(n).fold(function(){return Fa},function(n){return Fa.concat(n)})},Ha=function(n){return function(t,e){var r=t.dom;return{setAttrib:function(t,o){n&&!o||r.setAttrib(e,t,o)},setStyle:function(t,o){n&&!o||r.setStyle(e,t,o)},setFormat:function(r,o){n&&!o||(""===o?t.formatter.remove(r,{value:null},e,!0):t.formatter.apply(r,{value:o},e))}}}},qa={normal:Ha(!1),ifTruthy:Ha(!0)},Va=function(n,t,e){var r=n.dom,o=1===t.length;B(t,function(t){var u=e.celltype&&Zu(t)!==e.celltype?r.rename(t,e.celltype):t,i=o?qa.normal(n,u):qa.ifTruthy(n,u);!function(n,t){n.setAttrib("scope",t.scope),n.setAttrib("class",t.class),n.setStyle("width",oi(t.width)),n.setStyle("height",oi(t.height))}(i,e),Vu(n)&&function(n,t){n.setFormat("tablecellbackgroundcolor",t.backgroundcolor),n.setFormat("tablecellbordercolor",t.bordercolor),n.setFormat("tablecellborderstyle",t.borderstyle),n.setFormat("tablecellborderwidth",oi(t.borderwidth))}(i,e),o&&(Pa(n,u),function(n,t){Aa.each("top middle bottom".split(" "),function(e){n.formatter.remove("valign"+e,{},t)})}(n,u)),e.halign&&Ia(n,u,e.halign),e.valign&&function(n,t,e){e&&n.formatter.apply("valign"+e,{},t)}(n,u,e.valign)})},Ua=function(n,t,e){var r=e.getData();e.close(),n.undoManager.transact(function(){Va(n,t,r),n.focus()})},Ka=function(n){var t=pa(n);if(0!==t.length){var e=A(t,function(t){return function(n,t,e){var r=n.dom;return wn({width:r.getStyle(t,"width")||r.getAttrib(t,"width"),height:r.getStyle(t,"height")||r.getAttrib(t,"height"),scope:r.getAttrib(t,"scope"),celltype:Zu(t),class:r.getAttrib(t,"class",""),halign:ja(n,t),valign:za(n,t)},e?Ma(r,t):{})}(n,t,Vu(n))}),r=Na(e),o={type:"tabpanel",tabs:[{title:"General",name:"general",items:La(n)},_a("cell")]},i={type:"panel",items:[{type:"grid",columns:2,items:La(n)}]};n.windowManager.open({title:"Cell Properties",size:"normal",body:Vu(n)?o:i,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:r,onSubmit:u(Ua,n,t)})}},$a=[{type:"selectbox",name:"type",label:"Row type",items:[{text:"Header",value:"header"},{text:"Body",value:"body"},{text:"Footer",value:"footer"}]},{type:"selectbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height",type:"input"}],Xa=function(n){return function(n){var t=ka(function(n){return n.getParam("table_row_class_list",[],"array")}(n));return t.length>0?d.some({name:"class",type:"selectbox",label:"Class",items:t}):d.none()}(n).fold(function(){return $a},function(n){return $a.concat(n)})},Ga=function(n,t,e,r){var o=1===t.length;B(t,function(t){r.type!==Zu(t.parentNode)&&fa(n,t,r.type);var u=o?qa.normal(n,t):qa.ifTruthy(n,t);!function(n,t){n.setAttrib("scope",t.scope),n.setAttrib("class",t.class),n.setStyle("height",oi(t.height))}(u,r),Uu(n)&&function(n,t){n.setStyle("background-color",t.backgroundcolor),n.setStyle("border-color",t.bordercolor),n.setStyle("border-style",t.borderstyle)}(u,r),r.align!==e.align&&(Pa(n,t),Ia(n,t,r.align))})},Ya=function(n,t,e,r){var o=r.getData();r.close(),n.undoManager.transact(function(){Ga(n,t,e,o),n.focus()})},Ja=function(n){var t=ha(n);if(0!==t.length){var e=A(t,function(t){return function(n,t,e){var r=n.dom;return wn({height:r.getStyle(t,"height")||r.getAttrib(t,"height"),scope:r.getAttrib(t,"scope"),class:r.getAttrib(t,"class",""),type:ca(0,t),align:ja(n,t)},e?Ma(r,t):{})}(n,t,Uu(n))}),r=Na(e),o={type:"tabpanel",tabs:[{title:"General",name:"general",items:Xa(n)},_a("row")]},i={type:"panel",items:[{type:"grid",columns:2,items:Xa(n)}]};n.windowManager.open({title:"Row Properties",size:"normal",body:Uu(n)?o:i,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:r,onSubmit:u(Ya,n,t,r)})}},Qa=tinymce.util.Tools.resolve("tinymce.Env"),Za=function(n,t,e){var r=e?[{type:"input",name:"cols",label:"Cols",inputMode:"numeric"},{type:"input",name:"rows",label:"Rows",inputMode:"numeric"}]:[],o=function(n){return n.getParam("table_appearance_options",!0,"boolean")}(n)?[{type:"input",name:"cellspacing",label:"Cell spacing",inputMode:"numeric"},{type:"input",name:"cellpadding",label:"Cell padding",inputMode:"numeric"},{type:"input",name:"border",label:"Border width"},{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[],u=t.length>0?[{type:"selectbox",name:"class",label:"Class",items:t}]:[];return r.concat([{type:"input",name:"width",label:"Width"},{type:"input",name:"height",label:"Height"}]).concat(o).concat([{type:"selectbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]).concat(u)},nl=function(n,t,e,r){if("TD"===t.tagName||"TH"===t.tagName)p(e)?n.setStyle(t,e,r):n.setStyle(t,e);else if(t.children)for(var o=0;o<t.children.length;o++)nl(n,t.children[o],e,r)},tl=function(n,t,e){var r,o=n.dom,u=e.getData();e.close(),""===u.class&&delete u.class,n.undoManager.transact(function(){if(!t){var e=parseInt(u.cols,10)||1,i=parseInt(u.rows,10)||1;t=Ca(n,e,i,0,0)}!function(n,t,e){var r,o=n.dom,u={},i={};if(u.class=e.class,i.height=oi(e.height),o.getAttrib(t,"width")&&!$u(n)?u.width=(r=e.width)?r.replace(/px$/,""):"":i.width=oi(e.width),$u(n)?(i["border-width"]=oi(e.border),i["border-spacing"]=oi(e.cellspacing)):(u.border=e.border,u.cellpadding=e.cellpadding,u.cellspacing=e.cellspacing),$u(n)&&t.children)for(var c=0;c<t.children.length;c++)nl(o,t.children[c],{"border-width":oi(e.border),padding:oi(e.cellpadding)}),Ku(n)&&nl(o,t.children[c],{"border-color":e.bordercolor});Ku(n)&&(i["background-color"]=e.backgroundcolor,i["border-color"]=e.bordercolor,i["border-style"]=e.borderstyle),u.style=o.serializeStyle(wn(wn({},Hu(n)),i)),o.setAttribs(t,wn(wn({},Lu(n)),u))}(n,t,u),(r=o.select("caption",t)[0])&&!u.caption&&o.remove(r),!r&&u.caption&&((r=o.create("caption")).innerHTML=Qa.ie?" ":'<br data-mce-bogus="1"/>',t.insertBefore(r,t.firstChild)),""===u.align?Pa(n,t):Ia(n,t,u.align),n.focus(),n.addVisual()})},el=function(n,t){var e,r=n.dom,o=function(n,t){var e,r,o,u,i=Hu(n),c=Lu(n),a=t?(e=n.dom,{borderstyle:K(i,"border-style").getOr(""),bordercolor:Ea(e)(K(i,"border-color").getOr("")),backgroundcolor:Ea(e)(K(i,"background-color").getOr(""))}):{};return wn(wn(wn(wn(wn(wn({},{height:"",width:"100%",cellspacing:"",cellpadding:"",caption:!1,class:"",align:"",border:""}),i),c),a),(u=i["border-width"],$u(n)&&u?{border:u}:K(c,"border").fold(function(){return{}},function(n){return{border:n}}))),(r=K(i,"border-spacing").or(K(c,"cellspacing")).fold(function(){return{}},function(n){return{cellspacing:n}}),o=K(i,"border-padding").or(K(c,"cellpadding")).fold(function(){return{}},function(n){return{cellpadding:n}}),wn(wn({},r),o)))}(n,Ku(n));!1===t?(e=r.getParent(n.selection.getStart(),"table"))?o=function(n,t,e){var r=n.dom;return wn({width:r.getStyle(t,"width")||r.getAttrib(t,"width"),height:r.getStyle(t,"height")||r.getAttrib(t,"height"),cellspacing:r.getStyle(t,"border-spacing")||r.getAttrib(t,"cellspacing"),cellpadding:r.getAttrib(t,"cellpadding")||Ba(n.dom,t,"padding"),border:function(t,e){var r=mt(bn.fromDom(e),"border-width");return $u(n)&&r.isSome()?r.getOr(""):t.getAttrib(e,"border")||Ba(n.dom,e,"border-width")||Ba(n.dom,e,"border")}(r,t),caption:!!r.select("caption",t)[0],class:r.getAttrib(t,"class",""),align:ja(n,t)},e?Ma(r,t):{})}(n,e,Ku(n)):Ku(n)&&(o.borderstyle="",o.bordercolor="",o.backgroundcolor=""):(o.cols="1",o.rows="1",Ku(n)&&(o.borderstyle="",o.bordercolor="",o.backgroundcolor=""));var i=ka(function(n){return n.getParam("table_class_list",[],"array")}(n));i.length>0&&o.class&&(o.class=o.class.replace(/\s*mce\-item\-table\s*/g,""));var c={type:"grid",columns:2,items:Za(n,i,t)},a=Ku(n)?{type:"tabpanel",tabs:[{title:"General",name:"general",items:[c]},_a("table")]}:{type:"panel",items:[c]};n.windowManager.open({title:"Table Properties",size:"normal",body:a,onSubmit:u(tl,n,e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:o})},rl=function(n,t,o,c,a){var l=ri(n),f=function(n){return Yt(n,l)},s=function(t){return ma(n).each(function(e){f(e).each(function(r){var u=ar(c,r,e);t(r,u).each(function(t){n.selection.setRng(t),n.focus(),o.clear(r),ui(r)})})})},m=function(){return ma(n).map(function(t){return f(t).bind(function(r){var o=ar(c,r,t),u=xe(e,bn.fromDom(n.getDoc()),d.none());return Da(r,o,u)})})},g=function(){return ma(n).map(function(n){return f(n).bind(function(t){var e=ar(c,t,n);return Oa(t,e)})})},v=function(t,e){return e().each(function(e){var u=A(e,function(n){return ve(n)});ma(n).each(function(e){return f(e).each(function(i){var a=Te(bn.fromDom(n.getDoc())),l=function(n,t,e,o){return{selection:r(or(t,n)),clipboard:r(e),generators:r(o)}}(c,e,u,a);t(i,l).each(function(t){n.selection.setRng(t),n.focus(),o.clear(i)})})})})};H({mceTableSplitCells:function(){return s(t.unmergeCells)},mceTableMergeCells:function(){return s(t.mergeCells)},mceTableInsertRowBefore:function(){return s(t.insertRowsBefore)},mceTableInsertRowAfter:function(){return s(t.insertRowsAfter)},mceTableInsertColBefore:function(){return s(t.insertColumnsBefore)},mceTableInsertColAfter:function(){return s(t.insertColumnsAfter)},mceTableDeleteCol:function(){return s(t.deleteColumn)},mceTableDeleteRow:function(){return s(t.deleteRow)},mceTableCutCol:function(n){return g().each(function(n){a.setColumns(n),s(t.deleteColumn)})},mceTableCutRow:function(n){return m().each(function(n){a.setRows(n),s(t.deleteRow)})},mceTableCopyCol:function(n){return g().each(function(n){return a.setColumns(n)})},mceTableCopyRow:function(n){return m().each(function(n){return a.setRows(n)})},mceTablePasteColBefore:function(n){return v(t.pasteColsBefore,a.getColumns)},mceTablePasteColAfter:function(n){return v(t.pasteColsAfter,a.getColumns)},mceTablePasteRowBefore:function(n){return v(t.pasteRowsBefore,a.getRows)},mceTablePasteRowAfter:function(n){return v(t.pasteRowsAfter,a.getRows)},mceTableDelete:function(){return ga(n).each(function(t){Yt(t,l).filter(i(l)).each(function(t){var e=bn.fromText("");if(ht(t,e),xt(t),n.dom.isEmpty(n.getBody()))n.setContent(""),n.selection.setCursorLocation();else{var r=n.dom.createRng();r.setStart(e.dom(),0),r.setEnd(e.dom(),0),n.selection.setRng(r),n.nodeChanged()}})})},mceTableSizingMode:function(t,e){return function(t){return ga(n).each(function(e){Yu(n)||Gu(n)||Xu(n)||Yt(e,l).each(function(e){"relative"!==t||Ao(e)?"fixed"!==t||Bo(e)?"responsive"!==t||Io(e)||xi(e):Si(n,e):Ci(n,e),ui(e)})})}(e)}},function(t,e){return n.addCommand(e,t)}),H({mceTableCellType:function(e,r){return t.setTableCellType(n,r)},mceTableRowType:function(e,r){return t.setTableRowType(n,r)}},function(t,e){return n.addCommand(e,t)}),n.addCommand("mceTableColType",function(n,e){return K(e,"type").each(function(n){return s("th"===n?t.makeColumnHeader:t.unmakeColumnHeader)})}),H({mceTableProps:u(el,n,!1),mceTableRowProps:u(Ja,n),mceTableCellProps:u(Ka,n)},function(t,e){return n.addCommand(e,function(){return t()})}),n.addCommand("mceInsertTable",function(t,e){h(e)&&F(e).length>0?Sa(n,e.rows,e.columns,e.options,"Invalid values for mceInsertTable - rows and columns values are required to insert a table."):el(n,!0)}),n.addCommand("mceTableApplyCellStyle",function(t,e){if(h(e)){var r=pa(n);0!==r.length&&H(e,function(t,e){var o="tablecell"+e.toLowerCase().replace("-","");n.formatter.has(o)&&p(t)&&B(r,function(e){qa.normal(n,e).setFormat(o,t)})})}})},ol=function(n,t,e){var r=ri(n);H({mceTableRowType:function(){return t.getTableRowType(n)},mceTableCellType:function(){return t.getTableCellType(n)},mceTableColType:function(){return ma(n).bind(function(n){return function(n){return Yt(n,r)}(n).map(function(r){var o=ar(e,r,n);return t.getTableColType(r,o)})}).getOr("")}},function(t,e){return n.addQueryValueHandler(e,t)})},ul=function(){var n=si(d.none()),t=si(d.none()),e=function(n){n.set(d.none())};return{getRows:n.get,setRows:function(r){n.set(r),e(t)},clearRows:function(){return e(n)},getColumns:t.get,setColumns:function(r){t.set(r),e(n)},clearColumns:function(){return e(t)}}},il=Qe([{none:["current"]},{first:["current"]},{middle:["current","target"]},{last:["current"]}]),cl=wn(wn({},il),{none:function(n){return void 0===n&&(n=void 0),il.none(n)}}),al=function(n,t){return Yt(n,t).bind(function(t){var e=Gt(t);return M(e,function(t){return Hn(n,t)}).map(function(n){return{index:n,all:e}})})},ll=function(n,t,e,o){return{start:r(n),soffset:r(t),finish:r(e),foffset:r(o)}},fl=Qe([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),sl={before:fl.before,on:fl.on,after:fl.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(o,o,o)}},dl=Qe([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),ml={domRange:dl.domRange,relative:dl.relative,exact:dl.exact,exactFromRange:function(n){return dl.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){var t,e=function(n){return n.match({domRange:function(n){return bn.fromDom(n.startContainer)},relative:function(n,t){return sl.getStart(n)},exact:function(n,t,e,r){return n}})}(n);return t=e,bn.fromDom(t.dom().ownerDocument.defaultView)},range:ll},gl=function(n,t){return n.selectNodeContents(t.dom())},pl=function(n,t,e){var r,o=n.document.createRange();return r=o,t.fold(function(n){r.setStartBefore(n.dom())},function(n,t){r.setStart(n.dom(),t)},function(n){r.setStartAfter(n.dom())}),function(n,t){t.fold(function(t){n.setEndBefore(t.dom())},function(t,e){n.setEnd(t.dom(),e)},function(t){n.setEndAfter(t.dom())})}(o,e),o},hl=function(n,t,e,r,o){var u=n.document.createRange();return u.setStart(t.dom(),e),u.setEnd(r.dom(),o),u},vl=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},bl=Qe([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),wl=function(n,t,e){return t(bn.fromDom(e.startContainer),e.startOffset,bn.fromDom(e.endContainer),e.endOffset)},yl=function(n,t){return function(n,t){var e=t.ltr();return e.collapsed?t.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return bl.rtl(bn.fromDom(n.endContainer),n.endOffset,bn.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return wl(0,bl.ltr,e)}):wl(0,bl.ltr,e)}(0,function(n,t){return t.match({domRange:function(n){return{ltr:r(n),rtl:d.none}},relative:function(t,e){return{ltr:yn(function(){return pl(n,t,e)}),rtl:yn(function(){return d.some(pl(n,e,t))})}},exact:function(t,e,r,o){return{ltr:yn(function(){return hl(n,t,e,r,o)}),rtl:yn(function(){return d.some(hl(n,r,o,t,e))})}}})}(n,t))},Cl=function(n,t){return yl(n,t).match({ltr:function(t,e,r,o){var u=n.document.createRange();return u.setStart(t.dom(),e),u.setEnd(r.dom(),o),u},rtl:function(t,e,r,o){var u=n.document.createRange();return u.setStart(r.dom(),o),u.setEnd(t.dom(),e),u}})},Sl=(bl.ltr,bl.rtl,function(n,t,e){return t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom}),xl=function(n,t,e,r,o){var u=function(e){var r=n.dom().createRange();return r.setStart(t.dom(),e),r.collapse(!0),r},i=ie(t).length,c=function(n,t,e,r,o){if(0===o)return 0;if(t===r)return o-1;for(var u=r,i=1;i<o;i++){var c=n(i),a=Math.abs(t-c.left);if(e<=c.bottom){if(e<c.top||a>u)return i-1;u=a}}return 0}(function(n){return u(n).getBoundingClientRect()},e,r,o.right,i);return u(c)},Tl=function(n,t,e,r){return Z(t)?function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var u=o.getClientRects();return z(u,function(n){return Sl(n,e,r)?d.some(n):d.none()}).map(function(o){return xl(n,t,e,r,o)})}(n,t,e,r):function(n,t,e,r){var o=n.dom().createRange(),u=Jn(t);return z(u,function(t){return o.selectNode(t.dom()),Sl(o.getBoundingClientRect(),e,r)?Tl(n,t,e,r):d.none()})}(n,t,e,r)},Rl=function(n,t){return t-n.left<n.right-t},Ol=function(n,t,e){var r=n.dom().createRange();return r.selectNode(t.dom()),r.collapse(e),r},Dl=function(n,t,e){var r=n.dom().createRange();r.selectNode(t.dom());var o=r.getBoundingClientRect(),u=Rl(o,e);return(!0===u?de:me)(t).map(function(t){return Ol(n,t,u)})},Al=function(n,t,e){var r=t.dom().getBoundingClientRect(),o=Rl(r,e);return d.some(Ol(n,t,o))},Bl=function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var u=o.getBoundingClientRect();return function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var u=o.getBoundingClientRect(),i=Math.max(u.left,Math.min(u.right,e)),c=Math.max(u.top,Math.min(u.bottom,r));return Tl(n,t,i,c)}(n,t,Math.max(u.left,Math.min(u.right,e)),Math.max(u.top,Math.min(u.bottom,r)))},Il=document.caretPositionFromPoint?function(n,t,e){return d.from(n.dom().caretPositionFromPoint(t,e)).bind(function(t){if(null===t.offsetNode)return d.none();var e=n.dom().createRange();return e.setStart(t.offsetNode,t.offset),e.collapse(),d.some(e)})}:document.caretRangeFromPoint?function(n,t,e){return d.from(n.dom().caretRangeFromPoint(t,e))}:function(n,t,e){return bn.fromPoint(n,t,e).bind(function(r){var o=function(){return function(n,t,e){return(0===Jn(t).length?Al:Dl)(n,t,e)}(n,r,t)};return 0===Jn(r).length?o():Bl(n,r,t,e).orThunk(o)})},Pl=function(n,t){var e=X(n);return"input"===e?sl.after(n):R(["br","img"],e)?0===t?sl.before(n):sl.after(n):sl.on(n,t)},kl=function(n,t){var e=n.fold(sl.before,Pl,sl.after),r=t.fold(sl.before,Pl,sl.after);return ml.relative(e,r)},El=function(n,t,e,r){var o=Pl(n,t),u=Pl(e,r);return ml.relative(o,u)},Ml=function(n,t,e,r){var o=function(n,t,e,r){var o=Kn(n).dom().createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o}(n,t,e,r),u=Hn(n,e)&&t===r;return o.collapsed&&!u},Nl=function(n,t){d.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(t)})},_l=function(n,t,e,r,o){var u=hl(n,t,e,r,o);Nl(n,u)},Wl=function(n,t){return yl(n,t).match({ltr:function(t,e,r,o){_l(n,t,e,r,o)},rtl:function(t,e,r,o){var u=n.getSelection();if(u.setBaseAndExtent)u.setBaseAndExtent(t.dom(),e,r.dom(),o);else if(u.extend)try{!function(n,t,e,r,o,u){t.collapse(e.dom(),r),t.extend(o.dom(),u)}(0,u,t,e,r,o)}catch(u){_l(n,r,o,t,e)}else _l(n,r,o,t,e)}})},jl=function(n,t,e,r,o){var u=El(t,e,r,o);Wl(n,u)},zl=function(n,t,e){var r=kl(t,e);Wl(n,r)},Fl=function(n){var t=ml.getWin(n).dom(),e=function(n,e,r,o){return hl(t,n,e,r,o)},r=function(n){return n.match({domRange:function(n){var t=bn.fromDom(n.startContainer),e=bn.fromDom(n.endContainer);return El(t,n.startOffset,e,n.endOffset)},relative:kl,exact:El})}(n);return yl(t,r).match({ltr:e,rtl:e})},Ll=function(n){var t=bn.fromDom(n.anchorNode),e=bn.fromDom(n.focusNode);return Ml(t,n.anchorOffset,e,n.focusOffset)?d.some(ll(t,n.anchorOffset,e,n.focusOffset)):function(n){if(n.rangeCount>0){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return d.some(ll(bn.fromDom(t.startContainer),t.startOffset,bn.fromDom(e.endContainer),e.endOffset))}return d.none()}(n)},Hl=function(n,t){var e=function(n,t){var e=n.document.createRange();return gl(e,t),e}(n,t);Nl(n,e)},ql=function(n){return function(n){return d.from(n.getSelection()).filter(function(n){return n.rangeCount>0}).bind(Ll)}(n).map(function(n){return ml.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},Vl=function(n,t){return function(n){var t=n.getClientRects(),e=t.length>0?t[0]:n.getBoundingClientRect();return e.width>0||e.height>0?d.some(e).map(vl):d.none()}(Cl(n,t))},Ul=function(n,t,e){return function(n,t,e){var r=bn.fromDom(n.document);return Il(r,t,e).map(function(n){return ll(bn.fromDom(n.startContainer),n.startOffset,bn.fromDom(n.endContainer),n.endOffset)})}(n,t,e)},Kl=tinymce.util.Tools.resolve("tinymce.util.VK"),$l=function(n,t,e,r){return Yl(n,t,function(n,t){return al(n,t).fold(function(){return cl.none(n)},function(t){return t.index+1<t.all.length?cl.middle(n,t.all[t.index+1]):cl.last(n)})}(e),r)},Xl=function(n,t,e,r){return Yl(n,t,function(n,t){return al(n,t).fold(function(){return cl.none()},function(t){return t.index-1>=0?cl.middle(n,t.all[t.index-1]):cl.first(n)})}(e),r)},Gl=function(n,t){var e=ml.exact(t,0,t,0);return Fl(e)},Yl=function(n,t,e,r,o){return e.fold(d.none,d.none,function(n,t){return de(t).map(function(n){return Gl(0,n)})},function(e){return Yt(e,t).bind(function(t){var o=cr(e);return n.undoManager.transact(function(){r.insertRowsAfter(t,o)}),function(n,t){var e=kt(t,"tr");return j(e).bind(function(n){return Wt(n,"td,th").map(function(n){return Gl(0,n)})})}(0,t)})})},Jl=["table","li","dl"],Ql=function(n,t,e,r){if(n.keyCode===Kl.TAB){var o=ni(t),u=function(n){var t=X(n);return Hn(n,o)||R(Jl,t)},i=t.selection.getRng();if(i.collapsed){var c=bn.fromDom(i.startContainer);Xt(c,u).each(function(o){n.preventDefault(),(n.shiftKey?Xl:$l)(t,u,o,e,r).each(function(n){t.selection.setRng(n)})})}}},Zl=function(n,t){return{selection:r(n),kill:r(t)}},nf=function(n,t,e,o){return{start:r(sl.on(n,t)),finish:r(sl.on(e,o))}},tf=function(n,t){var e=Cl(n,t);return ll(bn.fromDom(e.startContainer),e.startOffset,bn.fromDom(e.endContainer),e.endOffset)},ef=nf,rf=function(n,t,e,r,o){return Hn(e,r)?d.none():Ve(e,r,t).bind(function(t){var r=t.boxes.getOr([]);return r.length>0?(o(n,r,t.start,t.finish),d.some(Zl(d.some(ef(e,0,e,le(e))),!0))):d.none()})},of=function(n,t){return{item:r(n),mode:r(t)}},uf=function(n,t,e,r){return void 0===r&&(r=cf),n.property().parent(t).map(function(n){return of(n,r)})},cf=function(n,t,e,r){return void 0===r&&(r=af),e.sibling(n,t).map(function(n){return of(n,r)})},af=function(n,t,e,r){void 0===r&&(r=af);var o=n.property().children(t);return e.first(o).map(function(n){return of(n,r)})},lf=[{current:uf,next:cf,fallback:d.none()},{current:cf,next:af,fallback:d.some(uf)},{current:af,next:af,fallback:d.some(cf)}],ff=function(n,t,e,r,o){return void 0===o&&(o=lf),E(o,function(n){return n.current===e}).bind(function(e){return e.current(n,t,r,e.next).orThunk(function(){return e.fallback.bind(function(e){return ff(n,t,e,r)})})})},sf=function(){return{sibling:function(n,t){return n.query().prevSibling(t)},first:function(n){return n.length>0?d.some(n[n.length-1]):d.none()}}},df=function(){return{sibling:function(n,t){return n.query().nextSibling(t)},first:function(n){return n.length>0?d.some(n[0]):d.none()}}},mf=function(n,t,e,r,o,u){return ff(n,t,r,o).bind(function(t){return u(t.item())?d.none():e(t.item())?d.some(t.item()):mf(n,t.item(),e,t.mode(),o,u)})},gf=function(n){return function(t){return 0===n.property().children(t).length}},pf=function(n,t,e,r){return mf(n,t,e,cf,sf(),r)},hf=function(n,t,e,r){return mf(n,t,e,cf,df(),r)},vf=_e(),bf=function(n,t){return function(n,t,e){return pf(n,t,gf(n),e)}(vf,n,t)},wf=function(n,t){return function(n,t,e){return hf(n,t,gf(n),e)}(vf,n,t)},yf=Qe([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),Cf=function(n){return jt(n,"tr")},Sf=wn(wn({},yf),{verify:function(n,t,e,r,o,u,i){return jt(r,"td,th",i).bind(function(e){return jt(t,"td,th",i).map(function(t){return Hn(e,t)?Hn(r,e)&&le(e)===o?u(t):yf.none("in same cell"):He(Cf,[e,t]).fold(function(){return function(n,t,e){var r=n.getRect(t),o=n.getRect(e);return o.right>r.left&&o.left<r.right}(n,t,e)?yf.success():u(t)},function(n){return u(t)})})}).getOr(yf.none("default"))},cata:function(n,t,e,r,o){return n.fold(t,e,r,o)}}),xf=function(n){return $n(n).bind(function(t){var e=Jn(t);return Tf(e,n).map(function(o){return function(n,t,e,o){return{parent:r(n),children:r(t),element:r(e),index:r(o)}}(t,e,n,o)})})},Tf=function(n,t){return M(n,u(Hn,t))},Rf=function(n){return"br"===X(n)},Of=function(n,t,e){return t(n,e).bind(function(n){return Z(n)&&0===ie(n).trim().length?Of(n,t,e):d.some(n)})},Df=function(n,t,e,r){return function(n,t){return Qn(n,t).filter(Rf).orThunk(function(){return Qn(n,t-1).filter(Rf)})}(t,e).bind(function(t){return r.traverse(t).fold(function(){return Of(t,r.gather,n).map(r.relative)},function(n){return xf(n).map(function(n){return sl.on(n.parent(),n.index())})})})},Af=function(n,t,e,o){return(Rf(t)?function(n,t,e){return e.traverse(t).orThunk(function(){return Of(t,e.gather,n)}).map(e.relative)}(n,t,o):Df(n,t,e,o)).map(function(n){return{start:r(n),finish:r(n)}})},Bf=function(n,t){return{left:n.left,top:n.top+t,right:n.right,bottom:n.bottom+t}},If=function(n,t){return{left:n.left,top:n.top-t,right:n.right,bottom:n.bottom-t}},Pf=function(n,t,e){return{left:n.left+t,top:n.top+e,right:n.right+t,bottom:n.bottom+e}},kf=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom}},Ef=function(n,t){return d.some(n.getRect(t))},Mf=function(n,t,e){return Q(t)?Ef(n,t).map(kf):Z(t)?function(n,t,e){return e>=0&&e<le(t)?n.getRangedRect(t,e,t,e+1):e>0?n.getRangedRect(t,e-1,t,e):d.none()}(n,t,e).map(kf):d.none()},Nf=function(n,t){return Q(t)?Ef(n,t).map(kf):Z(t)?n.getRangedRect(t,0,t,le(t)).map(kf):d.none()},_f=Qe([{none:[]},{retry:["caret"]}]),Wf=function(n,t,e){return(o=t,u=Bc,Et(function(n,t){return t(n)},Mt,o,u,i)).fold(r(!1),function(t){return Nf(n,t).exists(function(n){return function(n,t){return n.left<t.left||Math.abs(t.right-n.left)<1||n.left>t.right}(e,n)})});var o,u,i},jf={point:function(n){return n.bottom},adjuster:function(n,t,e,r,o){var u=Bf(o,5);return Math.abs(e.bottom-r.bottom)<1?_f.retry(u):e.top>o.bottom?_f.retry(u):e.top===o.bottom?_f.retry(Bf(o,1)):Wf(n,t,o)?_f.retry(Pf(u,5,0)):_f.none()},move:Bf,gather:wf},zf=function(n,t,e,r,o){return 0===o?d.some(r):function(n,t,e){return n.elementFromPoint(t,e).filter(function(n){return"table"===X(n)}).isSome()}(n,r.left,t.point(r))?function(n,t,e,r,o){return zf(n,t,e,t.move(r,5),o)}(n,t,e,r,o-1):n.situsFromPoint(r.left,t.point(r)).bind(function(u){return u.start().fold(d.none,function(u){return Nf(n,u).bind(function(i){return t.adjuster(n,u,i,e,r).fold(d.none,function(r){return zf(n,t,e,r,o-1)})}).orThunk(function(){return d.some(r)})},d.none)})},Ff=function(n,t,e){var r=n.move(e,5),o=zf(t,n,e,r,100).getOr(r);return function(n,t,e){return n.point(t)>e.getInnerHeight()?d.some(n.point(t)-e.getInnerHeight()):n.point(t)<0?d.some(-n.point(t)):d.none()}(n,o,t).fold(function(){return t.situsFromPoint(o.left,n.point(o))},function(e){return t.scrollBy(0,e),t.situsFromPoint(o.left,n.point(o)-e)})},Lf={tryUp:u(Ff,{point:function(n){return n.top},adjuster:function(n,t,e,r,o){var u=If(o,5);return Math.abs(e.top-r.top)<1?_f.retry(u):e.bottom<o.top?_f.retry(u):e.bottom===o.top?_f.retry(If(o,1)):Wf(n,t,o)?_f.retry(Pf(u,5,0)):_f.none()},move:If,gather:bf}),tryDown:u(Ff,jf),ieTryUp:function(n,t){return n.situsFromPoint(t.left,t.top-5)},ieTryDown:function(n,t){return n.situsFromPoint(t.left,t.bottom+5)},getJumpSize:r(5)},Hf=function(n,t,e){return n.getSelection().bind(function(r){return Af(t,r.finish(),r.foffset(),e).fold(function(){return d.some(Oi(r.finish(),r.foffset()))},function(o){var u=n.fromSitus(o);return function(n){return Sf.cata(n,function(n){return d.none()},function(){return d.none()},function(n){return d.some(Oi(n,0))},function(n){return d.some(Oi(n,le(n)))})}(Sf.verify(n,r.finish(),r.foffset(),u.finish(),u.foffset(),e.failure,t))})})},qf=function(n,t,e,r,o,u){return 0===u?d.none():Kf(n,t,e,r,o).bind(function(i){var c=n.fromSitus(i),a=Sf.verify(n,e,r,c.finish(),c.foffset(),o.failure,t);return Sf.cata(a,function(){return d.none()},function(){return d.some(i)},function(i){return Hn(e,i)&&0===r?Vf(n,e,r,If,o):qf(n,t,i,0,o,u-1)},function(i){return Hn(e,i)&&r===le(i)?Vf(n,e,r,Bf,o):qf(n,t,i,le(i),o,u-1)})})},Vf=function(n,t,e,r,o){return Mf(n,t,e).bind(function(t){return Uf(n,o,r(t,Lf.getJumpSize()))})},Uf=function(n,t,e){var r=zn().browser;return r.isChrome()||r.isSafari()||r.isFirefox()||r.isEdge()?t.otherRetry(n,e):r.isIE()?t.ieRetry(n,e):d.none()},Kf=function(n,t,e,r,o){return Mf(n,e,r).bind(function(t){return Uf(n,o,t)})},$f=function(n,t){return Mt(n,function(n){return $n(n).exists(function(n){return Hn(n,t)})},e).isSome();var e},Xf=function(n,t,e,o,u){return jt(o,"td,th",t).bind(function(o){return jt(o,"table",t).bind(function(i){return $f(u,i)?function(n,t,e){return Hf(n,t,e).bind(function(r){return qf(n,t,r.element(),r.offset(),e,20).map(n.fromSitus)})}(n,t,e).bind(function(n){return jt(n.finish(),"td,th",t).map(function(t){return{start:r(o),finish:r(t),range:r(n)}})}):d.none()})})},Gf=function(n,t,e,r,o,u){return zn().browser.isIE()?d.none():u(r,t).orThunk(function(){return Xf(n,t,e,r,o).map(function(n){var t=n.range();return Zl(d.some(ef(t.start(),t.soffset(),t.finish(),t.foffset())),!0)})})},Yf=function(n,t){return jt(n,"tr",t).bind(function(n){return jt(n,"table",t).bind(function(e){var r=kt(e,"tr");return Hn(n,r[0])?function(n,t,e){return pf(vf,n,t,e)}(e,function(n){return me(n).isSome()},t).map(function(n){var t=le(n);return Zl(d.some(ef(n,t,n,t)),!0)}):d.none()})})},Jf=function(n,t){return jt(n,"tr",t).bind(function(n){return jt(n,"table",t).bind(function(e){var r=kt(e,"tr");return Hn(n,r[r.length-1])?function(n,t,e){return hf(vf,n,t,e)}(e,function(n){return de(n).isSome()},t).map(function(n){return Zl(d.some(ef(n,0,n,0)),!0)}):d.none()})})},Qf=function(n,t,e,r,o,u,i){return Xf(n,e,r,o,u).bind(function(n){return rf(t,e,n.start(),n.finish(),i)})},Zf=function(n,t){return jt(n,"td,th",t)};var ns={traverse:Yn,gather:wf,relative:sl.before,otherRetry:Lf.tryDown,ieRetry:Lf.ieTryDown,failure:Sf.failedDown},ts={traverse:Gn,gather:bf,relative:sl.before,otherRetry:Lf.tryUp,ieRetry:Lf.ieTryUp,failure:Sf.failedUp},es=function(n){return function(t){return t===n}},rs=es(38),os=es(40),us=function(n){return n>=37&&n<=40},is={isBackward:es(37),isForward:es(39)},cs={isBackward:es(39),isForward:es(37)},as=function(n){return{left:n.left(),top:n.top(),right:n.right(),bottom:n.bottom(),width:n.width(),height:n.height()}},ls=function(t){return{elementFromPoint:function(n,e){return bn.fromPoint(bn.fromDom(t.document),n,e)},getRect:function(n){return n.dom().getBoundingClientRect()},getRangedRect:function(n,e,r,o){var u=ml.exact(n,e,r,o);return Vl(t,u).map(as)},getSelection:function(){return ql(t).map(function(n){return tf(t,n)})},fromSitus:function(n){var e=ml.relative(n.start(),n.finish());return tf(t,e)},situsFromPoint:function(n,e){return Ul(t,n,e).map(function(n){return nf(n.start(),n.soffset(),n.finish(),n.foffset())})},clearSelection:function(){!function(n){n.getSelection().removeAllRanges()}(t)},collapseSelection:function(n){void 0===n&&(n=!1),ql(t).each(function(e){return e.fold(function(t){return t.collapse(n)},function(e,r){var o=n?e:r;zl(t,o,o)},function(e,r,o,u){var i=n?e:o,c=n?r:u;jl(t,i,c,i,c)})})},setSelection:function(n){jl(t,n.start(),n.soffset(),n.finish(),n.foffset())},setRelativeSelection:function(n,e){zl(t,n,e)},selectContents:function(n){Hl(t,n)},getInnerHeight:function(){return t.innerHeight},getScrollY:function(){var e,r,o,u;return(e=bn.fromDom(t.document),r=void 0!==e?e.dom():n.document,o=r.body.scrollLeft||r.documentElement.scrollLeft,u=r.body.scrollTop||r.documentElement.scrollTop,sr(o,u)).top()},scrollBy:function(e,r){!function(t,e,r){(void 0!==r?r.dom():n.document).defaultView.scrollBy(t,e)}(e,r,bn.fromDom(t.document))}}},fs=function(n,t){return{rows:n,cols:t}},ss=function(n,t,e,r){var o=function(n,t,e,r){var o=d.none(),u=function(){o=d.none()};return{mousedown:function(n){r.clear(t),o=Zf(n.target(),e)},mouseover:function(u){o.each(function(o){r.clearBeforeUpdate(t),Zf(u.target(),e).each(function(u){Ve(o,u,e).each(function(e){var i=e.boxes.getOr([]);(i.length>1||1===i.length&&!Hn(o,u))&&(r.selectRange(t,i,e.start,e.finish),n.selectContents(u))})})})},mouseup:function(n){o.each(u)}}}(ls(n),t,e,r);return{mousedown:o.mousedown,mouseover:o.mouseover,mouseup:o.mouseup}},ds=function(n,t,e,r){var o=ls(n),i=function(){return r.clear(t),d.none()};return{keydown:function(n,c,a,l,f,s){var m=n.raw(),g=m.which,p=!0===m.shiftKey;return Ue(t,r.selectedSelector).fold(function(){return os(g)&&p?u(Qf,o,t,e,ns,l,c,r.selectRange):rs(g)&&p?u(Qf,o,t,e,ts,l,c,r.selectRange):os(g)?u(Gf,o,e,ns,l,c,Jf):rs(g)?u(Gf,o,e,ts,l,c,Yf):d.none},function(n){var e=function(e){return function(){return z(e,function(e){return function(n,t,e,r,o){return $e(r,n,t,o.firstSelectedSelector,o.lastSelectedSelector).map(function(n){return o.clearBeforeUpdate(e),o.selectRange(e,n.boxes,n.start,n.finish),n.boxes})}(e.rows,e.cols,t,n,r)}).fold(function(){return Ke(t,r.firstSelectedSelector,r.lastSelectedSelector).map(function(n){var e=os(g)||s.isForward(g)?sl.after:sl.before;return o.setRelativeSelection(sl.on(n.first(),0),e(n.table())),r.clear(t),Zl(d.none(),!0)})},function(n){return d.some(Zl(d.none(),!0))})}};return os(g)&&p?e([fs(1,0)]):rs(g)&&p?e([fs(-1,0)]):s.isBackward(g)&&p?e([fs(0,-1),fs(-1,0)]):s.isForward(g)&&p?e([fs(0,1),fs(1,0)]):us(g)&&!1===p?i:d.none})()},keyup:function(n,o,u,i,c){return Ue(t,r.selectedSelector).fold(function(){var a=n.raw(),l=a.which;return!1==(!0===a.shiftKey)?d.none():us(l)?function(n,t,e,r,o,u,i){return Hn(e,o)&&r===u?d.none():jt(e,"td,th",t).bind(function(e){return jt(o,"td,th",t).bind(function(r){return rf(n,t,e,r,i)})})}(t,e,o,u,i,c,r.selectRange):d.none()},d.none)}}},ms=function(n,t,e,r){var o=ls(n);return function(n,u){r.clearBeforeUpdate(t),Ve(n,u,e).each(function(n){var e=n.boxes.getOr([]);r.selectRange(t,e,n.start,n.finish),o.selectContents(u),o.collapseSelection()})}},gs=function(n,t){B(t,function(t){!function(n,t){Yo(n)?n.dom().classList.remove(t):Qo(n,t);nu(n)}(n,t)})},ps={byClass:function(n){var t,e,r=(t=n.selected,function(n){Zo(n,t)}),o=(e=[n.selected,n.lastSelected,n.firstSelected],function(n){gs(n,e)}),u=function(t){var e=kt(t,n.selectedSelector);B(e,o)};return{clearBeforeUpdate:u,clear:u,selectRange:function(t,e,o,i){u(t),B(e,r),Zo(o,n.firstSelected),Zo(i,n.lastSelected)},selectedSelector:n.selectedSelector,firstSelectedSelector:n.firstSelectedSelector,lastSelectedSelector:n.lastSelectedSelector}},byAttr:function(n,t,e){var r=function(t){ln(t,n.selected),ln(t,n.firstSelected),ln(t,n.lastSelected)},o=function(t){rn(t,n.selected,"1")},u=function(n){i(n),e()},i=function(t){var e=kt(t,n.selectedSelector);B(e,r)};return{clearBeforeUpdate:i,clear:u,selectRange:function(e,r,i,c){u(e),B(r,o),rn(i,n.firstSelected,"1"),rn(c,n.lastSelected,"1"),t(r,i,c)},selectedSelector:n.selectedSelector,firstSelectedSelector:n.firstSelectedSelector,lastSelectedSelector:n.lastSelectedSelector}}},hs=function(n,t,e){var r=ee.fromTable(n);return Zi(r,t).map(function(n){var t=Ki(r,e,!1);return{upOrLeftCells:function(n,t,e){var r=n.slice(0,t[t.length-1].row()+1),o=Xi(r,e);return _(o,function(n){var e=n.cells().slice(0,t[t.length-1].column()+1);return A(e,function(n){return n.element()})})}(t,n,e),downOrRightCells:function(n,t,e){var r=n.slice(t[0].row()+t[0].rowspan()-1,n.length),o=Xi(r,e);return _(o,function(n){var e=n.cells().slice(t[0].column()+t[0].colspan()-1,+n.cells().length);return A(e,function(n){return n.element()})})}(t,n,e)}})},vs=function(n){return!1===tu(bn.fromDom(n.target),"ephox-snooker-resizer-bar")};function bs(n,t,r){var o=ps.byAttr(Je,function(t,o,u){r.targets().each(function(r){Yt(o).each(function(i){var c=Qu(n),a=xe(e,bn.fromDom(n.getDoc()),c),l=hs(i,r,a);Nu(n,t,o,u,l)})})},function(){return _u(n)});return n.on("init",function(r){var u=n.getWin(),i=ni(n),c=ri(n),a=ss(u,i,c,o),l=ds(u,i,c,o),f=ms(u,i,c,o);n.on("TableSelectorChange",function(n){return f(n.start,n.finish)});var s,d,m=function(t,e){(function(n){return!0===n.raw().shiftKey})(t)&&(e.kill()&&t.kill(),e.selection().each(function(t){var e=ml.relative(t.start(),t.finish()),r=Cl(u,e);n.selection.setRng(r)}))},g=function(n){return 0===n.button},p=(s=si(bn.fromDom(i)),d=si(0),{touchEnd:function(n){var t=bn.fromDom(n.target);if("td"===X(t)||"th"===X(t)){var e=s.get(),r=d.get();Hn(e,t)&&n.timeStamp-r<300&&(n.preventDefault(),f(t,t))}s.set(t),d.set(n.timeStamp)}});n.on("mousedown",function(n){g(n)&&vs(n)&&a.mousedown(Xo(n))}),n.on("mouseover",function(n){var t;(void 0===(t=n).buttons||Qa.browser.isEdge()&&0===t.buttons||0!=(1&t.buttons))&&vs(n)&&a.mouseover(Xo(n))}),n.on("mouseup",function(n){g(n)&&vs(n)&&a.mouseup(Xo(n))}),n.on("touchend",p.touchEnd),n.on("keyup",function(t){var e=Xo(t);if(e.raw().shiftKey&&us(e.raw().which)){var r=n.selection.getRng(),o=bn.fromDom(r.startContainer),u=bn.fromDom(r.endContainer);l.keyup(e,o,r.startOffset,u,r.endOffset).each(function(n){m(e,n)})}}),n.on("keydown",function(e){var r=Xo(e);t().each(function(n){return n.hideBars()});var o=n.selection.getRng(),u=bn.fromDom(n.selection.getStart()),i=bn.fromDom(o.startContainer),c=bn.fromDom(o.endContainer),a=fi(u).isRtl()?cs:is;l.keydown(r,i,o.startOffset,c,o.endOffset,a).each(function(n){m(r,n)}),t().each(function(n){return n.showBars()})}),n.on("NodeChange",function(){var t=n.selection,r=bn.fromDom(t.getStart()),u=bn.fromDom(t.getEnd());He(Yt,[r,u]).fold(function(){return o.clear(i)},e)})}),{clear:o.clear}}var ws=function(n,t){var e=si(d.none()),r=si([]),o=function(){return ga(n).bind(function(n){var e=Yt(n);return e.map(function(e){return"caption"===X(n)?cr(n):ar(t,e,n)})})},u=function(){e.set(yn(o)()),B(r.get(),function(n){return n()})},i=function(n,t){var o=function(){return e.get().fold(function(){n.setDisabled(!0)},function(e){n.setDisabled(t(e))})};return o(),r.set(r.get().concat([o])),function(){r.set(I(r.get(),function(n){return n!==o}))}};return n.on("NodeChange ExecCommand TableSelectorChange",u),{onSetupTable:function(n){return i(n,function(n){return!1})},onSetupCellOrRow:function(n){return i(n,function(n){return"caption"===X(n.element())})},onSetupPasteable:function(n){return function(t){return i(t,function(t){return"caption"===X(t.element())||n().isNone()})}},onSetupMergeable:function(n){return i(n,function(n){return n.mergable().isNone()})},onSetupUnmergeable:function(n){return i(n,function(n){return n.unmergable().isNone()})},resetTargets:u,targets:function(){return e.get()}}},ys=function(n,t,e){n.ui.registry.addMenuButton("table",{tooltip:"Table",icon:"table",fetch:function(n){return n("inserttable | cell row column | advtablesort | tableprops deletetable")}});var r=function(t){return function(){return n.execCommand(t)}};n.ui.registry.addButton("tableprops",{tooltip:"Table properties",onAction:r("mceTableProps"),icon:"table",onSetup:t.onSetupTable}),n.ui.registry.addButton("tabledelete",{tooltip:"Delete table",onAction:r("mceTableDelete"),icon:"table-delete-table",onSetup:t.onSetupTable}),n.ui.registry.addButton("tablecellprops",{tooltip:"Cell properties",onAction:r("mceTableCellProps"),icon:"table-cell-properties",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablemergecells",{tooltip:"Merge cells",onAction:r("mceTableMergeCells"),icon:"table-merge-cells",onSetup:t.onSetupMergeable}),n.ui.registry.addButton("tablesplitcells",{tooltip:"Split cell",onAction:r("mceTableSplitCells"),icon:"table-split-cells",onSetup:t.onSetupUnmergeable}),n.ui.registry.addButton("tableinsertrowbefore",{tooltip:"Insert row before",onAction:r("mceTableInsertRowBefore"),icon:"table-insert-row-above",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tableinsertrowafter",{tooltip:"Insert row after",onAction:r("mceTableInsertRowAfter"),icon:"table-insert-row-after",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tabledeleterow",{tooltip:"Delete row",onAction:r("mceTableDeleteRow"),icon:"table-delete-row",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablerowprops",{tooltip:"Row properties",onAction:r("mceTableRowProps"),icon:"table-row-properties",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tableinsertcolbefore",{tooltip:"Insert column before",onAction:r("mceTableInsertColBefore"),icon:"table-insert-column-before",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tableinsertcolafter",{tooltip:"Insert column after",onAction:r("mceTableInsertColAfter"),icon:"table-insert-column-after",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tabledeletecol",{tooltip:"Delete column",onAction:r("mceTableDeleteCol"),icon:"table-delete-column",onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablecutrow",{tooltip:"Cut row",icon:"cut-row",onAction:r("mceTableCutRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablecopyrow",{tooltip:"Copy row",icon:"duplicate-row",onAction:r("mceTableCopyRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablepasterowbefore",{tooltip:"Paste row before",icon:"paste-row-before",onAction:r("mceTablePasteRowBefore"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addButton("tablepasterowafter",{tooltip:"Paste row after",icon:"paste-row-after",onAction:r("mceTablePasteRowAfter"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addButton("tablecutcol",{tooltip:"Cut column",icon:"cut-column",onAction:r("mceTableCutCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablecopycol",{tooltip:"Copy column",icon:"duplicate-column",onAction:r("mceTableCopyCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addButton("tablepastecolbefore",{tooltip:"Paste column before",icon:"paste-column-before",onAction:r("mceTablePasteColBefore"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addButton("tablepastecolafter",{tooltip:"Paste column after",icon:"paste-column-after",onAction:r("mceTablePasteColAfter"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addButton("tableinsertdialog",{tooltip:"Insert table",onAction:r("mceInsertTable"),icon:"table"})},Cs=function(n){var t=function(n){return n.getParam("table_toolbar","tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol")}(n);t.length>0&&n.ui.registry.addContextToolbar("table",{predicate:function(t){return n.dom.is(t,"table")&&n.getBody().contains(t)},items:t,scope:"node",position:"node"})},Ss=function(n,t,e){var r=function(t){return function(){return n.execCommand(t)}},o=function(t){var e=t.numRows,r=t.numColumns;n.undoManager.transact(function(){Ca(n,r,e,0,0)}),n.addVisual()},u={text:"Table properties",onSetup:t.onSetupTable,onAction:r("mceTableProps")},i={text:"Delete table",icon:"table-delete-table",onSetup:t.onSetupTable,onAction:r("mceTableDelete")};n.ui.registry.addMenuItem("tableinsertrowbefore",{text:"Insert row before",icon:"table-insert-row-above",onAction:r("mceTableInsertRowBefore"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tableinsertrowafter",{text:"Insert row after",icon:"table-insert-row-after",onAction:r("mceTableInsertRowAfter"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tabledeleterow",{text:"Delete row",icon:"table-delete-row",onAction:r("mceTableDeleteRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablerowprops",{text:"Row properties",icon:"table-row-properties",onAction:r("mceTableRowProps"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecutrow",{text:"Cut row",icon:"cut-row",onAction:r("mceTableCutRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecopyrow",{text:"Copy row",icon:"duplicate-row",onAction:r("mceTableCopyRow"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablepasterowbefore",{text:"Paste row before",icon:"paste-row-before",onAction:r("mceTablePasteRowBefore"),onSetup:t.onSetupPasteable(e.getRows)}),n.ui.registry.addMenuItem("tablepasterowafter",{text:"Paste row after",icon:"paste-row-after",onAction:r("mceTablePasteRowAfter"),onSetup:t.onSetupPasteable(e.getRows)});n.ui.registry.addMenuItem("tableinsertcolumnbefore",{text:"Insert column before",icon:"table-insert-column-before",onAction:r("mceTableInsertColBefore"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tableinsertcolumnafter",{text:"Insert column after",icon:"table-insert-column-after",onAction:r("mceTableInsertColAfter"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tabledeletecolumn",{text:"Delete column",icon:"table-delete-column",onAction:r("mceTableDeleteCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecutcolumn",{text:"Cut column",icon:"cut-column",onAction:r("mceTableCutCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablecopycolumn",{text:"Copy column",icon:"duplicate-column",onAction:r("mceTableCopyCol"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablepastecolumnbefore",{text:"Paste column before",icon:"paste-column-before",onAction:r("mceTablePasteColBefore"),onSetup:t.onSetupPasteable(e.getColumns)}),n.ui.registry.addMenuItem("tablepastecolumnafter",{text:"Paste column after",icon:"paste-column-after",onAction:r("mceTablePasteColAfter"),onSetup:t.onSetupPasteable(e.getColumns)});n.ui.registry.addMenuItem("tablecellprops",{text:"Cell properties",icon:"table-cell-properties",onAction:r("mceTableCellProps"),onSetup:t.onSetupCellOrRow}),n.ui.registry.addMenuItem("tablemergecells",{text:"Merge cells",icon:"table-merge-cells",onAction:r("mceTableMergeCells"),onSetup:t.onSetupMergeable}),n.ui.registry.addMenuItem("tablesplitcells",{text:"Split cell",icon:"table-split-cells",onAction:r("mceTableSplitCells"),onSetup:t.onSetupUnmergeable});!1===function(n){return n.getParam("table_grid",!0,"boolean")}(n)?n.ui.registry.addMenuItem("inserttable",{text:"Table",icon:"table",onAction:r("mceInsertTable")}):n.ui.registry.addNestedMenuItem("inserttable",{text:"Table",icon:"table",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"inserttable",onAction:o}]}}),n.ui.registry.addMenuItem("inserttabledialog",{text:"Insert table",icon:"table",onAction:r("mceInsertTable")}),n.ui.registry.addMenuItem("tableprops",u),n.ui.registry.addMenuItem("deletetable",i),n.ui.registry.addNestedMenuItem("row",{type:"nestedmenuitem",text:"Row",getSubmenuItems:function(){return"tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter"}}),n.ui.registry.addNestedMenuItem("column",{type:"nestedmenuitem",text:"Column",getSubmenuItems:function(){return"tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn"}}),n.ui.registry.addNestedMenuItem("cell",{type:"nestedmenuitem",text:"Cell",getSubmenuItems:function(){return"tablecellprops tablemergecells tablesplitcells"}}),n.ui.registry.addContextMenu("table",{update:function(){return t.resetTargets(),t.targets().fold(function(){return""},function(n){return"caption"===X(n.element())?"tableprops deletetable":"cell row column | advtablesort | tableprops deletetable"})}})},xs={tablecellbackgroundcolor:{selector:"td,th",styles:{backgroundColor:"%value"},remove_similar:!0},tablecellbordercolor:{selector:"td,th",styles:{borderColor:"%value"},remove_similar:!0},tablecellborderstyle:{selector:"td,th",styles:{borderStyle:"%value"},remove_similar:!0},tablecellborderwidth:{selector:"td,th",styles:{borderWidth:"%value"},remove_similar:!0}},Ts=function(n){n.formatter.register(xs)};function Rs(n){var t=sa(n),e=ws(n,t),r=Ri(n),o=bs(n,r.lazyResize,e),u=va(n,r.lazyWire),i=ul();return rl(n,u,o,t,i),ol(n,u,t),lr(n,t,u,o),Ss(n,e,i),ys(n,e,i),Cs(n),n.on("PreInit",function(){n.serializer.addTempAttr(Ge),n.serializer.addTempAttr(Ye),Ts(n)}),qu(n)&&n.on("keydown",function(t){Ql(t,n,u,r.lazyWire)}),n.on("remove",function(){r.destroy()}),Ra(n,i,r,e)}t.add("table",Rs)}(window);