!function(t){"use strict";var n,e,r,o,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=tinymce.util.Tools.resolve("tinymce.util.VK"),a=function(t){return function(n){return r=typeof(e=n),(null===e?"null":"object"==r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===t;var e,r}},l=function(t){return function(n){return typeof n===t}},c=a("string"),f=a("array"),s=function(t){return n===t},m=l("boolean"),g=l("function"),d=function(t){var n=t.getParam("link_assume_external_targets",!1);return m(n)&&n?1:!c(n)||"http"!==n&&"https"!==n?0:n},h=function(t){return t.getParam("default_link_target")},v=function(t){return t.getParam("target_list",!0)},p=function(t){return t.getParam("rel_list",[],"array")},y=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},k=function(){},x=function(t){return function(){return t}},b=x(!1),O=x(!(n=null)),w=function(){return C},C=(e=function(t){return t.isNone()},{fold:function(t,n){return t()},is:b,isSome:b,isNone:O,getOr:o=function(t){return t},getOrThunk:r=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:x(null),getOrUndefined:x(void 0),or:o,orThunk:r,map:w,each:k,bind:w,exists:b,forall:O,filter:w,equals:e,equals_:e,toArray:function(){return[]},toString:x("none()")}),A=function(t){var n=x(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:O,isNone:b,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return A(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:C},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(b,function(n){return e(t,n)})}};return o},N={some:A,none:w,from:function(t){return null==t?C:A(t)}},P=Array.prototype.indexOf,_=Array.prototype.push,S=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!f(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);_.apply(n,t[e])}return n},T=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return N.none()},D=tinymce.util.Tools.resolve("tinymce.util.Tools"),M=function(t){return c(t.value)?t.value:""},L=function(t){return void 0===t&&(t=M),function(n){return N.from(n).map(function(n){return e=n,r=t,o=[],D.each(e,function(t){var n=c(t.text)?t.text:c(t.title)?t.title:"";if(void 0===t.menu){var e=r(t);o.push({text:n,value:e})}}),o;var e,r,o})}},E=function(t){return L(M)(t)},R=L,q=function(t,n){return function(e){return{name:t,type:"selectbox",label:n,items:e}}},K=M,I=function(){return(I=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},U=Object.keys,j=function(t,n){var e,r={};return function(t,n,e,r){(function(t,n){for(var e=U(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}})(t,function(t,o){(n(t,o)?e:r)(t,o)})}(t,n,(e=r,function(t,n){e[n]=t}),k),r},B=function(t){return!(!/(^|[ ,])rtc([, ]|$)/.test(t.getParam("plugins","","string"))||!i.get("rtc"))},F=function(t){return/^\w+:/i.test(t)},V=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},$=function(t,n){var e,r,o=["noopener"],i=t?t.split(/\s+/):[],u=function(t){return t.filter(function(t){return-1===D.inArray(o,t)})},a=n?0<(e=u(e=i)).length?e.concat(o):o:u(i);return 0<a.length?(r=a,D.trim(r.sort().join(" "))):""},H=function(t,n){return n=n||t.selection.getNode(),Q(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},z=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},G=function(t){return t&&"A"===t.nodeName&&!!V(t)},J=function(t){return 0<D.grep(t,G).length},X=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},Q=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},W=function(t,n,e){var r,o,i,u,a=t.selection.getNode(),l=H(t,a),c=function(t,n){var e,r,o=I({},n);if(!(0<p(t).length)&&!1===y(t)){var i=$(o.rel,"_blank"===o.target);o.rel=i||null}return N.from(o.target).isNone()&&!1===v(t)&&(o.target=h(t)),o.href=(e=o.href,"http"!==(r=d(t))&&"https"!==r||F(e)?e:r+"://"+e),o}(t,(o=["title","rel","class","target"],i=function(t,n){return r[n].each(function(e){t[n]=0<e.length?e:null}),t},u={href:(r=e).href},function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e])}(o,function(t){u=i(u,t)}),u));t.undoManager.transact(function(){var r,o,i,u,f,s,m,g;e.href===n.href&&n.attach(),l?(t.focus(),f=t,s=l,m=e.text,g=c,m.each(function(t){s.hasOwnProperty("innerText")?s.innerText=t:s.textContent=t}),f.dom.setAttribs(s,g),f.selection.select(s)):(r=t,o=a,i=e.text,u=c,Q(o)?nt(r,o,u):i.fold(function(){r.execCommand("mceInsertLink",!1,u)},function(t){r.insertContent(r.dom.createHTML("a",u,r.dom.encode(t)))}))})},Y=function(t,n,e){var r,o,i,u,a,l,c;B(t)?t.execCommand("createlink",!1,(o=(r=e).class,i=r.href,u=r.rel,a=r.target,l=r.text,c=r.title,j({class:o.getOrNull(),href:i,rel:u.getOrNull(),target:a.getOrNull(),text:l.getOrNull(),title:c.getOrNull()},function(t,n){return!1===s(t)}))):W(t,n,e)},Z=function(t){var n;B(t)?t.execCommand("unlink"):(n=t).undoManager.transact(function(){var t=n.selection.getNode();if(Q(t))tt(n,t);else{var e=n.dom.getParent(t,"a[href]",n.getBody());e&&n.dom.remove(e,!0)}n.focus()})},tt=function(t,n){var e=t.dom.select("img",n)[0];if(e){var r=t.dom.getParents(e,"a[href]",n)[0];r&&(r.parentNode.insertBefore(e,r),t.dom.remove(r))}},nt=function(t,n,e){var r=t.dom.select("img",n)[0];if(r){var o=t.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},et=function(t,n){var e,r,o=(e=t.text,r=e,{get:function(){return r},set:function(t){r=t}}),i=function(t,e){var r,i,u=(r=n,("link"===(i=e.name)?r.catalogs.link:"anchor"===i?r.catalogs.anchor:N.none()).getOr([]));return function(t,n,e,r){var o,i=r[n],u=0<t.length;return void 0!==i?(o=i,T(e,function(t){return N.some(t).filter(function(t){return t.value===o})}).map(function(n){return{url:{value:n.value,meta:{text:u?t:n.text,attach:k}},text:u?t:n.text}})):N.none()}(o.get(),e.name,u,t)};return{onChange:function(t,n){return"url"===n.name?function(t){if(o.get().length<=0){var n=void 0!==t.url.meta.text?t.url.meta.text:t.url.value,e=void 0!==t.url.meta.title?t.url.meta.title:"";return N.some({text:n,title:e})}return N.none()}(t()):function(t,n){return e=t,r=n,-1<P.call(e,r);var e,r}(["anchor","link"],n.name)?i(t(),n):("text"===n.name&&o.set(t().text),N.none())}}},rt=tinymce.util.Tools.resolve("tinymce.util.Delay"),ot=tinymce.util.Tools.resolve("tinymce.util.Promise"),it=function(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?N.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return I(I({},t),{href:"mailto:"+n})}}):N.none()},ut=function(t,n){return T([it,(e=d(t),r=t.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!F(n)||0===e&&/^\s*www[\.|\d\.]/i.test(n)?N.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return I(I({},t),{href:r+"://"+n})}}):N.none()})],function(t){return t(n)}).fold(function(){return ot.resolve(n)},function(e){return new ot(function(r){var o,i,u,a;o=t,i=e.message,u=function(t){r(t?e.preprocess(n):n)},a=o.selection.getRng(),rt.setEditorTimeout(o,function(){o.windowManager.confirm(i,function(t){o.selection.setRng(a),u(t)})})})});var e,r},at=function(t){var n=function(t,n){return S(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,n))}(t.dom.select("a:not([href])"),function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]});return 0<n.length?N.some([{text:"None",value:""}].concat(n)):N.none()},lt=function(t){var n=t.getParam("link_class_list",[],"array");return 0<n.length?E(n):N.none()},ct=tinymce.util.Tools.resolve("tinymce.util.XHR"),ft=function(t,n){var e=p(t);if(0<e.length){var r=n.is("_blank");return(!1===y(t)?R(function(t){return $(K(t),r)}):E)(e)}return N.none()},st=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],mt=function(t){var n=v(t);return f(n)?E(n).orThunk(function(){return N.some(st)}):!1===n?N.none():N.some(st)},gt=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&0<r.length?N.some(r):N.none()},dt=function(t,n){return(e=t,r=function(t){return e.convertURL(t.value||t.url,"href")},o=e.getParam("link_list"),new ot(function(t){c(o)?ct.send({url:o,success:function(n){return t(function(t){try{return N.some(JSON.parse(t))}catch(t){return N.none()}}(n))},error:function(n){return t(N.none())}}):g(o)?o(function(n){return t(N.some(n))}):t(N.from(o))}).then(function(t){return t.bind(R(r)).map(function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t})})).then(function(e){var r,o,i,u,a,l,c,f,s=(o=n,i=(r=t).dom,u=X(r.selection.getContent())?N.some(z(r.selection,o)):N.none(),a=o?N.some(i.getAttrib(o,"href")):N.none(),l=o?N.from(i.getAttrib(o,"target")):N.none(),c=gt(i,o,"rel"),f=gt(i,o,"class"),{url:a,text:u,title:gt(i,o,"title"),target:l,rel:c,linkClass:f});return{anchor:s,catalogs:{targets:mt(t),rels:ft(t,s.target),classes:lt(t),anchor:at(t),link:e},optNode:N.from(n),flags:{titleEnabled:t.getParam("link_title",!0,"boolean")}}});var e,r,o},ht=function(t,n){return t.dom.getParent(n,"a[href]")},vt=function(t){return ht(t,t.selection.getStart())},pt=function(n,e){if(e){var r=V(e);if(/^#/.test(r)){var o=n.$(r);o.length&&n.selection.scrollIntoView(o[0],!0)}else!function(n){var e=t.document.createElement("a");e.target="_blank",e.href=n,e.rel="noreferrer noopener";var r,o,i=t.document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,t.window,0,0,0,0,0,!1,!1,!1,!1,0,null),r=e,o=i,t.document.body.appendChild(r),r.dispatchEvent(o),t.document.body.removeChild(r)}(e.href)}},yt=function(t){return function(){!function(t){var n,e;(e=H(n=t),dt(n,e)).then(function(n){var e,r,o,i,u,a,l,c,f,s,m,g;return i=function(t){var n=t.getData();if(!n.url.value)return Z(e),void t.close();var o=function(t){return N.from(n[t]).filter(function(n){return!r.anchor[t].is(n)})},i={href:n.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:function(){}};ut(e,i).then(function(t){Y(e,u,t)}),t.close()},u=e=t,c=(o=r=n).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),f=o.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],l=N.from(h(u)),s={url:{value:(a=o).anchor.url.getOr(""),meta:{attach:function(){},text:a.anchor.url.fold(function(){return""},function(){return a.anchor.text.getOr("")}),original:{value:a.anchor.url.getOr("")}}},text:a.anchor.text.getOr(""),title:a.anchor.title.getOr(""),anchor:a.anchor.url.getOr(""),link:a.anchor.url.getOr(""),rel:a.anchor.rel.getOr(""),target:a.anchor.target.or(l).getOr(""),linkClass:a.anchor.linkClass.getOr("")},m=et(s,o),g=o.catalogs,{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:S([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],c,f,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([g.anchor.map(q("anchor","Anchors")),g.rels.map(q("rel","Rel")),g.targets.map(q("target","Open link in...")),g.link.map(q("link","Link list")),g.classes.map(q("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:s,onChange:function(t,n){var e=n.name;m.onChange(t.getData,{name:e}).each(function(n){t.setData(n)})},onSubmit:i}}).then(function(n){t.windowManager.open(n)})}(t)}},kt=function(t){return function(){pt(t,vt(t))}},xt=function(t){t.on("click",function(n){var e=ht(t,n.target);e&&u.metaKeyPressed(n)&&(n.preventDefault(),pt(t,e))}),t.on("keydown",function(n){var e,r=vt(t);r&&13===n.keyCode&&!0===(e=n).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey&&(n.preventDefault(),pt(t,r))})},bt=function(t){return function(n){var e=function(e){return n.setActive(!t.mode.isReadOnly()&&!!H(t,e.element))};return t.on("NodeChange",e),function(){return t.off("NodeChange",e)}}},Ot=function(t){return function(n){var e=t.dom.getParents(t.selection.getStart());n.setDisabled(!J(e));var r=function(t){return n.setDisabled(!J(t.parents))};return t.on("NodeChange",r),function(){return t.off("NodeChange",r)}}};i.add("link",function(t){var n,e,r,o,i,u,a;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:yt(n),onSetup:bt(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:kt(n),onSetup:Ot(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return Z(n)},onSetup:Ot(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:kt(e),onSetup:Ot(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:yt(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return Z(e)},onSetup:Ot(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return J(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),i=function(t){var n=o.selection.getNode();return t.setDisabled(!H(o,n)),function(){}},(o=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:bt(o)},label:"Link",predicate:function(t){return!!H(o,t)&&o.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=H(o);return t?V(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=o.selection.getNode();return t.setActive(!!H(o,n)),bt(o)(t)},onAction:function(t){var n=H(o),e=t.getValue();if(n)o.undoManager.transact(function(){o.dom.setAttrib(n,"href",e),o.selection.collapse(!1),t.hide()});else{var r={href:e,attach:function(){}},i=X(o.selection.getContent())?N.some(z(o.selection,n)).filter(function(t){return 0<t.length}).or(N.from(e)):N.none();Y(o,r,{href:e,text:i,title:N.none(),rel:N.none(),target:N.none(),class:N.none()}),t.hide()}}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:i,onAction:function(t){Z(o),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:i,onAction:function(t){kt(o)(),t.hide()}}]}),xt(t),(u=t).addCommand("mceLink",function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):yt(u)()}),(a=t).addShortcut("Meta+K","",function(){a.execCommand("mceLink")})})}(window);