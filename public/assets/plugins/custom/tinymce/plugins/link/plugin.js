!function(n){"use strict";var t,e=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=tinymce.util.Tools.resolve("tinymce.util.VK"),o=function(n){return function(t){return r=typeof(e=t),(null===e?"null":"object"===r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===n;var e,r}},i=function(n){return function(t){return typeof t===n}},u=o("string"),a=o("array"),c=(t=null,function(n){return t===n}),l=i("boolean"),f=i("function"),s=function(n){var t=n.getParam("link_assume_external_targets",!1);return l(t)&&t?1:!u(t)||"http"!==t&&"https"!==t?0:t},m=function(n){return n.getParam("default_link_target")},g=function(n){return n.getParam("target_list",!0)},d=function(n){return n.getParam("rel_list",[],"array")},h=function(n){return n.getParam("link_title",!0,"boolean")},v=function(n){return n.getParam("allow_unsafe_link_target",!1,"boolean")},p=function(n){return n.getParam("link_default_protocol","http","string")},y=function(){},k=function(n){return function(){return n}},x=k(!1),b=k(!0),O=function(){return w},w=function(){var n=function(n){return n.isNone()},t=function(n){return n()},e=function(n){return n};return{fold:function(n,t){return n()},is:x,isSome:x,isNone:b,getOr:e,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:k(null),getOrUndefined:k(void 0),or:e,orThunk:t,map:O,each:y,bind:O,exists:x,forall:b,filter:O,equals:n,equals_:n,toArray:function(){return[]},toString:k("none()")}}(),C=function(n){var t=k(n),e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:b,isNone:x,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return C(t(n))},each:function(t){t(n)},bind:r,exists:r,forall:r,filter:function(t){return t(n)?o:w},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(x,function(t){return e(n,t)})}};return o},A={some:C,none:O,from:function(n){return null==n?w:C(n)}},N=Array.prototype.indexOf,P=Array.prototype.push,_=function(n,t){return e=n,r=t,N.call(e,r)>-1;var e,r},S=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!a(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);P.apply(t,n[e])}return t},T=function(n,t){return S(function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r}(n,t))},D=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return A.none()},M=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},L=tinymce.util.Tools.resolve("tinymce.util.Tools"),E=function(n){return u(n.value)?n.value:""},R=function(n){return void 0===n&&(n=E),function(t){return A.from(t).map(function(t){return function(n,t){var e=[];return L.each(n,function(n){var r=u(n.text)?n.text:u(n.title)?n.title:"";if(void 0!==n.menu);else{var o=t(n);e.push({text:r,value:o})}}),e}(t,n)})}},U={sanitize:function(n){return R(E)(n)},sanitizeWith:R,createUi:function(n,t){return function(e){return{name:n,type:"selectbox",label:t,items:e}}},getValue:E},q=function(){return(q=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},K=Object.keys,z=function(n,t,e,r){return function(n,t){for(var e=K(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i)}}(n,function(n,o){(t(n,o)?e:r)(n,o)}),{}},I=function(n){return!(!/(^|[ ,])rtc([, ]|$)/.test(n.getParam("plugins","","string"))||!e.get("rtc"))},j=function(n){return/^\w+:/i.test(n)},B=function(n){var t=n.getAttribute("data-mce-href");return t||n.getAttribute("href")},V=function(n,t){var e=["noopener"],r=n?n.split(/\s+/):[],o=function(n){return n.filter(function(n){return-1===L.inArray(e,n)})},i=t?function(n){return(n=o(n)).length>0?n.concat(e):e}(r):o(r);return i.length>0?function(n){return L.trim(n.sort().join(" "))}(i):""},F=function(n,t){return t=t||n.selection.getNode(),J(t)?n.dom.select("a[href]",t)[0]:n.dom.getParent(t,"a[href]")},W=function(n,t){return function(n){return n.replace(/\uFEFF/g,"")}(t?t.innerText||t.textContent:n.getContent({format:"text"}))},$=function(n){return n&&"A"===n.nodeName&&!!B(n)},H=function(n){return L.grep(n,$).length>0},G=function(n){return!(/</.test(n)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(n)||-1===n.indexOf("href=")))},J=function(n){return n&&"FIGURE"===n.nodeName&&/\bimage\b/i.test(n.className)},X=function(n,t){var e=q({},t);if(!(d(n).length>0)&&!1===v(n)){var r=V(e.rel,"_blank"===e.target);e.rel=r||null}return A.from(e.target).isNone()&&!1===g(n)&&(e.target=m(n)),e.href=function(n,t){return"http"!==t&&"https"!==t||j(n)?n:t+"://"+n}(e.href,s(n)),e},Q=function(n,t,e){var r=n.selection.getNode(),o=F(n,r),i=X(n,function(n){return t=["title","rel","class","target"],e=function(t,e){return n[e].each(function(n){t[e]=n.length>0?n:null}),t},r={href:n.href},function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e)}(t,function(n){r=e(r,n)}),r;var t,e,r}(e));n.undoManager.transact(function(){e.href===t.href&&t.attach(),o?(n.focus(),function(n,t,e,r){e.each(function(n){t.hasOwnProperty("innerText")?t.innerText=n:t.textContent=n}),n.dom.setAttribs(t,r),n.selection.select(t)}(n,o,e.text,i)):function(n,t,e,r){J(t)?en(n,t,r):e.fold(function(){n.execCommand("mceInsertLink",!1,r)},function(t){n.insertContent(n.dom.createHTML("a",r,n.dom.encode(t)))})}(n,r,e.text,i)})},Y=function(n){var t,e,r,o=n.class,i=n.href,u=n.rel,a=n.target,l=n.text,f=n.title;return t={class:o.getOrNull(),href:i,rel:u.getOrNull(),target:a.getOrNull(),text:l.getOrNull(),title:f.getOrNull()},z(t,function(n,t){return!1===c(n)},(e=r={},function(n,t){e[t]=n}),y),r},Z=function(n,t,e){I(n)?n.execCommand("createlink",!1,Y(e)):Q(n,t,e)},nn=function(n){I(n)?n.execCommand("unlink"):function(n){n.undoManager.transact(function(){var t=n.selection.getNode();if(J(t))tn(n,t);else{var e=n.dom.getParent(t,"a[href]",n.getBody());e&&n.dom.remove(e,!0)}n.focus()})}(n)},tn=function(n,t){var e=n.dom.select("img",t)[0];if(e){var r=n.dom.getParents(e,"a[href]",t)[0];r&&(r.parentNode.insertBefore(e,r),n.dom.remove(r))}},en=function(n,t,e){var r=n.dom.select("img",t)[0];if(r){var o=n.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},rn=function(n,t,e,r){var o=r[t],i=n.length>0;return void 0!==o?function(n,t){return D(t,function(t){return A.some(t).filter(function(t){return t.value===n})})}(o,e).map(function(t){return{url:{value:t.value,meta:{text:i?n:t.text,attach:y}},text:i?n:t.text}}):A.none()},on=function(n,t){var e,r,o=(e=n.text,r=e,{get:function(){return r},set:function(n){r=n}}),i=function(n,e){var r,i,u=(r=t,i=e.name,"link"===i?r.catalogs.link:"anchor"===i?r.catalogs.anchor:A.none()).getOr([]);return rn(o.get(),e.name,u,n)};return{onChange:function(n,t){return"url"===t.name?function(n){if(o.get().length<=0){var t=void 0!==n.url.meta.text?n.url.meta.text:n.url.value,e=void 0!==n.url.meta.title?n.url.meta.title:"";return A.some({text:t,title:e})}return A.none()}(n()):_(["anchor","link"],t.name)?i(n(),t):"text"===t.name?(o.set(n().text),A.none()):A.none()}}},un=tinymce.util.Tools.resolve("tinymce.util.Delay"),an=tinymce.util.Tools.resolve("tinymce.util.Promise"),cn=function(n){var t=n.href;return t.indexOf("@")>0&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:")?A.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(n){return q(q({},n),{href:"mailto:"+t})}}):A.none()},ln=function(n,t){return function(e){var r=e.href;return 1===n&&!j(r)||0===n&&/^\s*www[\.|\d\.]/i.test(r)?A.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+t+":// prefix?",preprocess:function(n){return q(q({},n),{href:t+"://"+r})}}):A.none()}},fn=function(n,t){return D([cn,ln(s(n),p(n))],function(n){return n(t)}).fold(function(){return an.resolve(t)},function(e){return new an(function(r){!function(n,t,e){var r=n.selection.getRng();un.setEditorTimeout(n,function(){n.windowManager.confirm(t,function(t){n.selection.setRng(r),e(t)})})}(n,e.message,function(n){r(n?e.preprocess(t):t)})})})},sn=function(n){var t=n.dom.select("a:not([href])"),e=T(t,function(n){var t=n.name||n.id;return t?[{text:t,value:"#"+t}]:[]});return e.length>0?A.some([{text:"None",value:""}].concat(e)):A.none()},mn=function(n){var t=function(n){return n.getParam("link_class_list",[],"array")}(n);return t.length>0?U.sanitize(t):A.none()},gn=tinymce.util.Tools.resolve("tinymce.util.XHR"),dn=function(n){var t=function(t){return n.convertURL(t.value||t.url,"href")},e=function(n){return n.getParam("link_list")}(n);return new an(function(n){u(e)?gn.send({url:e,success:function(t){return n(function(n){try{return A.some(JSON.parse(n))}catch(n){return A.none()}}(t))},error:function(t){return n(A.none())}}):f(e)?e(function(t){return n(A.some(t))}):n(A.from(e))}).then(function(n){return n.bind(U.sanitizeWith(t)).map(function(n){return n.length>0?[{text:"None",value:""}].concat(n):n})})},hn=function(n,t){var e=d(n);if(e.length>0){var r=t.is("_blank");return(!1===v(n)?U.sanitizeWith(function(n){return V(U.getValue(n),r)}):U.sanitize)(e)}return A.none()},vn=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],pn=function(n){var t=g(n);return a(t)?U.sanitize(t).orThunk(function(){return A.some(vn)}):!1===t?A.none():A.some(vn)},yn=function(n,t,e){var r=n.getAttrib(t,e);return null!==r&&r.length>0?A.some(r):A.none()},kn=function(n,t){return dn(n).then(function(e){var r=function(n,t){var e=n.dom,r=G(n.selection.getContent())?A.some(W(n.selection,t)):A.none(),o=t?A.some(e.getAttrib(t,"href")):A.none(),i=t?A.from(e.getAttrib(t,"target")):A.none(),u=yn(e,t,"rel"),a=yn(e,t,"class");return{url:o,text:r,title:yn(e,t,"title"),target:i,rel:u,linkClass:a}}(n,t);return{anchor:r,catalogs:{targets:pn(n),rels:hn(n,r.target),classes:mn(n),anchor:sn(n),link:e},optNode:A.from(t),flags:{titleEnabled:h(n)}}})},xn=function(n){(function(n){var t=F(n);return kn(n,t)})(n).then(function(t){var e=function(n,t){return function(e){var r=e.getData();if(!r.url.value)return nn(n),void e.close();var o=function(n){return A.from(r[n]).filter(function(e){return!t.anchor[n].is(e)})},i={href:r.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:function(){}};fn(n,i).then(function(t){Z(n,u,t)}),e.close()}}(n,t);return function(n,t,e){var r=n.anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),o=n.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=function(n,t){return{url:{value:n.anchor.url.getOr(""),meta:{attach:function(){},text:n.anchor.url.fold(function(){return""},function(){return n.anchor.text.getOr("")}),original:{value:n.anchor.url.getOr("")}}},text:n.anchor.text.getOr(""),title:n.anchor.title.getOr(""),anchor:n.anchor.url.getOr(""),link:n.anchor.url.getOr(""),rel:n.anchor.rel.getOr(""),target:n.anchor.target.or(t).getOr(""),linkClass:n.anchor.linkClass.getOr("")}}(n,A.from(m(e))),u=on(i,n),a=n.catalogs;return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:S([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,o,M([a.anchor.map(U.createUi("anchor","Anchors")),a.rels.map(U.createUi("rel","Rel")),a.targets.map(U.createUi("target","Open link in...")),a.link.map(U.createUi("link","Link list")),a.classes.map(U.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:function(n,t){var e=t.name;u.onChange(n.getData,{name:e}).each(function(t){n.setData(t)})},onSubmit:t}}(t,e,n)}).then(function(t){n.windowManager.open(t)})},bn=function(t){var e=n.document.createElement("a");e.target="_blank",e.href=t,e.rel="noreferrer noopener";var r=n.document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,n.window,0,0,0,0,0,!1,!1,!1,!1,0,null),function(t,e){n.document.body.appendChild(t),t.dispatchEvent(e),n.document.body.removeChild(t)}(e,r)},On=function(n,t){return n.dom.getParent(t,"a[href]")},wn=function(n){return On(n,n.selection.getStart())},Cn=function(n,t){if(t){var e=B(t);if(/^#/.test(e)){var r=n.$(e);r.length&&n.selection.scrollIntoView(r[0],!0)}else bn(t.href)}},An=function(n){return function(){xn(n)}},Nn=function(n){return function(){Cn(n,wn(n))}},Pn=function(n){n.on("click",function(t){var e=On(n,t.target);e&&r.metaKeyPressed(t)&&(t.preventDefault(),Cn(n,e))}),n.on("keydown",function(t){var e=wn(n);e&&13===t.keyCode&&function(n){return!0===n.altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey}(t)&&(t.preventDefault(),Cn(n,e))})},_n=function(n){return function(t){var e=function(e){return t.setActive(!n.mode.isReadOnly()&&!!F(n,e.element))};return n.on("NodeChange",e),function(){return n.off("NodeChange",e)}}},Sn=function(n){return function(t){var e=n.dom.getParents(n.selection.getStart());t.setDisabled(!H(e));var r=function(n){return t.setDisabled(!H(n.parents))};return n.on("NodeChange",r),function(){return n.off("NodeChange",r)}}},Tn=function(n){n.addCommand("mceLink",function(){!function(n){return n.getParam("link_quicklink",!1,"boolean")}(n)?An(n)():n.fire("contexttoolbar-show",{toolbarKey:"quicklink"})})},Dn=function(n){n.addShortcut("Meta+K","",function(){n.execCommand("mceLink")})},Mn=function(n){n.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:An(n),onSetup:_n(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:Nn(n),onSetup:Sn(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return nn(n)},onSetup:Sn(n)})},Ln=function(n){n.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:Nn(n),onSetup:Sn(n)}),n.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:An(n)}),n.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return nn(n)},onSetup:Sn(n)})},En=function(n){n.ui.registry.addContextMenu("link",{update:function(t){return H(n.dom.getParents(t,"a"))?"link unlink openlink":"link"}})},Rn=function(n){var t=function(t){var e=n.selection.getNode();return t.setDisabled(!F(n,e)),function(){}};n.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:_n(n)},label:"Link",predicate:function(t){return!!F(n,t)&&function(n){return n.getParam("link_context_toolbar",!1,"boolean")}(n)},initValue:function(){var t=F(n);return t?B(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var e=n.selection.getNode();return t.setActive(!!F(n,e)),_n(n)(t)},onAction:function(t){var e=F(n),r=t.getValue();if(e)n.undoManager.transact(function(){n.dom.setAttrib(e,"href",r),function(n){n.selection.collapse(!1)}(n),t.hide()});else{var o={href:r,attach:function(){}},i=G(n.selection.getContent())?A.some(W(n.selection,e)).filter(function(n){return n.length>0}).or(A.from(r)):A.none();Z(n,o,{href:r,text:i,title:A.none(),rel:A.none(),target:A.none(),class:A.none()}),t.hide()}}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:t,onAction:function(t){nn(n),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:t,onAction:function(t){Nn(n)(),t.hide()}}]})};e.add("link",function(n){Mn(n),Ln(n),En(n),Rn(n),Pn(n),Tn(n),Dn(n)})}(window);